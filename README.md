# Habitat Analysis: Biomedical Imaging Toolkit (HABIT)

<p align="center">
  <img src="https://www.imagilys.com/wp-content/uploads/2018/09/radiomics-illustration-500x500.png" alt="Radiomics" width="200"/>
</p>

<p align="center">
  <strong>ğŸ“– è¯­è¨€ / Language</strong><br>
  <a href="README.md">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</a> | <a href="README_en.md">ğŸ‡¬ğŸ‡§ English</a>
</p>

<p align="center">
    <a href="https://github.com/lichao312214129/HABIT/blob/main/LICENSE"><img src="https://img.shields.io/badge/License-MIT-blue.svg"></a>
    <a href="#"><img src="https://img.shields.io/badge/Python-3.8+-brightgreen.svg"></a>
    <a href="#"><img src="https://img.shields.io/badge/Status-Active-green.svg"></a>
</p>

> **ä¸“ä¸ºä¸´åºŠåŒ»ç”Ÿå’Œç ”ç©¶äººå‘˜è®¾è®¡çš„è‚¿ç˜¤"ç”Ÿå¢ƒ"ï¼ˆHabitatï¼‰åˆ†æä¸å¼‚è´¨æ€§è¯„ä¼°å·¥å…·ç®±ã€‚**
>
> *æ— éœ€å¤æ‚çš„ç¼–ç¨‹çŸ¥è¯†ï¼Œå³å¯å¼€å±•é¡¶åˆŠçº§åˆ«çš„å½±åƒç»„å­¦ä¸ç”Ÿå¢ƒåˆ†æç ”ç©¶ã€‚*

---

## ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© HABITï¼Ÿ

åœ¨ç²¾å‡†åŒ»ç–—æ—¶ä»£ï¼Œ**è‚¿ç˜¤å¼‚è´¨æ€§**æ˜¯å½±å“æ‚£è€…é¢„åå’Œæ²»ç–—ååº”çš„å…³é”®å› ç´ ã€‚ä¼ ç»Ÿçš„å½±åƒç»„å­¦å¾€å¾€æå–æ•´ä¸ªè‚¿ç˜¤çš„å¹³å‡ç‰¹å¾ï¼Œæ©ç›–äº†è‚¿ç˜¤å†…éƒ¨çš„ç©ºé—´å¼‚è´¨æ€§ã€‚

**HABIT è‡´åŠ›äºè§£å†³è¿™ä¸€ç—›ç‚¹ï¼š**

1.  **è‡ªåŠ¨åˆ’åˆ†ç”Ÿå¢ƒ**ï¼šè‡ªåŠ¨è¯†åˆ«è‚¿ç˜¤å†…éƒ¨çš„åæ­»åŒºã€æ´»æ€§è‚¿ç˜¤åŒºã€æ°´è‚¿åŒºç­‰å…·æœ‰ä¸åŒç”Ÿç‰©å­¦è¡Œä¸ºçš„äºšåŒºåŸŸã€‚
2.  **æ— ç¼å¯¹æ¥ä¸´åºŠ**ï¼šå®Œç¾æ”¯æŒç”± **ITK-SNAP** æˆ– **3D Slicer** å‹¾ç”»çš„ ROIï¼Œç”Ÿæˆçš„ç”Ÿå¢ƒåœ°å›¾å¯ç›´æ¥æ‹–å›è½¯ä»¶ä¸­å åŠ æ˜¾ç¤ºã€‚
3.  **é›¶ä»£ç é—¨æ§›**ï¼šé€šè¿‡ä¿®æ”¹ç®€å•çš„é…ç½®æ–‡ä»¶ï¼ˆç±»ä¼¼å¡«è¡¨ï¼‰å³å¯è¿è¡Œï¼Œæ— éœ€ç¼–å†™å¤æ‚çš„ä»£ç ã€‚
4.  **ä¸€ç«™å¼æµç¨‹**ï¼šä» DICOM é¢„å¤„ç† -> ç”Ÿå¢ƒèšç±» -> ç‰¹å¾æå– -> æœºå™¨å­¦ä¹ å»ºæ¨¡ -> ç»˜åˆ¶å›¾è¡¨ï¼Œå…¨æµç¨‹è¦†ç›–ã€‚

---

## ğŸ‘¨â€âš•ï¸ ä¸´åºŠå·¥ä½œæµï¼šä»å½±åƒåˆ°å‘è¡¨

HABIT å°†å¤æ‚çš„è®¡ç®—è¿‡ç¨‹å°è£…ä¸ºç®€å•çš„å››ä¸ªæ­¥éª¤ï¼š

1.  **å‡†å¤‡æ•°æ® (Prepare)**
    *   ä½¿ç”¨æ‚¨ç†Ÿæ‚‰çš„ **ITK-SNAP** æˆ– **3D Slicer** å‹¾ç”»è‚¿ç˜¤ ROIï¼Œä¿å­˜ä¸º NIfTI (`.nii.gz`) æ ¼å¼ã€‚
2.  **å¡«å†™é…ç½® (Config)**
    *   ä¿®æ”¹ `.yaml` é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šæ‚¨çš„å½±åƒæ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå°±åƒå¡«å†™ Excel è¡¨æ ¼ä¸€æ ·ç®€å•ï¼‰ã€‚
3.  **ä¸€é”®è¿è¡Œ (Run)**
    *   åœ¨ç»ˆç«¯è¿è¡Œä¸€è¡Œå‘½ä»¤ï¼ŒHABIT è‡ªåŠ¨å®Œæˆæ‰€æœ‰è®¡ç®—ã€‚
4.  **è·å–ç»“æœ (Result)**
    *   è·å¾— **å½©è‰²ç”Ÿå¢ƒåœ°å›¾**ï¼ˆç”¨äºç›´è§‚å±•ç¤ºï¼‰å’Œ **é‡åŒ–ç‰¹å¾è¡¨æ ¼**ï¼ˆç”¨äºç»Ÿè®¡åˆ†æï¼‰ã€‚

---

## âš¡ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### Step 0: å‡†å¤‡åŸºç¡€ç¯å¢ƒ (ä»…éœ€ä¸€æ¬¡)

> å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ Python è½¯ä»¶ï¼Œè¯·å…ˆå®‰è£… **Miniconda**ã€‚
> *å¦‚æœæ‚¨å·²ç»å®‰è£…äº† Anaconda æˆ– Minicondaï¼Œè¯·è·³è¿‡æ­¤æ­¥éª¤ã€‚*

#### ğŸ’» Windows ç”¨æˆ·
1.  **ä¸‹è½½**ï¼šğŸ‘‰ [ç‚¹å‡»ä¸‹è½½ Windows ç‰ˆ Miniconda](https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-x86_64.exe)
2.  **å®‰è£…**ï¼šåŒå‡»ä¸‹è½½çš„ `.exe` æ–‡ä»¶ï¼Œ**ä¸€è·¯ç‚¹å‡» "Next"**ï¼Œç›´åˆ°å®‰è£…å®Œæˆã€‚
    *   *å»ºè®®å‹¾é€‰ "Add Miniconda3 to my PATH environment variable"ï¼ˆå¦‚æœå‡ºç°è¯¥é€‰é¡¹ï¼‰ã€‚*
3.  **æ‰“å¼€ç»ˆç«¯**ï¼š
    *   ç‚¹å‡»å±å¹•å·¦ä¸‹è§’çš„ **"å¼€å§‹"** èœå•ã€‚
    *   æœç´¢ **"Anaconda Prompt"**ï¼ˆæˆ– **"Miniconda Prompt"**ï¼‰ã€‚
    *   ç‚¹å‡»å‡ºç°çš„é»‘è‰²å›¾æ ‡ã€‚

#### ğŸ macOS (è‹¹æœç”µè„‘) ç”¨æˆ·
1.  **ä¸‹è½½**ï¼š
    *   **M1/M2/M3 èŠ¯ç‰‡** (2020å¹´åçš„æ–°æ¬¾): ğŸ‘‰ [ç‚¹å‡»ä¸‹è½½ Apple Silicon ç‰ˆ](https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.pkg)
    *   **Intel èŠ¯ç‰‡** (æ—§æ¬¾): ğŸ‘‰ [ç‚¹å‡»ä¸‹è½½ Intel ç‰ˆ](https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.pkg)
    *   *å¦‚æœä¸ç¡®å®šï¼Œç‚¹å‡»å±å¹•å·¦ä¸Šè§’è‹¹æœå›¾æ ‡ -> "å…³äºæœ¬æœº" æŸ¥çœ‹ã€‚*
2.  **å®‰è£…**ï¼šåŒå‡»ä¸‹è½½çš„ `.pkg` æ–‡ä»¶ï¼ŒæŒ‰ç…§æç¤ºä¸€è·¯ç‚¹å‡» "ç»§ç»­" æˆ– "å®‰è£…"ã€‚
3.  **æ‰“å¼€ç»ˆç«¯**ï¼š
    *   æŒ‰é”®ç›˜ä¸Šçš„ `Command âŒ˜` + `ç©ºæ ¼`ã€‚
    *   è¾“å…¥ **"Terminal"** (æˆ– **"ç»ˆç«¯"**) å¹¶å›è½¦ã€‚
    *   åœ¨ç»ˆç«¯ä¸­è¾“å…¥ `conda init` å¹¶å›è½¦ï¼Œç„¶å**é‡å¯ç»ˆç«¯**ã€‚

---

*âœ… éªŒè¯æˆåŠŸç¤ºä¾‹ï¼š*
> æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„é»‘è‰²çª—å£ï¼Œæœ€å‰é¢æœ‰ **`(base)`** å­—æ ·ï¼š
> ```text
> (base) C:\Users\YourName> _
> ```

### Step 1: ä¸‹è½½ä¸å®‰è£… HABIT

**1. ä¸‹è½½å·¥å…·åŒ…**
ğŸ‘‰ [**ç‚¹å‡»ä¸‹è½½æœ€æ–°ç‰ˆ HABIT å‹ç¼©åŒ…**](https://github.com/lichao312214129/HABIT/archive/refs/heads/main.zip)

ä¸‹è½½åï¼Œè¯·å°†å‹ç¼©åŒ…**è§£å‹**åˆ°ä¸€ä¸ªæ‚¨å®¹æ˜“æ‰¾åˆ°çš„æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ `D:\HABIT`ï¼‰ã€‚

**2. è¿›å…¥æ–‡ä»¶å¤¹**
åœ¨åˆšæ‰æ‰“å¼€çš„ **é»‘è‰²ç»ˆç«¯çª—å£** ä¸­ï¼Œä½¿ç”¨ `cd` å‘½ä»¤è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹ã€‚

*ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è§£å‹åœ¨ `D:\HABIT`ï¼Œè¯·è¾“å…¥ï¼š*

```bash
cd D:\HABIT
```

*(å¦‚æœæŒ‰ä¸‹å›è½¦åå‘ç°ç›®å½•æ²¡å˜ï¼Œå¯èƒ½å› ä¸ºæ‚¨åœ¨ C ç›˜ã€‚æ­¤æ—¶è¯·å…ˆè¾“å…¥ `D:` å¹¶å›è½¦ï¼Œå†è¾“å…¥ä¸Šé¢çš„å‘½ä»¤)*

**3. ä¸€é”®å®‰è£…**
å¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤åˆ°ç»ˆç«¯ä¸­è¿è¡Œï¼ˆç½‘ç»œé€šç•…æƒ…å†µä¸‹çº¦éœ€ 5-10 åˆ†é’Ÿï¼‰ï¼š

```bash
# 1. åˆ›å»ºä¸€ä¸ªåä¸º "habit" çš„ä¸“å±ç¯å¢ƒ
conda create -n habit python=3.8 -y

# 2. æ¿€æ´»è¿™ä¸ªç¯å¢ƒ (æ³¨æ„è§‚å¯Ÿå‘½ä»¤è¡Œå‰ç¼€çš„å˜åŒ–)
conda activate habit
```

> *âœ… æ¿€æ´»æˆåŠŸç¤ºä¾‹ï¼š*
> å‘½ä»¤è¡Œå‰ç¼€ä¼šä» `(base)` å˜æˆ **`(habit)`**ï¼š
> ```text
> (base) D:\HABIT> conda activate habit
> (habit) D:\HABIT> _
> ```

```bash
# 3. å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt

# 4. å®‰è£… HABIT å·¥å…·æœ¬èº«
pip install -e .
```

> *âœ… å®‰è£…æˆåŠŸç¤ºä¾‹ï¼š*
> å½“å±å¹•åœæ­¢æ»šåŠ¨ï¼Œå¹¶å‡ºç°ç±»ä¼¼ä¸‹æ–¹çš„æ–‡å­—ï¼Œè¯´æ˜å®‰è£…å®Œæˆï¼š
> ```text
> Successfully installed habit-1.0.0
> (habit) D:\HABIT> _
> ```

**âŒ å¦‚æœå®‰è£…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
å¦‚æœè¿è¡Œ `pip install` æ—¶å‡ºç°çº¢è‰²æŠ¥é”™ï¼Œè¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š
1.  **é€ä¸ªæ’æŸ¥**ï¼šæ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„ `requirements.txt`ï¼Œæ‰‹åŠ¨é€è¡Œè¿è¡Œ `pip install <åŒ…å>`ï¼ˆä¾‹å¦‚ `pip install SimpleITK`ï¼‰ï¼Œæ‰¾å‡ºå…·ä½“æ˜¯å“ªä¸ªåŒ…å®‰è£…å¤±è´¥ã€‚
2.  **å¯»æ±‚å¸®åŠ©**ï¼šå¦‚æœæ— æ³•è§£å†³ï¼Œè¯·åœ¨ GitHub ä¸Š [æäº¤ Issue](https://github.com/lichao312214129/HABIT/issues) æˆ–è€…ç›´æ¥å‘é€é‚®ä»¶è”ç³»ä½œè€…ï¼š**lichao19870617@163.com**ã€‚

### Step 2: è¿è¡Œç¤ºä¾‹ (Run Demo)

æˆ‘ä»¬å†…ç½®äº†æ¼”ç¤ºæ•°æ®ï¼Œæ‚¨æ— éœ€å‡†å¤‡ä»»ä½•æ•°æ®å³å¯ç«‹å³ä½“éªŒï¼š

```bash
# è¿è¡Œç”Ÿå¢ƒåˆ†æç¤ºä¾‹ï¼ˆç›´æ¥å¤åˆ¶ç²˜è´´ï¼‰
habit get-habitat --config demo_data/config_habitat.yaml
```

### Step 3: æŸ¥çœ‹ç»“æœ (Output)

è¿è¡Œå®Œæˆåï¼Œæ‰“å¼€ `demo_data/results/habitat/` æ–‡ä»¶å¤¹ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æ–‡ä»¶ç»“æ„ï¼š

```text
demo_data/results/habitat/
â”œâ”€â”€ ğŸ–¼ï¸ sub001_habitats.nrrd      <-- 3D ç”Ÿå¢ƒåœ°å›¾ (æ‹–å…¥ ITK-SNAP æŸ¥çœ‹)
â”œâ”€â”€ ğŸ“Š habitats.csv              <-- è¯¦ç»†ç‰¹å¾è¡¨æ ¼ (Excel æ‰“å¼€)
â””â”€â”€ ğŸ“ˆ visualizations/           <-- è‡ªåŠ¨ç”Ÿæˆçš„ç»Ÿè®¡å›¾è¡¨
    â”œâ”€â”€ cluster_centroids.png    <-- èšç±»ä¸­å¿ƒå›¾
    â””â”€â”€ feature_heatmap.png      <-- ç‰¹å¾çƒ­å›¾
```

*   ğŸ–¼ï¸ **`*_habitats.nrrd`**ï¼š**3D ç”Ÿå¢ƒåœ°å›¾**ã€‚
    *   *å¦‚ä½•æŸ¥çœ‹ï¼Ÿ* ç›´æ¥æ‹–å…¥ ITK-SNAPï¼Œå åŠ åœ¨åŸå§‹å½±åƒä¸Šï¼Œæ‚¨å°†çœ‹åˆ°äº”é¢œå…­è‰²çš„åˆ†åŒºï¼Œç›´è§‚å±•ç¤ºè‚¿ç˜¤å†…éƒ¨å¼‚è´¨æ€§ã€‚
*   ğŸ“Š **`habitats.csv`**ï¼šåŒ…å«æ¯ä¸ªä½“ç´ çš„è¯¦ç»†åˆ†ç±»ç»“æœã€‚
*   ğŸ“ˆ **`visualizations/`**ï¼šè‡ªåŠ¨ç”Ÿæˆçš„èšç±»åˆ†æå›¾è¡¨ï¼Œå¯ç›´æ¥ç”¨äºè®ºæ–‡æ’å›¾ã€‚

---

## ğŸ“š æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| åŠŸèƒ½æ¨¡å— | ä¸´åºŠåº”ç”¨ä»·å€¼ |
| :--- | :--- |
| **å½±åƒé¢„å¤„ç†** | è‡ªåŠ¨è¿›è¡Œé‡é‡‡æ ·ã€é…å‡†ã€N4 åç½®åœºæ ¡æ­£ï¼Œ**çœå»æ‰‹åŠ¨å¤„ç†çš„ç¹ç**ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ |
| **ç”Ÿå¢ƒèšç±»** | æä¾›ä¸€æ­¥æ³•ã€äºŒæ­¥æ³•ç­‰ç­–ç•¥ï¼Œ**è‡ªåŠ¨å‘ç°**è‚‰çœ¼éš¾ä»¥åŒºåˆ†çš„è‚¿ç˜¤äºšåŒºï¼ˆç”Ÿå¢ƒï¼‰ã€‚ |
| **ç‰¹å¾æå–** | æå– **å¤šåŒºåŸŸç©ºé—´äº¤äº’ (MSI)** å’Œ **è‚¿ç˜¤å†…å¼‚è´¨æ€§ (ITH)** ç‰¹å¾ï¼ŒæŒ–æ˜æ·±å±‚ç”Ÿç‰©å­¦ä¿¡æ¯ã€‚ |
| **æœºå™¨å­¦ä¹ ** | å†…ç½®å…¨æµç¨‹å»ºæ¨¡å·¥å…·ï¼Œä»ç‰¹å¾ç­›é€‰åˆ° AUC æ›²çº¿ç»˜åˆ¶ï¼Œ**åŠ©åŠ›é«˜åˆ†æ–‡ç« å‘è¡¨**ã€‚ |

> **ğŸ’¡ æœ¯è¯­å°è´´å£«**ï¼š
> *   **ä½“ç´  (Voxel)**ï¼š3D å½±åƒä¸­çš„åƒç´ ç‚¹ï¼Œå½±åƒåˆ†æçš„åŸºæœ¬å•ä½ã€‚
> *   **è¶…ä½“ç´  (Supervoxel)**ï¼šå°†æ€§è´¨ç›¸ä¼¼çš„ç›¸é‚»ä½“ç´ æ‰“åŒ…æˆçš„å°æ–¹å—ã€‚ç›¸æ¯”ä¼ ç»Ÿä½“ç´ ï¼Œå®ƒèƒ½æ›´ç¨³å®šåœ°åæ˜ çº¹ç†ç‰¹å¾ï¼ŒæŠ—å™ªæ€§æ›´å¼ºï¼Œè®¡ç®—æ•ˆç‡æ›´é«˜ã€‚

---

## ğŸ“– æ–‡æ¡£ä¸æ”¯æŒ

è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—ã€å‚æ•°è¯´æ˜å’Œ API æ–‡æ¡£è¯·è®¿é—®ï¼š

ğŸ‘‰ **[HABIT åœ¨çº¿æ–‡æ¡£](https://lichao312214129.github.io/HABIT)**

*   [å¦‚ä½•å‡†å¤‡æ•°æ®ï¼Ÿ](https://lichao312214129.github.io/HABIT/user_guide/image_preprocessing_zh.html)
*   [å¦‚ä½•è§£è¯»ç”Ÿå¢ƒå›¾ï¼Ÿ](https://lichao312214129.github.io/HABIT/user_guide/habitat_segmentation_zh.html)
*   [å¸¸è§é—®é¢˜ (FAQ)](https://lichao312214129.github.io/HABIT/index.html#faq)

---

## ğŸ¤ å¼•ç”¨ä¸è®¸å¯

å¦‚æœæ‚¨åœ¨ç ”ç©¶ä¸­ä½¿ç”¨äº† HABITï¼Œè¯·å¼•ç”¨æˆ‘ä»¬çš„å·¥ä½œï¼š
> [å¼•ç”¨ä¿¡æ¯å¾…æ·»åŠ ]

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE) å¼€æºã€‚

---

<p align="center">ç”± HABIT å›¢é˜Ÿç»´æŠ¤ | æ¬¢è¿æäº¤ Issue æˆ– Pull Request</p>
