
import base64
exec(base64.b64decode(b'IiIiDQpCYXNlIGNsdXN0ZXJpbmcgbW9kdWxlIGZvciBoYWJpdGF0IGFuYWx5c2lzLg0KIiIiDQoNCmltcG9ydCBudW1weSBhcyBucA0KaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdA0KZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2QNCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBBbnksIFR1cGxlLCBPcHRpb25hbCwgVW5pb24sIENhbGxhYmxlDQpmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgc2lsaG91ZXR0ZV9zY29yZSwgY2FsaW5za2lfaGFyYWJhc3pfc2NvcmUsIGRhdmllc19ib3VsZGluX3Njb3JlDQpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgTGFiZWxFbmNvZGVyDQppbXBvcnQgbWF0cGxvdGxpYi5jbSBhcyBjbQ0KZnJvbSBtYXRwbG90bGliLnRpY2tlciBpbXBvcnQgTWF4TkxvY2F0b3INCmltcG9ydCB3YXJuaW5ncw0KaW1wb3J0IG9zDQppbXBvcnQgaW1wb3J0bGliDQppbXBvcnQgcGtndXRpbA0KaW1wb3J0IGluc3BlY3QNCg0Kd2FybmluZ3Muc2ltcGxlZmlsdGVyKCdpZ25vcmUnKQ0KDQpmcm9tIC5jbHVzdGVyX3ZhbGlkYXRpb25fbWV0aG9kcyBpbXBvcnQgZ2V0X2RlZmF1bHRfbWV0aG9kcywgZ2V0X21ldGhvZF9kZXNjcmlwdGlvbiwgZ2V0X29wdGltaXphdGlvbl9kaXJlY3Rpb24NCg0KIyBSZWdpc3RyeSBmb3IgY2x1c3RlcmluZyBhbGdvcml0aG1zDQpfQ0xVU1RFUklOR19SRUdJU1RSWSA9IHt9DQoNCmRlZiByZWdpc3Rlcl9jbHVzdGVyaW5nKG5hbWU6IHN0cik6DQogICAgIiIiDQogICAgRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBjbHVzdGVyaW5nIGFsZ29yaXRobSBjbGFzc2VzDQogICAgDQogICAgQXJnczoNCiAgICAgICAgbmFtZSAoc3RyKTogTmFtZSBvZiB0aGUgY2x1c3RlcmluZyBhbGdvcml0aG0NCiAgICAiIiINCiAgICBkZWYgZGVjb3JhdG9yKGNscyk6DQogICAgICAgIF9DTFVTVEVSSU5HX1JFR0lTVFJZW25hbWUubG93ZXIoKV0gPSBjbHMNCiAgICAgICAgcmV0dXJuIGNscw0KICAgIHJldHVybiBkZWNvcmF0b3INCg0KZGVmIGdldF9jbHVzdGVyaW5nX2FsZ29yaXRobShuYW1lOiBzdHIsICoqa3dhcmdzKSAtPiAnQmFzZUNsdXN0ZXJpbmcnOg0KICAgICIiIg0KICAgIEdldCBjbHVzdGVyaW5nIGFsZ29yaXRobSBjbGFzcyBieSBuYW1lDQogICAgDQogICAgQXJnczoNCiAgICAgICAgbmFtZSAoc3RyKTogTmFtZSBvZiB0aGUgY2x1c3RlcmluZyBhbGdvcml0aG0NCiAgICAgICAgKiprd2FyZ3M6IFBhcmFtZXRlcnMgdG8gcGFzcyB0byB0aGUgY2x1c3RlcmluZyBhbGdvcml0aG0gY29uc3RydWN0b3INCiAgICANCiAgICBSZXR1cm5zOg0KICAgICAgICBCYXNlQ2x1c3RlcmluZzogSW5zdGFuY2Ugb2YgdGhlIGNsdXN0ZXJpbmcgYWxnb3JpdGhtDQogICAgIiIiDQogICAgIyBMYXp5IGRpc2NvdmVyeSBvZiBjbHVzdGVyaW5nIGFsZ29yaXRobXMgdG8gYXZvaWQgY2lyY3VsYXIgaW1wb3J0cw0KICAgIGlmIG5vdCBfQ0xVU1RFUklOR19SRUdJU1RSWToNCiAgICAgICAgZGlzY292ZXJfY2x1c3RlcmluZ19hbGdvcml0aG1zKCkNCiAgICAgICAgDQogICAgIyBGaXJzdCB0cnkgdG8gZmluZCByZWdpc3RlcmVkIGFsZ29yaXRobXMNCiAgICBpZiBuYW1lLmxvd2VyKCkgaW4gX0NMVVNURVJJTkdfUkVHSVNUUlk6DQogICAgICAgIHJldHVybiBfQ0xVU1RFUklOR19SRUdJU1RSWVtuYW1lLmxvd2VyKCldKCoqa3dhcmdzKQ0KICAgIA0KICAgICMgSWYgbm90IGZvdW5kLCB0cnkgZHluYW1pYyBpbXBvcnQNCiAgICB0cnk6DQogICAgICAgICMgVHJ5IHRvIGltcG9ydCBtb2R1bGUgd2l0aCBzcGVjaWZpZWQgbmFtZQ0KICAgICAgICBtb2R1bGVfbmFtZSA9IGYie25hbWV9X2NsdXN0ZXJpbmciDQogICAgICAgIG1vZHVsZSA9IGltcG9ydGxpYi5pbXBvcnRfbW9kdWxlKGYiLnttb2R1bGVfbmFtZX0iLCBwYWNrYWdlPV9fcGFja2FnZV9fKQ0KICAgICAgICANCiAgICAgICAgIyBGaW5kIGNsdXN0ZXJpbmcgYWxnb3JpdGhtIGNsYXNzIGluIHRoZSBtb2R1bGUNCiAgICAgICAgZm9yIGF0dHJfbmFtZSwgYXR0cl92YWx1ZSBpbiBpbnNwZWN0LmdldG1lbWJlcnMobW9kdWxlLCBpbnNwZWN0LmlzY2xhc3MpOg0KICAgICAgICAgICAgaWYgYXR0cl9uYW1lICE9ICdCYXNlQ2x1c3RlcmluZycgYW5kICdCYXNlQ2x1c3RlcmluZycgaW4gW2Jhc2UuX19uYW1lX18gZm9yIGJhc2UgaW4gYXR0cl92YWx1ZS5fX21yb19fIGlmIGJhc2UuX19uYW1lX18gIT0gJ29iamVjdCddOg0KICAgICAgICAgICAgICAgICMgQXV0by1yZWdpc3RlciBmb3VuZCBjbGFzcw0KICAgICAgICAgICAgICAgIF9DTFVTVEVSSU5HX1JFR0lTVFJZW25hbWUubG93ZXIoKV0gPSBhdHRyX3ZhbHVlDQogICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJfdmFsdWUoKiprd2FyZ3MpDQogICAgZXhjZXB0IChJbXBvcnRFcnJvciwgTW9kdWxlTm90Rm91bmRFcnJvcik6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIElmIHN0aWxsIG5vdCBmb3VuZCwgcmFpc2UgZXJyb3INCiAgICByYWlzZSBWYWx1ZUVycm9yKGYiVW5rbm93biBjbHVzdGVyaW5nIGFsZ29yaXRobToge25hbWV9LCBhdmFpbGFibGUgYWxnb3JpdGhtczoge2xpc3QoX0NMVVNURVJJTkdfUkVHSVNUUlkua2V5cygpKX0iKQ0KDQpkZWYgZ2V0X2F2YWlsYWJsZV9jbHVzdGVyaW5nX2FsZ29yaXRobXMoKSAtPiBMaXN0W3N0cl06DQogICAgIiIiDQogICAgR2V0IGFsbCBhdmFpbGFibGUgY2x1c3RlcmluZyBhbGdvcml0aG0gbmFtZXMNCiAgICANCiAgICBSZXR1cm5zOg0KICAgICAgICBMaXN0W3N0cl06IExpc3Qgb2YgY2x1c3RlcmluZyBhbGdvcml0aG0gbmFtZXMNCiAgICAiIiINCiAgICAjIExhenkgZGlzY292ZXJ5IG9mIGNsdXN0ZXJpbmcgYWxnb3JpdGhtcyB0byBhdm9pZCBjaXJjdWxhciBpbXBvcnRzDQogICAgaWYgbm90IF9DTFVTVEVSSU5HX1JFR0lTVFJZOg0KICAgICAgICBkaXNjb3Zlcl9jbHVzdGVyaW5nX2FsZ29yaXRobXMoKQ0KICAgICAgICANCiAgICByZXR1cm4gbGlzdChfQ0xVU1RFUklOR19SRUdJU1RSWS5rZXlzKCkpDQoNCmRlZiBkaXNjb3Zlcl9jbHVzdGVyaW5nX2FsZ29yaXRobXMoKSAtPiBOb25lOg0KICAgICIiIg0KICAgIEF1dG9tYXRpY2FsbHkgZGlzY292ZXIgYWxsIGNsdXN0ZXJpbmcgYWxnb3JpdGhtcyBkZWZpbmVkIGluIHRoZSBjbHVzdGVyaW5nIGRpcmVjdG9yeQ0KICAgICIiIg0KICAgICMgVXNlIGN1cnJlbnQgZmlsZSBkaXJlY3RvcnkgdG8gYXZvaWQgY2lyY3VsYXIgaW1wb3J0cw0KICAgIHBhY2thZ2VfZGlyID0gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpDQogICAgDQogICAgIyBJdGVyYXRlIHRocm91Z2ggYWxsIG1vZHVsZXMgaW4gdGhlIHBhY2thZ2UNCiAgICBmb3IgXywgbW9kdWxlX25hbWUsIF8gaW4gcGtndXRpbC5pdGVyX21vZHVsZXMoW3BhY2thZ2VfZGlyXSk6DQogICAgICAgIGlmIG1vZHVsZV9uYW1lLmVuZHN3aXRoKCdfY2x1c3RlcmluZycpIGFuZCBtb2R1bGVfbmFtZSAhPSAnYmFzZV9jbHVzdGVyaW5nJzoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAjIER5bmFtaWNhbGx5IGltcG9ydCBtb2R1bGUNCiAgICAgICAgICAgICAgICBtb2R1bGUgPSBpbXBvcnRsaWIuaW1wb3J0X21vZHVsZShmIi57bW9kdWxlX25hbWV9IiwgcGFja2FnZT1fX3BhY2thZ2VfXykNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIEZpbmQgYW5kIHJlZ2lzdGVyIGNsdXN0ZXJpbmcgYWxnb3JpdGhtcyBkZWZpbmVkIGluIHRoZSBtb2R1bGUNCiAgICAgICAgICAgICAgICBmb3IgYXR0cl9uYW1lLCBhdHRyX3ZhbHVlIGluIGluc3BlY3QuZ2V0bWVtYmVycyhtb2R1bGUsIGluc3BlY3QuaXNjbGFzcyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGF0dHJfbmFtZSAhPSAnQmFzZUNsdXN0ZXJpbmcnIGFuZCAnQmFzZUNsdXN0ZXJpbmcnIGluIFtiYXNlLl9fbmFtZV9fIGZvciBiYXNlIGluIGF0dHJfdmFsdWUuX19tcm9fXyBpZiBiYXNlLl9fbmFtZV9fICE9ICdvYmplY3QnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgRXh0cmFjdCBhbGdvcml0aG0gbmFtZSBmcm9tIG1vZHVsZSBuYW1lIChlLmcuLCBleHRyYWN0IGttZWFucyBmcm9tIGttZWFuc19jbHVzdGVyaW5nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYWxnb19uYW1lID0gbW9kdWxlX25hbWUucmVwbGFjZSgnX2NsdXN0ZXJpbmcnLCAnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIF9DTFVTVEVSSU5HX1JFR0lTVFJZW2FsZ29fbmFtZS5sb3dlcigpXSA9IGF0dHJfdmFsdWUNCiAgICAgICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICAgICAgICAgICAgICBwYXNzDQoNCg0KY2xhc3MgQmFzZUNsdXN0ZXJpbmcoQUJDKToNCiAgICAiIiINCiAgICBCYXNlIGNsYXNzIGZvciBjbHVzdGVyaW5nIGFsZ29yaXRobXMsIGRlZmluaW5nIG1ldGhvZHMgdGhhdCBhbGwgY2x1c3RlcmluZyBhbGdvcml0aG1zIG11c3QgaW1wbGVtZW50DQogICAgDQogICAgU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCB0aGUgZm9sbG93aW5nIG1ldGhvZHM6DQogICAgLSBmaXQ6IFRyYWluIHRoZSBjbHVzdGVyaW5nIG1vZGVsIGJhc2VkIG9uIGlucHV0IGRhdGENCiAgICAtIHByZWRpY3Q6IFByZWRpY3QgY2x1c3RlciBsYWJlbHMgZm9yIGlucHV0IGRhdGENCiAgICAiIiINCiAgICANCiAgICBkZWYgX19pbml0X18oc2VsZiwgbl9jbHVzdGVyczogT3B0aW9uYWxbaW50XSA9IE5vbmUsIHJhbmRvbV9zdGF0ZTogaW50ID0gMCk6DQogICAgICAgICIiIg0KICAgICAgICBJbml0aWFsaXplIGNsdXN0ZXJpbmcgYWxnb3JpdGhtDQogICAgICAgIA0KICAgICAgICBBcmdzOg0KICAgICAgICAgICAgbl9jbHVzdGVycyAoT3B0aW9uYWxbaW50XSk6IE51bWJlciBvZiBjbHVzdGVycywgY2FuIGJlIE5vbmUsIGluZGljYXRpbmcgaXQgbmVlZHMgdG8gYmUgZGV0ZXJtaW5lZCBieSBmaW5kX29wdGltYWxfY2x1c3RlcnMNCiAgICAgICAgICAgIHJhbmRvbV9zdGF0ZSAoaW50KTogUmFuZG9tIHNlZWQgdG8gZW5zdXJlIHJlcHJvZHVjaWJpbGl0eQ0KICAgICAgICAiIiINCiAgICAgICAgc2VsZi5uX2NsdXN0ZXJzID0gbl9jbHVzdGVycw0KICAgICAgICBzZWxmLnJhbmRvbV9zdGF0ZSA9IHJhbmRvbV9zdGF0ZQ0KICAgICAgICBzZWxmLm1vZGVsID0gTm9uZQ0KICAgICAgICBzZWxmLmxhYmVsc18gPSBOb25lDQogICAgICAgIHNlbGYuY2x1c3Rlcl9yYW5nZSA9IE5vbmUNCiAgICAgICAgc2VsZi5zY29yZXMgPSB7fQ0KICAgIA0KICAgIEBhYnN0cmFjdG1ldGhvZA0KICAgIGRlZiBmaXQoc2VsZiwgWDogbnAubmRhcnJheSkgLT4gJ0Jhc2VDbHVzdGVyaW5nJzoNCiAgICAgICAgIiIiDQogICAgICAgIFRyYWluIGNsdXN0ZXJpbmcgbW9kZWwNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIChucC5uZGFycmF5KTogSW5wdXQgZGF0YSB3aXRoIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIEJhc2VDbHVzdGVyaW5nOiBUcmFpbmVkIG1vZGVsDQogICAgICAgICIiIg0KICAgICAgICBwYXNzDQogICAgDQogICAgQGFic3RyYWN0bWV0aG9kDQogICAgZGVmIHByZWRpY3Qoc2VsZiwgWDogbnAubmRhcnJheSkgLT4gbnAubmRhcnJheToNCiAgICAgICAgIiIiDQogICAgICAgIFByZWRpY3QgY2x1c3RlciBsYWJlbHMgZm9yIGlucHV0IGRhdGENCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIChucC5uZGFycmF5KTogSW5wdXQgZGF0YSB3aXRoIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIG5wLm5kYXJyYXk6IENsdXN0ZXIgbGFiZWxzIHdpdGggc2hhcGUgKG5fc2FtcGxlcywpDQogICAgICAgICIiIg0KICAgICAgICBwYXNzDQogICAgDQogICAgZGVmIGNhbGN1bGF0ZV9pbmVydGlhX3Njb3JlcyhzZWxmLCBYOiBucC5uZGFycmF5LCBjbHVzdGVyX3JhbmdlOiBMaXN0W2ludF0pIC0+IExpc3RbZmxvYXRdOg0KICAgICAgICAiIiINCiAgICAgICAgQ2FsY3VsYXRlIGluZXJ0aWEgKFNTRSkgZm9yIGRpZmZlcmVudCBudW1iZXJzIG9mIGNsdXN0ZXJzIChmb3IgSy1NZWFucykNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIChucC5uZGFycmF5KTogSW5wdXQgZGF0YSB3aXRoIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICBjbHVzdGVyX3JhbmdlIChMaXN0W2ludF0pOiBSYW5nZSBvZiBjbHVzdGVyIG51bWJlcnMgdG8gZXZhbHVhdGUNCiAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgTGlzdFtmbG9hdF06IExpc3Qgb2YgaW5lcnRpYSB2YWx1ZXMNCiAgICAgICAgIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGZyb20gc2tsZWFybi5jbHVzdGVyIGltcG9ydCBLTWVhbnMNCiAgICAgICAgICAgICMg5qOA5p+l5piv5ZCm5pivS01lYW5z5oiW5YW25a2Q57G7DQogICAgICAgICAgICBpZiAia21lYW5zIiBub3QgaW4gc2VsZi5fX2NsYXNzX18uX19uYW1lX18ubG93ZXIoKToNCiAgICAgICAgICAgICAgICB3YXJuaW5ncy53YXJuKGYiY2FsY3VsYXRlX2luZXJ0aWFfc2NvcmVzIGlzIHByaW1hcmlseSBmb3IgS01lYW5zIGFsZ29yaXRobSwgYnV0IHdhcyBjYWxsZWQgb24ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGluZXJ0aWFzID0gW10NCiAgICAgICAgICAgIGZvciBuX2NsdXN0ZXJzIGluIGNsdXN0ZXJfcmFuZ2U6DQogICAgICAgICAgICAgICAga21lYW5zID0gS01lYW5zKA0KICAgICAgICAgICAgICAgICAgICBuX2NsdXN0ZXJzPW5fY2x1c3RlcnMsDQogICAgICAgICAgICAgICAgICAgIHJhbmRvbV9zdGF0ZT1zZWxmLnJhbmRvbV9zdGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgIyDlsJ3or5Xojrflj5ZLTWVhbnPnibnmnInnmoTlj4LmlbANCiAgICAgICAgICAgICAgICAgICAgaW5pdD1nZXRhdHRyKHNlbGYsICdpbml0JywgJ2stbWVhbnMrKycpLA0KICAgICAgICAgICAgICAgICAgICBuX2luaXQ9Z2V0YXR0cihzZWxmLCAnbl9pbml0JywgMTApLA0KICAgICAgICAgICAgICAgICAgICAqKmdldGF0dHIoc2VsZiwgJ2t3YXJncycsIHt9KQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBrbWVhbnMuZml0KFgpDQogICAgICAgICAgICAgICAgaW5lcnRpYXMuYXBwZW5kKGttZWFucy5pbmVydGlhXykNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGluZXJ0aWFzDQogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICAgICAgICAgIHJhaXNlIEltcG9ydEVycm9yKCJza2xlYXJuLmNsdXN0ZXIuS01lYW5zIGlzIHJlcXVpcmVkIGZvciBjYWxjdWxhdGVfaW5lcnRpYV9zY29yZXMiKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiRXJyb3IgY2FsY3VsYXRpbmcgaW5lcnRpYSBzY29yZXM6IHtzdHIoZSl9IikNCg0KICAgIGRlZiBjYWxjdWxhdGVfYmljX3Njb3JlcyhzZWxmLCBYOiBucC5uZGFycmF5LCBjbHVzdGVyX3JhbmdlOiBMaXN0W2ludF0pIC0+IExpc3RbZmxvYXRdOg0KICAgICAgICAiIiINCiAgICAgICAgQ2FsY3VsYXRlIEJJQyBzY29yZXMgZm9yIGRpZmZlcmVudCBudW1iZXJzIG9mIGNsdXN0ZXJzIChmb3IgR01NKQ0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIFggKG5wLm5kYXJyYXkpOiBJbnB1dCBkYXRhIHdpdGggc2hhcGUgKG5fc2FtcGxlcywgbl9mZWF0dXJlcykNCiAgICAgICAgICAgIGNsdXN0ZXJfcmFuZ2UgKExpc3RbaW50XSk6IFJhbmdlIG9mIGNsdXN0ZXIgbnVtYmVycyB0byBldmFsdWF0ZQ0KICAgICAgICAgICAgDQogICAgICAgIFJldHVybnM6DQogICAgICAgICAgICBMaXN0W2Zsb2F0XTogTGlzdCBvZiBCSUMgc2NvcmVzDQogICAgICAgICIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmcm9tIHNrbGVhcm4ubWl4dHVyZSBpbXBvcnQgR2F1c3NpYW5NaXh0dXJlDQogICAgICAgICAgICAjIOajgOafpeaYr+WQpuaYr0dNTeaIluWFtuWtkOexuw0KICAgICAgICAgICAgaWYgImdtbSIgbm90IGluIHNlbGYuX19jbGFzc19fLl9fbmFtZV9fLmxvd2VyKCk6DQogICAgICAgICAgICAgICAgd2FybmluZ3Mud2FybihmImNhbGN1bGF0ZV9iaWNfc2NvcmVzIGlzIHByaW1hcmlseSBmb3IgR01NIGFsZ29yaXRobSwgYnV0IHdhcyBjYWxsZWQgb24ge3NlbGYuX19jbGFzc19fLl9fbmFtZV9ffSIpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGJpY19zY29yZXMgPSBbXQ0KICAgICAgICAgICAgZm9yIG5fY2x1c3RlcnMgaW4gY2x1c3Rlcl9yYW5nZToNCiAgICAgICAgICAgICAgICBnbW0gPSBHYXVzc2lhbk1peHR1cmUoDQogICAgICAgICAgICAgICAgICAgIG5fY29tcG9uZW50cz1uX2NsdXN0ZXJzLA0KICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9c2VsZi5yYW5kb21fc3RhdGUsDQogICAgICAgICAgICAgICAgICAgICMg5bCd6K+V6I635Y+WR01N54m55pyJ55qE5Y+C5pWwDQogICAgICAgICAgICAgICAgICAgIGNvdmFyaWFuY2VfdHlwZT1nZXRhdHRyKHNlbGYsICdjb3ZhcmlhbmNlX3R5cGUnLCAnZnVsbCcpLA0KICAgICAgICAgICAgICAgICAgICBuX2luaXQ9Z2V0YXR0cihzZWxmLCAnbl9pbml0JywgMSksDQogICAgICAgICAgICAgICAgICAgIG1heF9pdGVyPWdldGF0dHIoc2VsZiwgJ21heF9pdGVyJywgMTAwKSwNCiAgICAgICAgICAgICAgICAgICAgKipnZXRhdHRyKHNlbGYsICdrd2FyZ3MnLCB7fSkNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgZ21tLmZpdChYKQ0KICAgICAgICAgICAgICAgIGJpY19zY29yZXMuYXBwZW5kKGdtbS5iaWMoWCkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBiaWNfc2NvcmVzDQogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICAgICAgICAgIHJhaXNlIEltcG9ydEVycm9yKCJza2xlYXJuLm1peHR1cmUuR2F1c3NpYW5NaXh0dXJlIGlzIHJlcXVpcmVkIGZvciBjYWxjdWxhdGVfYmljX3Njb3JlcyIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJFcnJvciBjYWxjdWxhdGluZyBCSUMgc2NvcmVzOiB7c3RyKGUpfSIpDQoNCiAgICBkZWYgY2FsY3VsYXRlX2FpY19zY29yZXMoc2VsZiwgWDogbnAubmRhcnJheSwgY2x1c3Rlcl9yYW5nZTogTGlzdFtpbnRdKSAtPiBMaXN0W2Zsb2F0XToNCiAgICAgICAgIiIiDQogICAgICAgIENhbGN1bGF0ZSBBSUMgc2NvcmVzIGZvciBkaWZmZXJlbnQgbnVtYmVycyBvZiBjbHVzdGVycyAoZm9yIEdNTSkNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIChucC5uZGFycmF5KTogSW5wdXQgZGF0YSB3aXRoIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICBjbHVzdGVyX3JhbmdlIChMaXN0W2ludF0pOiBSYW5nZSBvZiBjbHVzdGVyIG51bWJlcnMgdG8gZXZhbHVhdGUNCiAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgTGlzdFtmbG9hdF06IExpc3Qgb2YgQUlDIHNjb3Jlcw0KICAgICAgICAiIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgZnJvbSBza2xlYXJuLm1peHR1cmUgaW1wb3J0IEdhdXNzaWFuTWl4dHVyZQ0KICAgICAgICAgICAgIyDmo4Dmn6XmmK/lkKbmmK9HTU3miJblhbblrZDnsbsNCiAgICAgICAgICAgIGlmICJnbW0iIG5vdCBpbiBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXy5sb3dlcigpOg0KICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oZiJjYWxjdWxhdGVfYWljX3Njb3JlcyBpcyBwcmltYXJpbHkgZm9yIEdNTSBhbGdvcml0aG0sIGJ1dCB3YXMgY2FsbGVkIG9uIHtzZWxmLl9fY2xhc3NfXy5fX25hbWVfX30iKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBhaWNfc2NvcmVzID0gW10NCiAgICAgICAgICAgIGZvciBuX2NsdXN0ZXJzIGluIGNsdXN0ZXJfcmFuZ2U6DQogICAgICAgICAgICAgICAgZ21tID0gR2F1c3NpYW5NaXh0dXJlKA0KICAgICAgICAgICAgICAgICAgICBuX2NvbXBvbmVudHM9bl9jbHVzdGVycywNCiAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXNlbGYucmFuZG9tX3N0YXRlLA0KICAgICAgICAgICAgICAgICAgICAjIOWwneivleiOt+WPlkdNTeeJueacieeahOWPguaVsA0KICAgICAgICAgICAgICAgICAgICBjb3ZhcmlhbmNlX3R5cGU9Z2V0YXR0cihzZWxmLCAnY292YXJpYW5jZV90eXBlJywgJ2Z1bGwnKSwNCiAgICAgICAgICAgICAgICAgICAgbl9pbml0PWdldGF0dHIoc2VsZiwgJ25faW5pdCcsIDEpLA0KICAgICAgICAgICAgICAgICAgICBtYXhfaXRlcj1nZXRhdHRyKHNlbGYsICdtYXhfaXRlcicsIDEwMCksDQogICAgICAgICAgICAgICAgICAgICoqZ2V0YXR0cihzZWxmLCAna3dhcmdzJywge30pDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGdtbS5maXQoWCkNCiAgICAgICAgICAgICAgICBhaWNfc2NvcmVzLmFwcGVuZChnbW0uYWljKFgpKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gYWljX3Njb3Jlcw0KICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgICAgICAgICByYWlzZSBJbXBvcnRFcnJvcigic2tsZWFybi5taXh0dXJlLkdhdXNzaWFuTWl4dHVyZSBpcyByZXF1aXJlZCBmb3IgY2FsY3VsYXRlX2FpY19zY29yZXMiKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiRXJyb3IgY2FsY3VsYXRpbmcgQUlDIHNjb3Jlczoge3N0cihlKX0iKQ0KICAgIA0KICAgIGRlZiBmaW5kX29wdGltYWxfY2x1c3RlcnMoc2VsZiwgWDogbnAubmRhcnJheSwgbWluX2NsdXN0ZXJzOiBpbnQgPSAyLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF9jbHVzdGVyczogaW50ID0gMTAsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kczogT3B0aW9uYWxbVW5pb25bTGlzdFtzdHJdLCBzdHJdXSA9IE5vbmUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd19wcm9ncmVzczogYm9vbCA9IFRydWUpIC0+IFR1cGxlW2ludCwgRGljdFtzdHIsIExpc3RbZmxvYXRdXV06DQogICAgICAgICIiIg0KICAgICAgICBGaW5kIHRoZSBvcHRpbWFsIG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIFggKG5wLm5kYXJyYXkpOiBJbnB1dCBkYXRhIHdpdGggc2hhcGUgKG5fc2FtcGxlcywgbl9mZWF0dXJlcykNCiAgICAgICAgICAgIG1pbl9jbHVzdGVycyAoaW50KTogTWluaW11bSBudW1iZXIgb2YgY2x1c3RlcnMNCiAgICAgICAgICAgIG1heF9jbHVzdGVycyAoaW50KTogTWF4aW11bSBudW1iZXIgb2YgY2x1c3RlcnMNCiAgICAgICAgICAgIG1ldGhvZHMgKE9wdGlvbmFsW1VuaW9uW0xpc3Rbc3RyXSwgc3RyXV0pOiBMaXN0IG9mIG1ldGhvZHMgdG8gZGV0ZXJtaW5lIHRoZSBvcHRpbWFsIG51bWJlciBvZiBjbHVzdGVycy4gSWYgTm9uZSwgZGVmYXVsdCBtZXRob2RzIGFyZSB1c2VkDQogICAgICAgICAgICBzaG93X3Byb2dyZXNzIChib29sKTogV2hldGhlciB0byBkaXNwbGF5IHByb2dyZXNzDQogICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIFR1cGxlW2ludCwgRGljdFtzdHIsIExpc3RbZmxvYXRdXV06IA0KICAgICAgICAgICAgICAgIC0gaW50OiBPcHRpbWFsIG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICAgICAgICAgIC0gRGljdFtzdHIsIExpc3RbZmxvYXRdXTogRGljdGlvbmFyeSBvZiBzY29yZXMgZm9yIGRpZmZlcmVudCBudW1iZXJzIG9mIGNsdXN0ZXJzDQogICAgICAgICIiIg0KICAgICAgICAjIEJhc2ljIHZhbGlkYXRpb24NCiAgICAgICAgaWYgbWluX2NsdXN0ZXJzIDw9IDA6DQogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJtaW5fY2x1c3RlcnMgbXVzdCBiZSBwb3NpdGl2ZSIpDQogICAgICAgIGlmIG1heF9jbHVzdGVycyA8PSBtaW5fY2x1c3RlcnM6DQogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJtYXhfY2x1c3RlcnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gbWluX2NsdXN0ZXJzIikNCiAgICAgICAgaWYgWC5zaGFwZVswXSA8IG1heF9jbHVzdGVyczoNCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJOdW1iZXIgb2Ygc2FtcGxlcyAoe1guc2hhcGVbMF19KSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBtYXhfY2x1c3RlcnMgKHttYXhfY2x1c3RlcnN9KSIpDQogICAgICAgIA0KICAgICAgICAjIElmIG1ldGhvZHMgaXMgTm9uZSwgdXNlIGRlZmF1bHQgbWV0aG9kcyBmcm9tIHZhbGlkYXRpb24gbW9kdWxlDQogICAgICAgIGlmIG1ldGhvZHMgaXMgTm9uZToNCiAgICAgICAgICAgICMgR2V0IHRoZSBjbHVzdGVyaW5nIGFsZ29yaXRobSBuYW1lIGJ5IGNoZWNraW5nIHRoZSBjbGFzcyBuYW1lDQogICAgICAgICAgICBhbGdvX25hbWUgPSBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXy5sb3dlcigpDQogICAgICAgICAgICAjIFJlbW92ZSAnY2x1c3RlcmluZycgc3VmZml4IGlmIHByZXNlbnQNCiAgICAgICAgICAgIGlmIGFsZ29fbmFtZS5lbmRzd2l0aCgnY2x1c3RlcmluZycpOg0KICAgICAgICAgICAgICAgIGFsZ29fbmFtZSA9IGFsZ29fbmFtZVs6LTEwXQ0KICAgICAgICAgICAgIyBHZXQgZGVmYXVsdCBtZXRob2RzIGZvciB0aGlzIGFsZ29yaXRobQ0KICAgICAgICAgICAgbWV0aG9kcyA9IGdldF9kZWZhdWx0X21ldGhvZHMoYWxnb19uYW1lKQ0KICAgICAgICAgICAgaWYgc2hvd19wcm9ncmVzczoNCiAgICAgICAgICAgICAgICBwcmludChmIlVzaW5nIGRlZmF1bHQgdmFsaWRhdGlvbiBtZXRob2RzIGZvciB7YWxnb19uYW1lfToge21ldGhvZHN9IikNCiAgICAgICAgDQogICAgICAgICMgU2F2ZSBjbHVzdGVyIHJhbmdlDQogICAgICAgIHNlbGYuY2x1c3Rlcl9yYW5nZSA9IGxpc3QocmFuZ2UobWluX2NsdXN0ZXJzLCBtYXhfY2x1c3RlcnMgKyAxKSkNCiAgICAgICAgDQogICAgICAgICMgQ2FsY3VsYXRlIGRpZmZlcmVudCBzY29yZXMNCiAgICAgICAgc2VsZi5zY29yZXM6IERpY3Rbc3RyLCBMaXN0W2Zsb2F0XV0gPSB7fQ0KICAgICAgICANCiAgICAgICAgaWYgc2hvd19wcm9ncmVzczoNCiAgICAgICAgICAgIHByaW50KCJTdGFydGluZyB0byBjYWxjdWxhdGUgZXZhbHVhdGlvbiBtZXRyaWNzIGZvciBkaWZmZXJlbnQgbnVtYmVycyBvZiBjbHVzdGVycy4uLiIpDQogICAgICAgICAgICB0b3RhbCA9IG1heF9jbHVzdGVycyAtIG1pbl9jbHVzdGVycyArIDENCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgYW5kIGNhbGN1bGF0ZSBlYWNoIHZhbGlkYXRpb24gbWV0aG9kDQogICAgICAgIGlmIGlzaW5zdGFuY2UobWV0aG9kcywgc3RyKToNCiAgICAgICAgICAgIG1ldGhvZHMgPSBbbWV0aG9kc10NCiAgICAgICAgICAgIA0KICAgICAgICBmb3IgbWV0aG9kIGluIG1ldGhvZHM6DQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsIGYnY2FsY3VsYXRlX3ttZXRob2R9X3Njb3JlcycpOg0KICAgICAgICAgICAgICAgIGlmIHNob3dfcHJvZ3Jlc3M6DQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQ2FsY3VsYXRpbmcge21ldGhvZH0uLi4iKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIENhbGwgdGhlIHNwZWNpZmljIGNhbGN1bGF0aW9uIG1ldGhvZA0KICAgICAgICAgICAgICAgIGNhbGN1bGF0aW9uX21ldGhvZCA9IGdldGF0dHIoc2VsZiwgZidjYWxjdWxhdGVfe21ldGhvZH1fc2NvcmVzJykNCiAgICAgICAgICAgICAgICBzZWxmLnNjb3Jlc1ttZXRob2RdID0gY2FsY3VsYXRpb25fbWV0aG9kKFgsIHNlbGYuY2x1c3Rlcl9yYW5nZSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBzaG93X3Byb2dyZXNzOg0KICAgICAgICAgICAgICAgICAgICBwcmludChmInttZXRob2QuY2FwaXRhbGl6ZSgpfSBjYWxjdWxhdGlvbiBjb21wbGV0ZWQhIikNCiAgICAgICAgDQogICAgICAgICMgQXV0b21hdGljYWxseSBzZWxlY3QgdGhlIGJlc3QgbnVtYmVyIG9mIGNsdXN0ZXJzDQogICAgICAgIGlmIGxlbihtZXRob2RzKSA9PSAxOg0KICAgICAgICAgICAgYmVzdF9tZXRob2QgPSBtZXRob2RzWzBdDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICAjIFVzZSBjb21iaW5lZCBtZXRob2QNCiAgICAgICAgICAgIGJlc3RfbWV0aG9kID0gJ18nLmpvaW4obWV0aG9kcykNCiAgICAgICAgDQogICAgICAgIGJlc3Rfbl9jbHVzdGVycyA9IHNlbGYuYXV0b19zZWxlY3RfYmVzdF9uX2NsdXN0ZXJzKHNlbGYuc2NvcmVzLCBiZXN0X21ldGhvZCkNCiAgICAgICAgDQogICAgICAgICMgU2V0IHRoZSBiZXN0IG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICBzZWxmLm5fY2x1c3RlcnMgPSBiZXN0X25fY2x1c3RlcnMNCiAgICAgICAgDQogICAgICAgIGlmIHNob3dfcHJvZ3Jlc3M6DQogICAgICAgICAgICBwcmludChmIkF1dG9tYXRpY2FsbHkgc2VsZWN0ZWQgYmVzdCBudW1iZXIgb2YgY2x1c3RlcnM6IHtiZXN0X25fY2x1c3RlcnN9IikNCiAgICAgICAgDQogICAgICAgIHJldHVybiBiZXN0X25fY2x1c3RlcnMsIHNlbGYuc2NvcmVzIA0KICAgIA0KICAgIGRlZiBjYWxjdWxhdGVfc2lsaG91ZXR0ZV9zY29yZXMoc2VsZiwgWDogbnAubmRhcnJheSwgY2x1c3Rlcl9yYW5nZTogTGlzdFtpbnRdKSAtPiBMaXN0W2Zsb2F0XToNCiAgICAgICAgIiIiDQogICAgICAgIENhbGN1bGF0ZSBzaWxob3VldHRlIHNjb3JlcyBmb3IgZGlmZmVyZW50IG51bWJlcnMgb2YgY2x1c3RlcnMNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIChucC5uZGFycmF5KTogSW5wdXQgZGF0YQ0KICAgICAgICAgICAgY2x1c3Rlcl9yYW5nZSAoTGlzdFtpbnRdKTogUmFuZ2Ugb2YgY2x1c3RlciBudW1iZXJzDQogICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIExpc3RbZmxvYXRdOiBMaXN0IG9mIHNpbGhvdWV0dGUgc2NvcmVzDQogICAgICAgICIiIg0KICAgICAgICBzY29yZXMgPSBbXQ0KICAgICAgICBmb3Igbl9jbHVzdGVycyBpbiBjbHVzdGVyX3JhbmdlOg0KICAgICAgICAgICAgIyBDcmVhdGUgdGVtcG9yYXJ5IG1vZGVsDQogICAgICAgICAgICB0ZW1wX21vZGVsID0gc2VsZi5fX2NsYXNzX18obl9jbHVzdGVycz1uX2NsdXN0ZXJzLCByYW5kb21fc3RhdGU9c2VsZi5yYW5kb21fc3RhdGUpDQogICAgICAgICAgICB0ZW1wX21vZGVsLmZpdChYKQ0KICAgICAgICAgICAgbGFiZWxzID0gdGVtcF9tb2RlbC5sYWJlbHNfDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQ2FsY3VsYXRlIHNpbGhvdWV0dGUgc2NvcmUNCiAgICAgICAgICAgIGlmIGxlbihucC51bmlxdWUobGFiZWxzKSkgPiAxOiAgIyBOZWVkIGF0IGxlYXN0IHR3byBjbHVzdGVycw0KICAgICAgICAgICAgICAgIHNjb3JlID0gc2lsaG91ZXR0ZV9zY29yZShYLCBsYWJlbHMpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHNjb3JlID0gMA0KICAgICAgICAgICAgc2NvcmVzLmFwcGVuZChzY29yZSkNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzY29yZXMNCiAgICANCiAgICBkZWYgY2FsY3VsYXRlX2NhbGluc2tpX2hhcmFiYXN6X3Njb3JlcyhzZWxmLCBYOiBucC5uZGFycmF5LCBjbHVzdGVyX3JhbmdlOiBMaXN0W2ludF0pIC0+IExpc3RbZmxvYXRdOg0KICAgICAgICAiIiINCiAgICAgICAgQ2FsY3VsYXRlIENhbGluc2tpLUhhcmFiYXN6IGluZGV4IGZvciBkaWZmZXJlbnQgbnVtYmVycyBvZiBjbHVzdGVycw0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIFggKG5wLm5kYXJyYXkpOiBJbnB1dCBkYXRhDQogICAgICAgICAgICBjbHVzdGVyX3JhbmdlIChMaXN0W2ludF0pOiBSYW5nZSBvZiBjbHVzdGVyIG51bWJlcnMNCiAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgTGlzdFtmbG9hdF06IExpc3Qgb2YgQ2FsaW5za2ktSGFyYWJhc3ogaW5kaWNlcw0KICAgICAgICAiIiINCiAgICAgICAgc2NvcmVzID0gW10NCiAgICAgICAgZm9yIG5fY2x1c3RlcnMgaW4gY2x1c3Rlcl9yYW5nZToNCiAgICAgICAgICAgICMgQ3JlYXRlIHRlbXBvcmFyeSBtb2RlbA0KICAgICAgICAgICAgdGVtcF9tb2RlbCA9IHNlbGYuX19jbGFzc19fKG5fY2x1c3RlcnM9bl9jbHVzdGVycywgcmFuZG9tX3N0YXRlPXNlbGYucmFuZG9tX3N0YXRlKQ0KICAgICAgICAgICAgdGVtcF9tb2RlbC5maXQoWCkNCiAgICAgICAgICAgIGxhYmVscyA9IHRlbXBfbW9kZWwubGFiZWxzXw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENhbGN1bGF0ZSBDYWxpbnNraS1IYXJhYmFzeiBpbmRleA0KICAgICAgICAgICAgaWYgbGVuKG5wLnVuaXF1ZShsYWJlbHMpKSA+IDE6ICAjIE5lZWQgYXQgbGVhc3QgdHdvIGNsdXN0ZXJzDQogICAgICAgICAgICAgICAgc2NvcmUgPSBjYWxpbnNraV9oYXJhYmFzel9zY29yZShYLCBsYWJlbHMpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHNjb3JlID0gMA0KICAgICAgICAgICAgc2NvcmVzLmFwcGVuZChzY29yZSkNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzY29yZXMNCiAgICANCiAgICBkZWYgYXV0b19zZWxlY3RfYmVzdF9uX2NsdXN0ZXJzKHNlbGYsIHNjb3Jlc19kaWN0OiBEaWN0W3N0ciwgTGlzdFtmbG9hdF1dLCBtZXRob2Q6IHN0ciA9ICdzaWxob3VldHRlJykgLT4gaW50Og0KICAgICAgICAiIiINCiAgICAgICAgQXV0b21hdGljYWxseSBzZWxlY3Qgb3B0aW1hbCBudW1iZXIgb2YgY2x1c3RlcnMgYmFzZWQgb24gc2NvcmVzDQogICAgICAgIA0KICAgICAgICBBcmdzOg0KICAgICAgICAgICAgc2NvcmVzX2RpY3QgKERpY3Rbc3RyLCBMaXN0W2Zsb2F0XV0pOiBEaWN0aW9uYXJ5IG9mIHNjb3Jlcywga2V5cyBhcmUgbWV0aG9kIG5hbWVzLCB2YWx1ZXMgYXJlIHNjb3JlIGxpc3RzDQogICAgICAgICAgICBtZXRob2QgKHN0cik6IE1ldGhvZCB0byB1c2UsIG9wdGlvbnMgaW5jbHVkZSAnc2lsaG91ZXR0ZScsICdjYWxpbnNraV9oYXJhYmFzeicsICdlbGJvdycsIGV0Yy4NCiAgICAgICAgICAgICAgICAgICAgSWYgaXQncyBhIGNvbWJpbmF0aW9uIG9mIG1ldGhvZHMsIHVzZSAnXycgdG8gY29ubmVjdCwgZS5nLiwgJ3NpbGhvdWV0dGVfY2FsaW5za2lfaGFyYWJhc3onDQogICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIGludDogT3B0aW1hbCBudW1iZXIgb2YgY2x1c3RlcnMNCiAgICAgICAgIiIiDQogICAgICAgIGlmIG1ldGhvZCBub3QgaW4gc2NvcmVzX2RpY3QgYW5kICdfJyBub3QgaW4gbWV0aG9kOg0KICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIlVua25vd24gc2NvcmluZyBtZXRob2Q6IHttZXRob2R9IikNCiAgICAgICAgDQogICAgICAgICMgSWYgaXQncyBhIHNpbmdsZSBtZXRob2QNCiAgICAgICAgaWYgbWV0aG9kIGluIHNjb3Jlc19kaWN0Og0KICAgICAgICAgICAgc2NvcmVzID0gc2NvcmVzX2RpY3RbbWV0aG9kXQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiBtZXRob2QgaW4gWydzaWxob3VldHRlJywgJ2NhbGluc2tpX2hhcmFiYXN6J106DQogICAgICAgICAgICAgICAgIyBUaGVzZSBtZXRob2RzIGFyZSBiZXR0ZXIgd2l0aCBoaWdoZXIgdmFsdWVzDQogICAgICAgICAgICAgICAgYmVzdF9pZHggPSBucC5hcmdtYXgoc2NvcmVzKQ0KICAgICAgICAgICAgZWxpZiBtZXRob2QgaW4gWydpbmVydGlhJywgJ2JpYycsICdhaWMnXToNCiAgICAgICAgICAgICAgICAjIFRoZXNlIG1ldGhvZHMgYXJlIGJldHRlciB3aXRoIGxvd2VyIHZhbHVlcywgYnV0IG5lZWQgdG8gdXNlIGVsYm93IG1ldGhvZA0KICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIGZpcnN0LW9yZGVyIGRpZmZlcmVuY2VzDQogICAgICAgICAgICAgICAgZGVsdGFzID0gbnAuZGlmZihzY29yZXMpDQogICAgICAgICAgICAgICAgIyBDYWxjdWxhdGUgc2Vjb25kLW9yZGVyIGRpZmZlcmVuY2VzIChlbGJvdyBpcyB1c3VhbGx5IHRoZSBwb2ludCB3aXRoIG1heGltdW0gc2Vjb25kLW9yZGVyIGRpZmZlcmVuY2UpDQogICAgICAgICAgICAgICAgZGVsdGFzMiA9IG5wLmRpZmYoZGVsdGFzKQ0KICAgICAgICAgICAgICAgICMgRWxib3cgaXMgdGhlIHBvaW50IGFmdGVyIHRoZSBtYXhpbXVtIHNlY29uZC1vcmRlciBkaWZmZXJlbmNlDQogICAgICAgICAgICAgICAgYmVzdF9pZHggPSBucC5hcmdtYXgoZGVsdGFzMikgKyAxDQogICAgICAgICAgICAgICAgaWYgYmVzdF9pZHggPj0gbGVuKHNjb3JlcykgLSAxOg0KICAgICAgICAgICAgICAgICAgICBiZXN0X2lkeCA9IGxlbihzY29yZXMpIC0gMiAgIyBDaG9vc2UgdGhlIHNlY29uZC10by1sYXN0IHBvaW50DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgRGVmYXVsdCB0byB1c2luZyBtYXhpbXVtIHZhbHVlDQogICAgICAgICAgICAgICAgYmVzdF9pZHggPSBucC5hcmdtYXgoc2NvcmVzKQ0KICAgICAgICANCiAgICAgICAgIyBJZiBpdCdzIGEgY29tYmluYXRpb24gb2YgbWV0aG9kcw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgbWV0aG9kcyA9IG1ldGhvZC5zcGxpdCgnXycpDQogICAgICAgICAgICByYW5raW5ncyA9IG5wLnplcm9zKGxlbihsaXN0KHNjb3Jlc19kaWN0LnZhbHVlcygpKVswXSkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBtIGluIG1ldGhvZHM6DQogICAgICAgICAgICAgICAgaWYgbSBub3QgaW4gc2NvcmVzX2RpY3Q6DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2NvcmVzID0gc2NvcmVzX2RpY3RbbV0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBtIGluIFsnc2lsaG91ZXR0ZScsICdjYWxpbnNraV9oYXJhYmFzeiddOg0KICAgICAgICAgICAgICAgICAgICAjIENhbGN1bGF0ZSBub3JtYWxpemVkIHJhbmtpbmdzIChoaWdoZXIgaXMgYmV0dGVyKQ0KICAgICAgICAgICAgICAgICAgICBub3JtX3Njb3JlcyA9IChzY29yZXMgLSBucC5taW4oc2NvcmVzKSkgLyAobnAubWF4KHNjb3JlcykgLSBucC5taW4oc2NvcmVzKSArIDFlLTEwKQ0KICAgICAgICAgICAgICAgICAgICByYW5raW5ncyArPSBub3JtX3Njb3Jlcw0KICAgICAgICAgICAgICAgIGVsaWYgbSBpbiBbJ2luZXJ0aWEnLCAnYmljJywgJ2FpYyddOg0KICAgICAgICAgICAgICAgICAgICAjIENhbGN1bGF0ZSBub3JtYWxpemVkIHJhbmtpbmdzIChsb3dlciBpcyBiZXR0ZXIpDQogICAgICAgICAgICAgICAgICAgIG5vcm1fc2NvcmVzID0gMSAtIChzY29yZXMgLSBucC5taW4oc2NvcmVzKSkgLyAobnAubWF4KHNjb3JlcykgLSBucC5taW4oc2NvcmVzKSArIDFlLTEwKQ0KICAgICAgICAgICAgICAgICAgICByYW5raW5ncyArPSBub3JtX3Njb3Jlcw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENob29zZSB0aGUgb25lIHdpdGggaGlnaGVzdCBjb21iaW5lZCByYW5raW5nDQogICAgICAgICAgICBiZXN0X2lkeCA9IG5wLmFyZ21heChyYW5raW5ncykNCiAgICAgICAgDQogICAgICAgICMgQWRkIG1pbl9jbHVzdGVycyBvZmZzZXQNCiAgICAgICAgbWluX2NsdXN0ZXJzID0gbWluKHNlbGYuY2x1c3Rlcl9yYW5nZSkNCiAgICAgICAgYmVzdF9uX2NsdXN0ZXJzID0gYmVzdF9pZHggKyBtaW5fY2x1c3RlcnMNCiAgICAgICAgDQogICAgICAgIHJldHVybiBiZXN0X25fY2x1c3RlcnMgDQogICAgDQogICAgZGVmIHBsb3Rfc2NvcmVzKHNlbGYsIHNjb3Jlc19kaWN0OiBPcHRpb25hbFtEaWN0W3N0ciwgTGlzdFtmbG9hdF1dXSA9IE5vbmUsIG1ldGhvZHM6IE9wdGlvbmFsW1VuaW9uW0xpc3Rbc3RyXSwgc3RyXV0gPSBOb25lLCANCiAgICAgICAgICAgICAgICAgICBtaW5fY2x1c3RlcnM6IGludCA9IDIsIG1heF9jbHVzdGVyczogaW50ID0gMTAsIGZpZ3NpemU6IFR1cGxlW2ludCwgaW50XSA9ICgxMiwgOCksIA0KICAgICAgICAgICAgICAgICAgIHNhdmVfcGF0aDogT3B0aW9uYWxbc3RyXSA9IE5vbmUsIHNob3c6IGJvb2wgPSBUcnVlKToNCiAgICAgICAgIiIiDQogICAgICAgIFBsb3QgdGhlIGV2YWx1YXRpb24gc2NvcmVzIGZvciBkaWZmZXJlbnQgbnVtYmVycyBvZiBjbHVzdGVycw0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIHNjb3Jlc19kaWN0IChPcHRpb25hbFtEaWN0W3N0ciwgTGlzdFtmbG9hdF1dXSk6IERpY3Rpb25hcnkgb2Ygc2NvcmVzLCBrZXlzIGFyZSBtZXRob2QgbmFtZXMsIHZhbHVlcyBhcmUgc2NvcmUgbGlzdHMNCiAgICAgICAgICAgIG1ldGhvZHMgKE9wdGlvbmFsW1VuaW9uW0xpc3Rbc3RyXSwgc3RyXV0pOiBNZXRob2QocykgdG8gcGxvdA0KICAgICAgICAgICAgbWluX2NsdXN0ZXJzIChpbnQpOiBNaW5pbXVtIG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICAgICAgbWF4X2NsdXN0ZXJzIChpbnQpOiBNYXhpbXVtIG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICAgICAgZmlnc2l6ZSAoVHVwbGVbaW50LCBpbnRdKTogRmlndXJlIHNpemUNCiAgICAgICAgICAgIHNhdmVfcGF0aCAoT3B0aW9uYWxbc3RyXSk6IFBhdGggdG8gc2F2ZSB0aGUgZmlndXJlDQogICAgICAgICAgICBzaG93IChib29sKTogV2hldGhlciB0byBzaG93IHRoZSBmaWd1cmUNCiAgICAgICAgIiIiDQogICAgICAgIGltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQNCiAgICAgICAgZnJvbSAuY2x1c3Rlcl92YWxpZGF0aW9uX21ldGhvZHMgaW1wb3J0IGdldF9tZXRob2RfZGVzY3JpcHRpb24sIGdldF9vcHRpbWl6YXRpb25fZGlyZWN0aW9uDQogICAgICAgIA0KICAgICAgICAjIElmIHNjb3Jlc19kaWN0IGlzIG5vdCBwcm92aWRlZCwgdXNlIHNlbGYuc2NvcmVzDQogICAgICAgIGlmIHNjb3Jlc19kaWN0IGlzIE5vbmU6DQogICAgICAgICAgICBzY29yZXNfZGljdCA9IHNlbGYuc2NvcmVzDQogICAgICAgIA0KICAgICAgICAjIElmIG1ldGhvZHMgaXMgbm90IHByb3ZpZGVkIG9yIE5vbmUsIHVzZSBhbGwgbWV0aG9kcyBpbiBzY29yZXNfZGljdA0KICAgICAgICBpZiBtZXRob2RzIGlzIE5vbmU6DQogICAgICAgICAgICBtZXRob2RzID0gbGlzdChzY29yZXNfZGljdC5rZXlzKCkpDQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShtZXRob2RzLCBzdHIpOg0KICAgICAgICAgICAgbWV0aG9kcyA9IFttZXRob2RzXQ0KICAgICAgICANCiAgICAgICAgIyBJZiBjbHVzdGVyX3JhbmdlIGlzIG5vdCBwcm92aWRlZCwgdXNlIHJhbmdlKG1pbl9jbHVzdGVycywgbWF4X2NsdXN0ZXJzICsgMSkNCiAgICAgICAgaWYgc2VsZi5jbHVzdGVyX3JhbmdlIGlzIE5vbmU6DQogICAgICAgICAgICBzZWxmLmNsdXN0ZXJfcmFuZ2UgPSBsaXN0KHJhbmdlKG1pbl9jbHVzdGVycywgbWF4X2NsdXN0ZXJzICsgMSkpDQogICAgICAgIA0KICAgICAgICAjIENyZWF0ZSBmaWd1cmUNCiAgICAgICAgbl9tZXRob2RzID0gbGVuKG1ldGhvZHMpDQogICAgICAgIGlmIG5fbWV0aG9kcyA9PSAxOg0KICAgICAgICAgICAgZmlnLCBheGVzID0gcGx0LnN1YnBsb3RzKDEsIDEsIGZpZ3NpemU9Zmlnc2l6ZSkNCiAgICAgICAgICAgIGF4ZXMgPSBbYXhlc10gICMgTWFrZSBpdCBpbnRvIGEgbGlzdCBmb3IgY29uc2lzdGVudCBhY2Nlc3MNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGZpZywgYXhlcyA9IHBsdC5zdWJwbG90cygxLCBuX21ldGhvZHMsIGZpZ3NpemU9Zmlnc2l6ZSkNCiAgICAgICAgDQogICAgICAgICMgR2V0IGNsdXN0ZXJpbmcgYWxnb3JpdGhtIG5hbWUNCiAgICAgICAgYWxnb19uYW1lID0gc2VsZi5fX2NsYXNzX18uX19uYW1lX18ubG93ZXIoKQ0KICAgICAgICBpZiBhbGdvX25hbWUuZW5kc3dpdGgoJ2NsdXN0ZXJpbmcnKToNCiAgICAgICAgICAgIGFsZ29fbmFtZSA9IGFsZ29fbmFtZVs6LTEwXQ0KICAgICAgICANCiAgICAgICAgIyBQbG90IGVhY2ggbWV0aG9kDQogICAgICAgIGZvciBpLCBtZXRob2QgaW4gZW51bWVyYXRlKG1ldGhvZHMpOg0KICAgICAgICAgICAgaWYgbWV0aG9kIG5vdCBpbiBzY29yZXNfZGljdDoNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBheCA9IGF4ZXNbaV0NCiAgICAgICAgICAgIHNjb3JlcyA9IHNjb3Jlc19kaWN0W21ldGhvZF0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBQbG90IHNjb3JlIGN1cnZlDQogICAgICAgICAgICBheC5wbG90KHNlbGYuY2x1c3Rlcl9yYW5nZSwgc2NvcmVzLCAnby0nLCBsaW5ld2lkdGg9MiwgbWFya2Vyc2l6ZT04KQ0KDQogICAgICAgICAgICAjIEdldCBvcHRpbWl6YXRpb24gZGlyZWN0aW9uIGZvciB0aGlzIG1ldGhvZA0KICAgICAgICAgICAgb3B0aW1pemF0aW9uID0gZ2V0X29wdGltaXphdGlvbl9kaXJlY3Rpb24oYWxnb19uYW1lLCBtZXRob2QpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgTWFyayBvcHRpbWFsIG51bWJlciBvZiBjbHVzdGVycw0KICAgICAgICAgICAgaWYgb3B0aW1pemF0aW9uID09ICdtYXhpbWl6ZSc6DQogICAgICAgICAgICAgICAgIyBGb3IgbWV0aG9kcyB3aGVyZSBoaWdoZXIgaXMgYmV0dGVyDQogICAgICAgICAgICAgICAgYmVzdF9pZHggPSBucC5hcmdtYXgoc2NvcmVzKQ0KICAgICAgICAgICAgICAgIGJlc3Rfc2NvcmUgPSBzY29yZXNbYmVzdF9pZHhdDQogICAgICAgICAgICAgICAgY3JpdGVyaW9uID0gIk1heGltdW0gVmFsdWUiDQogICAgICAgICAgICBlbGlmIG9wdGltaXphdGlvbiA9PSAnbWluaW1pemUnOg0KICAgICAgICAgICAgICAgICMgRm9yIG1ldGhvZHMgd2hlcmUgbG93ZXIgaXMgYmV0dGVyLCB1c2UgZWxib3cgbWV0aG9kDQogICAgICAgICAgICAgICAgIyBDYWxjdWxhdGUgZmlyc3Qtb3JkZXIgZGlmZmVyZW5jZXMNCiAgICAgICAgICAgICAgICBkZWx0YXMgPSBucC5kaWZmKHNjb3JlcykNCiAgICAgICAgICAgICAgICAjIENhbGN1bGF0ZSBzZWNvbmQtb3JkZXIgZGlmZmVyZW5jZXMgKGVsYm93IGlzIHVzdWFsbHkgdGhlIHBvaW50IHdpdGggbWF4aW11bSBzZWNvbmQtb3JkZXIgZGlmZmVyZW5jZSkNCiAgICAgICAgICAgICAgICBkZWx0YXMyID0gbnAuZGlmZihkZWx0YXMpDQogICAgICAgICAgICAgICAgIyBFbGJvdyBpcyB0aGUgcG9pbnQgYWZ0ZXIgdGhlIG1heGltdW0gc2Vjb25kLW9yZGVyIGRpZmZlcmVuY2UNCiAgICAgICAgICAgICAgICBiZXN0X2lkeCA9IG5wLmFyZ21heChkZWx0YXMyKSArIDENCiAgICAgICAgICAgICAgICBpZiBiZXN0X2lkeCA+PSBsZW4oc2NvcmVzKSAtIDE6DQogICAgICAgICAgICAgICAgICAgIGJlc3RfaWR4ID0gbGVuKHNjb3JlcykgLSAyDQogICAgICAgICAgICAgICAgYmVzdF9zY29yZSA9IHNjb3Jlc1tiZXN0X2lkeF0NCiAgICAgICAgICAgICAgICBjcml0ZXJpb24gPSAiRWxib3cgTWV0aG9kIg0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAjIERlZmF1bHQgdG8gdXNpbmcgbWF4aW11bSB2YWx1ZQ0KICAgICAgICAgICAgICAgIGJlc3RfaWR4ID0gbnAuYXJnbWF4KHNjb3JlcykNCiAgICAgICAgICAgICAgICBiZXN0X3Njb3JlID0gc2NvcmVzW2Jlc3RfaWR4XQ0KICAgICAgICAgICAgICAgIGNyaXRlcmlvbiA9ICJNYXhpbXVtIFZhbHVlIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBiZXN0X25fY2x1c3RlcnMgPSBzZWxmLmNsdXN0ZXJfcmFuZ2VbYmVzdF9pZHhdDQogICAgICAgICAgICBheC5wbG90KGJlc3Rfbl9jbHVzdGVycywgYmVzdF9zY29yZSwgJ3J4JywgbWFya2Vyc2l6ZT0xMiwgbWFya2VyZWRnZXdpZHRoPTMpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgU2V0IHRpdGxlIGFuZCBsYWJlbHMNCiAgICAgICAgICAgIG1ldGhvZF9kZXNjID0gZ2V0X21ldGhvZF9kZXNjcmlwdGlvbihhbGdvX25hbWUsIG1ldGhvZCkNCiAgICAgICAgICAgIGF4LnNldF90aXRsZShmInttZXRob2RfZGVzY31cbkJlc3Qgbl9jbHVzdGVycyA9IHtiZXN0X25fY2x1c3RlcnN9ICh7Y3JpdGVyaW9ufSkiKQ0KICAgICAgICAgICAgYXguc2V0X3hsYWJlbCgiTnVtYmVyIG9mIGNsdXN0ZXJzIikNCiAgICAgICAgICAgIGF4LnNldF95bGFiZWwoZiJ7bWV0aG9kLmNhcGl0YWxpemUoKX0gU2NvcmUiKQ0KICAgICAgICAgICAgYXguZ3JpZChUcnVlKQ0KICAgICAgICANCiAgICAgICAgIyBBZGp1c3QgbGF5b3V0DQogICAgICAgIHBsdC50aWdodF9sYXlvdXQoKQ0KICAgICAgICANCiAgICAgICAgIyBTYXZlIGZpZ3VyZSBpZiBuZWVkZWQNCiAgICAgICAgaWYgc2F2ZV9wYXRoIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcGx0LnNhdmVmaWcoc2F2ZV9wYXRoLCBkcGk9MzAwLCBiYm94X2luY2hlcz0ndGlnaHQnKQ0KICAgICAgICANCiAgICAgICAgIyBTaG93IGZpZ3VyZSBpZiBuZWVkZWQNCiAgICAgICAgaWYgc2hvdzoNCiAgICAgICAgICAgIHBsdC5zaG93KCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHBsdC5jbG9zZSgpIA==').decode())
