
import base64
exec(base64.b64decode(b'IiIiClBsb3R0aW5nIE1vZHVsZQpQcm92aWRlcyB2YXJpb3VzIGV2YWx1YXRpb24gY2hhcnQgcGxvdHRpbmcgZnVuY3Rpb25zCiIiIgoKaW1wb3J0IG9zCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBUdXBsZSwgVW5pb24sIEFueQppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgc2VhYm9ybiBhcyBzbnMKaW1wb3J0IHNoYXAKZnJvbSBza2xlYXJuLm1ldHJpY3MgaW1wb3J0IHJvY19jdXJ2ZSwgcHJlY2lzaW9uX3JlY2FsbF9jdXJ2ZSwgY29uZnVzaW9uX21hdHJpeApmcm9tIHNrbGVhcm4uY2FsaWJyYXRpb24gaW1wb3J0IGNhbGlicmF0aW9uX2N1cnZlICAjIENhbGlicmF0aW9uIGN1cnZlIHJlbGF0ZWQKZnJvbSAuLmV2YWx1YXRpb24ubWV0cmljcyBpbXBvcnQgY2FsY3VsYXRlX25ldF9iZW5lZml0CmZyb20gLi4uLnV0aWxzLnZpc3VhbGl6YXRpb25fdXRpbHMgaW1wb3J0IHByb2Nlc3Nfc2hhcF9leHBsYW5hdGlvbgoKY2xhc3MgUGxvdHRlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBvdXRwdXRfZGlyOiBzdHIsIGRwaTogaW50ID0gNjAwKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIHBsb3R0ZXIKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBvdXRwdXRfZGlyIChzdHIpOiBPdXRwdXQgZGlyZWN0b3J5IHBhdGgKICAgICAgICAgICAgZHBpIChpbnQpOiBSZXNvbHV0aW9uIGZvciBub24tUERGIGZvcm1hdCBpbWFnZXMKICAgICAgICAiIiIKICAgICAgICBzZWxmLm91dHB1dF9kaXIgPSBvdXRwdXRfZGlyCiAgICAgICAgc2VsZi5kcGkgPSBkcGkKICAgICAgICBvcy5tYWtlZGlycyhvdXRwdXRfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgIAogICAgICAgICMgU2V0IHBsb3R0aW5nIHN0eWxlCiAgICAgICAgIyBwbHQuc3R5bGUudXNlKCdzZWFib3JuJykKICAgICAgICAjIHNucy5zZXRfY29udGV4dCgicGFwZXIiLCBmb250X3NjYWxlPTEuMikKICAgICAgICAKICAgIGRlZiBwbG90X3JvY192MihzZWxmLCBtb2RlbHNfZGF0YTogRGljdFtzdHIsIFR1cGxlW25wLm5kYXJyYXksIG5wLm5kYXJyYXldXSwgc2F2ZV9uYW1lOiBzdHIgPSAnUk9DLnBkZicsIHRpdGxlOiBzdHIgPSAndGVzdCcpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUGxvdCBST0MgY3VydmVzIGZvciBhIHNpbmdsZSBkYXRhc2V0IChvcHRpbWl6ZWQgdmVyc2lvbikKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtb2RlbHNfZGF0YTogRGljdGlvbmFyeSB3aXRoIG1vZGVsIG5hbWVzIGFzIGtleXMgYW5kICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgdHVwbGVzIGFzIHZhbHVlcwogICAgICAgICAgICBzYXZlX25hbWU6IE5hbWUgb2YgdGhlIGZpbGUgdG8gc2F2ZSB0aGUgcGxvdAogICAgICAgICAgICB0aXRsZTogRGF0YSB0eXBlIGZvciB0aXRsZSBkaXNwbGF5ICgndHJhaW4nIG9yICd0ZXN0JykKICAgICAgICAiIiIKICAgICAgICAjIENyZWF0ZSBmaWd1cmUKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDgsIDgpKQogICAgICAgIAogICAgICAgICMgUGxvdCBST0MgY3VydmVzIGZvciBlYWNoIG1vZGVsCiAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gbW9kZWxzX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgZnByLCB0cHIsIF8gPSByb2NfY3VydmUoeV90cnVlLCB5X3ByZWRfcHJvYmEpCiAgICAgICAgICAgIGF1YyA9IG5wLnRyYXB6KHRwciwgZnByKQogICAgICAgICAgICBwbHQucGxvdChmcHIsIHRwciwgbGFiZWw9Zid7bW9kZWxfbmFtZX0gKEFVQyA9IHthdWM6LjNmfSknLCBsaW5ld2lkdGg9MS41KQogICAgICAgIAogICAgICAgICMgQWRkIGRpYWdvbmFsIGxpbmUKICAgICAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgJ2stLScsIGxpbmV3aWR0aD0xLjUpCiAgICAgICAgcGx0LnhsaW0oWy0wLjAyLCAxLjAyXSkKICAgICAgICBwbHQueWxpbShbLTAuMDIsIDEuMDJdKQogICAgICAgIHBsdC54bGFiZWwoJ0ZhbHNlIFBvc2l0aXZlIFJhdGUnLCBmb250c2l6ZT0xMikKICAgICAgICBwbHQueWxhYmVsKCdUcnVlIFBvc2l0aXZlIFJhdGUnLCBmb250c2l6ZT0xMikKICAgICAgICAKICAgICAgICAjIFNldCB0aXRsZSBiYXNlZCBvbiBkYXRhIHR5cGUKICAgICAgICB0aXRsZSA9IGYie3RpdGxlfSBTZXQgUk9DIEN1cnZlcyIKICAgICAgICBwbHQudGl0bGUodGl0bGUsIGZvbnRzaXplPTE0KQogICAgICAgIHBsdC5sZWdlbmQobG9jPSJsb3dlciByaWdodCIpCiAgICAgICAgCiAgICAgICAgcGx0LmdyaWQoVHJ1ZSwgbGluZXN0eWxlPSctLScsIGFscGhhPTAuNykKICAgICAgICBwbHQuZ2NhKCkuc2V0X2ZhY2Vjb2xvcignI2Y4ZjlmYScpCiAgICAgICAgCiAgICAgICAgIyBPbmx5IHNob3cgbGVmdCBhbmQgYm90dG9tIHNwaW5lcyBhbmQgc2V0IHRoZWlyIHdpZHRoIHRvIDEuNQogICAgICAgIGF4ID0gcGx0LmdjYSgpCiAgICAgICAgYXguc3BpbmVzWyd0b3AnXS5zZXRfdmlzaWJsZShGYWxzZSkKICAgICAgICBheC5zcGluZXNbJ3JpZ2h0J10uc2V0X3Zpc2libGUoRmFsc2UpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfdmlzaWJsZShUcnVlKQogICAgICAgIGF4LnNwaW5lc1snbGVmdCddLnNldF92aXNpYmxlKFRydWUpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfbGluZXdpZHRoKDEuNSkKICAgICAgICBheC5zcGluZXNbJ2xlZnQnXS5zZXRfbGluZXdpZHRoKDEuNSkKICAgICAgICAKICAgICAgICAjIFNhdmUgZmlndXJlCiAgICAgICAgcGx0LnRpZ2h0X2xheW91dCgpCiAgICAgICAgCiAgICAgICAgIyDmoLnmja7mlofku7bmianlsZXlkI3lhrPlrprmmK/lkKblupTnlKjljovnvKnlkoxEUEnorr7nva4KICAgICAgICBmaWxlX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoc2F2ZV9uYW1lKVsxXS5sb3dlcigpCiAgICAgICAgaWYgZmlsZV9leHQgPT0gJy5wZGYnOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgICAgIGVsaWYgZmlsZV9leHQgaW4gWycudGlmJywgJy50aWZmJ106CiAgICAgICAgICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihzZWxmLm91dHB1dF9kaXIsIHNhdmVfbmFtZSksIGJib3hfaW5jaGVzPSd0aWdodCcsIAogICAgICAgICAgICAgICAgICAgICAgICBkcGk9c2VsZi5kcGksIGZvcm1hdD0ndGlmJywgY29tcHJlc3Npb249J3RpZmZfbHp3JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpKQogICAgICAgIAogICAgICAgIHBsdC5jbG9zZSgpCiAgICAgIAogICAgZGVmIHBsb3RfZGNhX3YyKHNlbGYsIG1vZGVsc19kYXRhOiBEaWN0W3N0ciwgVHVwbGVbbnAubmRhcnJheSwgbnAubmRhcnJheV1dLCBzYXZlX25hbWU6IHN0ciA9ICdEQ0EucGRmJywgdGl0bGU6IHN0ciA9ICd0ZXN0JykgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBQbG90IERlY2lzaW9uIEN1cnZlIEFuYWx5c2lzIChEQ0EpIGZvciBhIHNpbmdsZSBkYXRhc2V0IChvcHRpbWl6ZWQgdmVyc2lvbikKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtb2RlbHNfZGF0YTogRGljdGlvbmFyeSB3aXRoIG1vZGVsIG5hbWVzIGFzIGtleXMgYW5kICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgdHVwbGVzIGFzIHZhbHVlcwogICAgICAgICAgICBzYXZlX25hbWU6IE5hbWUgb2YgdGhlIGZpbGUgdG8gc2F2ZSB0aGUgcGxvdAogICAgICAgICAgICB0aXRsZTogRGF0YSB0eXBlIGZvciB0aXRsZSBkaXNwbGF5ICgndHJhaW4nIG9yICd0ZXN0JykKICAgICAgICAiIiIKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDgsIDgpKQogICAgICAgIAogICAgICAgICMgRGVmaW5lIHRocmVzaG9sZCByYW5nZQogICAgICAgIHRocmVzaG9sZHMgPSBucC5saW5zcGFjZSgwLCAxLCAxMDApCiAgICAgICAgCiAgICAgICAgIyBFeHRyYWN0IHlfdHJ1ZSBhcyByZWZlcmVuY2UgKGFueSBtb2RlbCBjYW4gYmUgdXNlZCBzaW5jZSB5X3RydWUgc2hvdWxkIGJlIGNvbnNpc3RlbnQpCiAgICAgICAgaWYgbm90IG1vZGVsc19kYXRhOgogICAgICAgICAgICBwcmludCgiTm8gZGF0YSBwcm92aWRlZCBmb3IgRENBIHBsb3QiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIOajgOa1i+aooeWei+eahOi+k+WHuuamgueOh+aYr+WQpui2hei/hzAtMe+8jOWmguaenOi2hei/h+WImei/m+ihjOW9kuS4gOWMlgogICAgICAgIGZvciBtb2RlbF9uYW1lLCAoeV90cnVlLCB5X3ByZWRfcHJvYmEpIGluIG1vZGVsc19kYXRhLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG5wLmFueSh5X3ByZWRfcHJvYmEgPiAxKSBvciBucC5hbnkoeV9wcmVkX3Byb2JhIDwgMCk6CiAgICAgICAgICAgICAgICBwcmludChmIldhcm5pbmc6IE1vZGVsIHttb2RlbF9uYW1lfSBoYXMgcHJlZGljdGVkIHByb2JhYmlsaXRpZXMgb3V0c2lkZSBbMCwgMV0iKQogICAgICAgICAgICAgICAgeV9wcmVkX3Byb2JhID0gKHlfcHJlZF9wcm9iYSAtIG5wLm1pbih5X3ByZWRfcHJvYmEpKSAvIChucC5tYXgoeV9wcmVkX3Byb2JhKSAtIG5wLm1pbih5X3ByZWRfcHJvYmEpKQogICAgICAgICAgICAgICAgbW9kZWxzX2RhdGFbbW9kZWxfbmFtZV0gPSAoeV90cnVlLCB5X3ByZWRfcHJvYmEpCiAgICAgICAgeV90cnVlID0gbmV4dChpdGVyKG1vZGVsc19kYXRhLnZhbHVlcygpKSlbMF0KICAgICAgICAKICAgICAgICAjIENhbGN1bGF0ZSBhbmQgcGxvdCAiVHJlYXQgQWxsIiBjdXJ2ZQogICAgICAgIG5ldF9iZW5lZml0X2FsbCA9IG5wLmFycmF5KFtjYWxjdWxhdGVfbmV0X2JlbmVmaXQoeV90cnVlLCBucC5vbmVzX2xpa2UoeV90cnVlKSwgdCkgZm9yIHQgaW4gdGhyZXNob2xkc10pCiAgICAgICAgcGx0LnBsb3QodGhyZXNob2xkcywgbmV0X2JlbmVmaXRfYWxsLCAnay0tJywgbGFiZWw9J1RyZWF0IEFsbCcsIGxpbmV3aWR0aD0xLjUpCiAgICAgICAgCiAgICAgICAgIyBDYWxjdWxhdGUgYW5kIHBsb3QgIlRyZWF0IE5vbmUiIGN1cnZlCiAgICAgICAgbmV0X2JlbmVmaXRfbm9uZSA9IG5wLmFycmF5KFtjYWxjdWxhdGVfbmV0X2JlbmVmaXQoeV90cnVlLCBucC56ZXJvc19saWtlKHlfdHJ1ZSksIHQpIGZvciB0IGluIHRocmVzaG9sZHNdKQogICAgICAgIHBsdC5wbG90KHRocmVzaG9sZHMsIG5ldF9iZW5lZml0X25vbmUsICdrLScsIGxhYmVsPSdUcmVhdCBOb25lJywgbGluZXdpZHRoPTEuNSkKICAgICAgICAKICAgICAgICAjIFBsb3QgZGVjaXNpb24gY3VydmVzIGZvciBlYWNoIG1vZGVsCiAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gbW9kZWxzX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgbmV0X2JlbmVmaXRzID0gbnAuYXJyYXkoW2NhbGN1bGF0ZV9uZXRfYmVuZWZpdCh5X3RydWUsIHlfcHJlZF9wcm9iYSwgdCkgZm9yIHQgaW4gdGhyZXNob2xkc10pCiAgICAgICAgICAgIHBsdC5wbG90KHRocmVzaG9sZHMsIG5ldF9iZW5lZml0cywgJy0nLCBsaW5ld2lkdGg9MS41LCBsYWJlbD1tb2RlbF9uYW1lKQogICAgICAgIAogICAgICAgICMgQmVhdXRpZnkgdGhlIHBsb3QKICAgICAgICBwbHQueGxhYmVsKCdUaHJlc2hvbGQgUHJvYmFiaWxpdHknLCBmb250c2l6ZT0xMikKICAgICAgICBwbHQueWxhYmVsKCdOZXQgQmVuZWZpdCcsIGZvbnRzaXplPTEyKQogICAgICAgIHRpdGxlID0gZiJ7J1RyYWluaW5nJyBpZiB0aXRsZS5sb3dlcigpID09ICd0cmFpbicgZWxzZSAnVGVzdGluZyd9IFNldCBEZWNpc2lvbiBDdXJ2ZSBBbmFseXNpcyIKICAgICAgICBwbHQudGl0bGUodGl0bGUsIGZvbnRzaXplPTE0KQogICAgICAgIHBsdC5ncmlkKFRydWUsIGxpbmVzdHlsZT0nLS0nLCBhbHBoYT0wLjcpCiAgICAgICAgcGx0LmdjYSgpLnNldF9mYWNlY29sb3IoJyNmOGY5ZmEnKQogICAgICAgIHBsdC5sZWdlbmQobG9jPSdiZXN0JykKICAgICAgICAKICAgICAgICAjIE9ubHkgc2hvdyBsZWZ0IGFuZCBib3R0b20gc3BpbmVzIGFuZCBzZXQgdGhlaXIgd2lkdGggdG8gMS41CiAgICAgICAgYXggPSBwbHQuZ2NhKCkKICAgICAgICBheC5zcGluZXNbJ3RvcCddLnNldF92aXNpYmxlKEZhbHNlKQogICAgICAgIGF4LnNwaW5lc1sncmlnaHQnXS5zZXRfdmlzaWJsZShGYWxzZSkKICAgICAgICBheC5zcGluZXNbJ2JvdHRvbSddLnNldF92aXNpYmxlKFRydWUpCiAgICAgICAgYXguc3BpbmVzWydsZWZ0J10uc2V0X3Zpc2libGUoVHJ1ZSkKICAgICAgICBheC5zcGluZXNbJ2JvdHRvbSddLnNldF9saW5ld2lkdGgoMS41KQogICAgICAgIGF4LnNwaW5lc1snbGVmdCddLnNldF9saW5ld2lkdGgoMS41KQogICAgICAgIAogICAgICAgICMgU2FmZWx5IHNldCB5LWF4aXMgcmFuZ2UsIGhhbmRsaW5nIHBvc3NpYmxlIE5hTiBvciBJbmYKICAgICAgICB5X21pbiA9IC0wLjA1ICAjIERlZmF1bHQgbWluaW11bQogICAgICAgIHlfbWF4ID0gMC41ICAgICMgRGVmYXVsdCBtYXhpbXVtCiAgICAgICAgCiAgICAgICAgIyBTYWZlbHkgZ2V0IG1pbmltdW0gb2YgbmV0X2JlbmVmaXRfbm9uZQogICAgICAgIGlmIGxlbihuZXRfYmVuZWZpdF9ub25lKSA+IDAgYW5kIG5wLmlzZmluaXRlKG5ldF9iZW5lZml0X25vbmUpLmFueSgpOgogICAgICAgICAgICBub25lX21pbiA9IG5wLm5hbm1pbihuZXRfYmVuZWZpdF9ub25lW25wLmlzZmluaXRlKG5ldF9iZW5lZml0X25vbmUpXSkKICAgICAgICAgICAgaWYgbnAuaXNmaW5pdGUobm9uZV9taW4pOgogICAgICAgICAgICAgICAgeV9taW4gPSBtaW4oeV9taW4sIG5vbmVfbWluKQogICAgICAgIAogICAgICAgICMgU2FmZWx5IGdldCBtYXhpbXVtIG9mIG5ldF9iZW5lZml0X2FsbAogICAgICAgIGlmIGxlbihuZXRfYmVuZWZpdF9hbGwpID4gMCBhbmQgbnAuaXNmaW5pdGUobmV0X2JlbmVmaXRfYWxsKS5hbnkoKToKICAgICAgICAgICAgYWxsX21heCA9IG5wLm5hbm1heChuZXRfYmVuZWZpdF9hbGxbbnAuaXNmaW5pdGUobmV0X2JlbmVmaXRfYWxsKV0pCiAgICAgICAgICAgIGlmIG5wLmlzZmluaXRlKGFsbF9tYXgpOgogICAgICAgICAgICAgICAgeV9tYXggPSBtYXgoeV9tYXgsIGFsbF9tYXggKyAwLjEpCiAgICAgICAgCiAgICAgICAgcGx0LnlsaW0oW3lfbWluLCB5X21heF0pCiAgICAgICAgCiAgICAgICAgIyBTYXZlIGltYWdlCiAgICAgICAgcGx0LnRpZ2h0X2xheW91dCgpCiAgICAgICAgCiAgICAgICAgIyDmoLnmja7mlofku7bmianlsZXlkI3lhrPlrprmmK/lkKblupTnlKjljovnvKnlkoxEUEnorr7nva4KICAgICAgICBmaWxlX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoc2F2ZV9uYW1lKVsxXS5sb3dlcigpCiAgICAgICAgaWYgZmlsZV9leHQgPT0gJy5wZGYnOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgICAgIGVsaWYgZmlsZV9leHQgaW4gWycudGlmJywgJy50aWZmJ106CiAgICAgICAgICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihzZWxmLm91dHB1dF9kaXIsIHNhdmVfbmFtZSksIGJib3hfaW5jaGVzPSd0aWdodCcsIAogICAgICAgICAgICAgICAgICAgICAgICBkcGk9c2VsZi5kcGksIGZvcm1hdD0ndGlmJywgY29tcHJlc3Npb249J3RpZmZfbHp3JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpKQogICAgICAgIAogICAgICAgIHBsdC5jbG9zZSgpCiAgICAKICAgIGRlZiBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoc2VsZiwgeV90cnVlOiBucC5uZGFycmF5LCB5X3ByZWQ6IG5wLm5kYXJyYXksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVfbmFtZTogc3RyID0gJ0NvbmZ1c2lvbl9NYXRyaXgucGRmJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHN0ciA9ICdDb25mdXNpb24gTWF0cml4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19uYW1lczogTGlzdFtzdHJdID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemU6IGJvb2wgPSBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWFwOiBzdHIgPSAnQmx1ZXMnKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIFBsb3QgY29uZnVzaW9uIG1hdHJpeAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHlfdHJ1ZSAobnAubmRhcnJheSk6IFRydWUgbGFiZWxzCiAgICAgICAgICAgIHlfcHJlZCAobnAubmRhcnJheSk6IFByZWRpY3RlZCBsYWJlbHMKICAgICAgICAgICAgc2F2ZV9uYW1lIChzdHIpOiBOYW1lIG9mIHRoZSBmaWxlIHRvIHNhdmUgdGhlIHBsb3QKICAgICAgICAgICAgdGl0bGUgKHN0cik6IFRpdGxlIG9mIHRoZSBwbG90CiAgICAgICAgICAgIGNsYXNzX25hbWVzIChMaXN0W3N0cl0pOiBOYW1lcyBvZiB0aGUgY2xhc3NlcyAoZGVmYXVsdDogTm9uZSwgd2lsbCB1c2UgJzAnLCAnMScgZm9yIGJpbmFyeSBjbGFzc2lmaWNhdGlvbikKICAgICAgICAgICAgbm9ybWFsaXplIChib29sKTogV2hldGhlciB0byBub3JtYWxpemUgdGhlIGNvbmZ1c2lvbiBtYXRyaXggKGRlZmF1bHQ6IEZhbHNlKQogICAgICAgICAgICBjbWFwIChzdHIpOiBDb2xvcm1hcCB0byB1c2UgKGRlZmF1bHQ6ICdCbHVlcycpCiAgICAgICAgIiIiCiAgICAgICAgIyBDYWxjdWxhdGUgY29uZnVzaW9uIG1hdHJpeAogICAgICAgIGNtID0gY29uZnVzaW9uX21hdHJpeCh5X3RydWUsIHlfcHJlZCkKICAgICAgICAKICAgICAgICAjIFNldCBjbGFzcyBuYW1lcyBpZiBub3QgcHJvdmlkZWQKICAgICAgICBpZiBjbGFzc19uYW1lcyBpcyBOb25lOgogICAgICAgICAgICBpZiBjbS5zaGFwZVswXSA9PSAyOiAgIyBCaW5hcnkgY2xhc3NpZmljYXRpb24KICAgICAgICAgICAgICAgIGNsYXNzX25hbWVzID0gWydOZWdhdGl2ZScsICdQb3NpdGl2ZSddCiAgICAgICAgICAgIGVsc2U6ICAjIE11bHRpLWNsYXNzIGNsYXNzaWZpY2F0aW9uCiAgICAgICAgICAgICAgICBjbGFzc19uYW1lcyA9IFtzdHIoaSkgZm9yIGkgaW4gcmFuZ2UoY20uc2hhcGVbMF0pXQogICAgICAgIAogICAgICAgICMgTm9ybWFsaXplIHRoZSBjb25mdXNpb24gbWF0cml4IGlmIHJlcXVlc3RlZAogICAgICAgIGlmIG5vcm1hbGl6ZToKICAgICAgICAgICAgY20gPSBjbS5hc3R5cGUoJ2Zsb2F0JykgLyBjbS5zdW0oYXhpcz0xKVs6LCBucC5uZXdheGlzXQogICAgICAgICAgICBmbXQgPSAnLjJmJwogICAgICAgICAgICB0aXRsZSA9IGYnTm9ybWFsaXplZCB7dGl0bGV9JwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZtdCA9ICdkJwogICAgICAgIAogICAgICAgICMgQ3JlYXRlIGZpZ3VyZSBhbmQgcGxvdCBjb25mdXNpb24gbWF0cml4CiAgICAgICAgcGx0LmZpZ3VyZShmaWdzaXplPSg4LCA2KSkKICAgICAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgZm10PWZtdCwgY21hcD1jbWFwLCAKICAgICAgICAgICAgICAgICAgIHh0aWNrbGFiZWxzPWNsYXNzX25hbWVzLCB5dGlja2xhYmVscz1jbGFzc19uYW1lcywKICAgICAgICAgICAgICAgICAgIGNiYXI9VHJ1ZSwgc3F1YXJlPVRydWUsIGxpbmV3aWR0aHM9MC41KQogICAgICAgIAogICAgICAgICMgQWRkIGxhYmVscyBhbmQgdGl0bGUKICAgICAgICBwbHQueGxhYmVsKCdQcmVkaWN0ZWQgTGFiZWwnLCBmb250c2l6ZT0xMikKICAgICAgICBwbHQueWxhYmVsKCdUcnVlIExhYmVsJywgZm9udHNpemU9MTIpCiAgICAgICAgcGx0LnRpdGxlKHRpdGxlLCBmb250c2l6ZT0xNCkKICAgICAgICAKICAgICAgICAjIENhbGN1bGF0ZSBhbmQgYWRkIG1ldHJpY3MgdG8gdGhlIHBsb3QKICAgICAgICB0biwgZnAsIGZuLCB0cCA9IGNtLnJhdmVsKCkKICAgICAgICBzZW5zaXRpdml0eSA9IHRwIC8gKHRwICsgZm4pIGlmICh0cCArIGZuKSA+IDAgZWxzZSAwCiAgICAgICAgc3BlY2lmaWNpdHkgPSB0biAvICh0biArIGZwKSBpZiAodG4gKyBmcCkgPiAwIGVsc2UgMAogICAgICAgIGFjY3VyYWN5ID0gKHRwICsgdG4pIC8gKHRwICsgdG4gKyBmcCArIGZuKQogICAgICAgIAogICAgICAgIHBsdC5maWd0ZXh0KDAuNSwgMC4wMSwgCiAgICAgICAgICAgICAgICAgIGYnQWNjdXJhY3k6IHthY2N1cmFjeTouM2Z9LCBTZW5zaXRpdml0eToge3NlbnNpdGl2aXR5Oi4zZn0sIFNwZWNpZmljaXR5OiB7c3BlY2lmaWNpdHk6LjNmfScsCiAgICAgICAgICAgICAgICAgIGhhPSdjZW50ZXInLCBmb250c2l6ZT0xMCwgYmJveD1kaWN0KGZhY2Vjb2xvcj0nd2hpdGUnLCBhbHBoYT0wLjgsIGJveHN0eWxlPSdyb3VuZCxwYWQ9MC41JykpCiAgICAgICAgCiAgICAgICAgIyBBZGp1c3QgcGxvdCBhZXN0aGV0aWNzCiAgICAgICAgcGx0LnRpZ2h0X2xheW91dChyZWN0PVswLCAwLjA1LCAxLCAwLjk1XSkKICAgICAgICAKICAgICAgICAjIFNhdmUgZmlndXJlCiAgICAgICAgZmlsZV9leHQgPSBvcy5wYXRoLnNwbGl0ZXh0KHNhdmVfbmFtZSlbMV0ubG93ZXIoKQogICAgICAgIGlmIGZpbGVfZXh0ID09ICcucGRmJzoKICAgICAgICAgICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKHNlbGYub3V0cHV0X2Rpciwgc2F2ZV9uYW1lKSwgYmJveF9pbmNoZXM9J3RpZ2h0JykKICAgICAgICBlbGlmIGZpbGVfZXh0IGluIFsnLnRpZicsICcudGlmZiddOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpLCBmb3JtYXQ9J3RpZicsIGNvbXByZXNzaW9uPSd0aWZmX2x6dycpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKHNlbGYub3V0cHV0X2Rpciwgc2F2ZV9uYW1lKSwgYmJveF9pbmNoZXM9J3RpZ2h0JywgCiAgICAgICAgICAgICAgICAgICAgICAgIGRwaT1zZWxmLmRwaSkKICAgICAgICAKICAgICAgICBwbHQuY2xvc2UoKQogICAgCiAgICBkZWYgY2FsY3VsYXRlX25ldF9iZW5lZml0KHNlbGYsIHlfdHJ1ZSwgeV9wcmVkX3Byb2JhLCB0aHJlc2hvbGQpOgogICAgICAgICIiIgogICAgICAgIENhbGN1bGF0ZSB0aGUgbmV0IGJlbmVmaXQgYXQgYSBnaXZlbiB0aHJlc2hvbGQgZm9yIGRlY2lzaW9uIGN1cnZlIGFuYWx5c2lzLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHlfdHJ1ZSAobnAubmRhcnJheSk6IFRydWUgYmluYXJ5IGxhYmVscyAoMCBvciAxKQogICAgICAgICAgICB5X3ByZWRfcHJvYmEgKG5wLm5kYXJyYXkpOiBQcmVkaWN0ZWQgcHJvYmFiaWxpdGllcwogICAgICAgICAgICB0aHJlc2hvbGQgKGZsb2F0KTogRGVjaXNpb24gdGhyZXNob2xkIGZvciBjbGFzc2lmaWNhdGlvbgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBmbG9hdDogTmV0IGJlbmVmaXQgdmFsdWUgYXQgdGhlIGdpdmVuIHRocmVzaG9sZAogICAgICAgICIiIgogICAgICAgICMgSGFuZGxlIGJvdW5kYXJ5IGNhc2VzCiAgICAgICAgaWYgdGhyZXNob2xkID49IDAuOTk5OiAgIyBQcmV2ZW50IGRpdmlzaW9uIGJ5IHZhbHVlcyBjbG9zZSB0byB6ZXJvCiAgICAgICAgICAgIHJldHVybiAwLjAKICAgICAgICAgICAgCiAgICAgICAgIyBDb252ZXJ0IHRvIGJpbmFyeSBwcmVkaWN0aW9uIGJhc2VkIG9uIHRocmVzaG9sZAogICAgICAgIHlfcHJlZCA9ICh5X3ByZWRfcHJvYmEgPj0gdGhyZXNob2xkKS5hc3R5cGUoaW50KQogICAgICAgIAogICAgICAgICMgQ2FsY3VsYXRlIHRydWUgcG9zaXRpdmVzIGFuZCBmYWxzZSBwb3NpdGl2ZXMKICAgICAgICBUUCA9IG5wLnN1bSgoeV9wcmVkID09IDEpICYgKHlfdHJ1ZSA9PSAxKSkKICAgICAgICBGUCA9IG5wLnN1bSgoeV9wcmVkID09IDEpICYgKHlfdHJ1ZSA9PSAwKSkKICAgICAgICAKICAgICAgICAjIFRvdGFsIHNhbXBsZSBjb3VudAogICAgICAgIG4gPSBsZW4oeV90cnVlKQogICAgICAgIAogICAgICAgICMgQ2FsY3VsYXRlIG5ldCBiZW5lZml0CiAgICAgICAgaWYgVFAgKyBGUCA9PSAwOgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJlbmVmaXQgPSAoVFAgLyBuKSAtIChGUCAvIG4pICogKHRocmVzaG9sZCAvICgxIC0gdGhyZXNob2xkKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRW5zdXJlIHJldHVybmVkIHZhbHVlIGlzIGZpbml0ZQogICAgICAgICAgICBpZiBub3QgbnAuaXNmaW5pdGUoYmVuZWZpdCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMC4wCiAgICAgICAgICAgIHJldHVybiBiZW5lZml0CiAgICAKICAgIGRlZiBwbG90X2NhbGlicmF0aW9uX3YyKHNlbGYsIG1vZGVsc19kYXRhOiBEaWN0W3N0ciwgVHVwbGVbbnAubmRhcnJheSwgbnAubmRhcnJheV1dLCBzYXZlX25hbWU6IHN0ciA9ICdDYWxpYnJhdGlvbi5wZGYnLCBuX2JpbnM6IGludCA9IDUsIHRpdGxlOiBzdHIgPSAndGVzdCcpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUGxvdCBjYWxpYnJhdGlvbiBjdXJ2ZXMgZm9yIGEgc2luZ2xlIGRhdGFzZXQgKG9wdGltaXplZCB2ZXJzaW9uKQogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1vZGVsc19kYXRhOiBEaWN0aW9uYXJ5IHdpdGggbW9kZWwgbmFtZXMgYXMga2V5cyBhbmQgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSB0dXBsZXMgYXMgdmFsdWVzCiAgICAgICAgICAgIHNhdmVfbmFtZTogTmFtZSBvZiB0aGUgZmlsZSB0byBzYXZlIHRoZSBwbG90CiAgICAgICAgICAgIG5fYmluczogTnVtYmVyIG9mIGJpbnMgdG8gdXNlIGZvciBjYWxpYnJhdGlvbiBjdXJ2ZQogICAgICAgICAgICB0aXRsZTogRGF0YSB0eXBlIGZvciB0aXRsZSBkaXNwbGF5ICgndHJhaW4nIG9yICd0ZXN0JykKICAgICAgICAiIiIKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDgsIDgpKQogICAgICAgIAogICAgICAgICMgUGxvdCBjYWxpYnJhdGlvbiBjdXJ2ZXMgZm9yIGVhY2ggbW9kZWwKICAgICAgICBmb3IgbW9kZWxfbmFtZSwgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSBpbiBtb2RlbHNfZGF0YS5pdGVtcygpOgogICAgICAgICAgICAjIEVuc3VyZSBwcmVkaWN0ZWQgcHJvYmFiaWxpdGllcyBhcmUgd2l0aGluIDAtMSByYW5nZQogICAgICAgICAgICB5X3ByZWRfbm9ybWFsaXplZCA9ICh5X3ByZWRfcHJvYmEgLSBucC5taW4oeV9wcmVkX3Byb2JhKSkgLyAobnAubWF4KHlfcHJlZF9wcm9iYSkgLSBucC5taW4oeV9wcmVkX3Byb2JhKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2FsY3VsYXRlIGNhbGlicmF0aW9uIGN1cnZlCiAgICAgICAgICAgIHByb2JfdHJ1ZSwgcHJvYl9wcmVkID0gY2FsaWJyYXRpb25fY3VydmUoeV90cnVlLCB5X3ByZWRfbm9ybWFsaXplZCwgbl9iaW5zPW5fYmlucywgc3RyYXRlZ3k9J3F1YW50aWxlJykKICAgICAgICAgICAgcGx0LnBsb3QocHJvYl9wcmVkLCBwcm9iX3RydWUsICdzLScsIGxpbmV3aWR0aD0xLjUsIG1hcmtlcnNpemU9OCwgbGFiZWw9bW9kZWxfbmFtZSkKICAgICAgICAKICAgICAgICAjIEFkZCBpZGVhbCBjYWxpYnJhdGlvbiBsaW5lIGFuZCBiZWF1dGlmeSB0aGUgcGxvdAogICAgICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAnay0tJywgbGluZXdpZHRoPTEuNSwgbGFiZWw9J1BlcmZlY3RseSBDYWxpYnJhdGVkJykKICAgICAgICBwbHQueGxhYmVsKCdNZWFuIFByZWRpY3RlZCBQcm9iYWJpbGl0eScsIGZvbnRzaXplPTEyKQogICAgICAgIHBsdC55bGFiZWwoJ1Bvc2l0aXZlIFNhbXBsZSBQcm9wb3J0aW9uJywgZm9udHNpemU9MTIpCiAgICAgICAgCiAgICAgICAgIyBTZXQgdGl0bGUgYmFzZWQgb24gZGF0YSB0eXBlCiAgICAgICAgdGl0bGUgPSBmInsnVHJhaW5pbmcnIGlmIHRpdGxlLmxvd2VyKCkgPT0gJ3RyYWluJyBlbHNlICdUZXN0aW5nJ30gU2V0IENhbGlicmF0aW9uIEN1cnZlcyIKICAgICAgICBwbHQudGl0bGUodGl0bGUsIGZvbnRzaXplPTE0KQogICAgICAgIAogICAgICAgIHBsdC5sZWdlbmQobG9jPSdiZXN0JywgZnJhbWVvbj1UcnVlLCBmYWNlY29sb3I9J3doaXRlJywgZnJhbWVhbHBoYT0wLjkpCiAgICAgICAgcGx0LmdyaWQoVHJ1ZSwgbGluZXN0eWxlPSctLScsIGFscGhhPTAuNykKICAgICAgICBwbHQuZ2NhKCkuc2V0X2ZhY2Vjb2xvcignI2Y4ZjlmYScpCiAgICAgICAgCiAgICAgICAgIyBPbmx5IHNob3cgbGVmdCBhbmQgYm90dG9tIHNwaW5lcyBhbmQgc2V0IHRoZWlyIHdpZHRoIHRvIDEuNQogICAgICAgIGF4ID0gcGx0LmdjYSgpCiAgICAgICAgYXguc3BpbmVzWyd0b3AnXS5zZXRfdmlzaWJsZShGYWxzZSkKICAgICAgICBheC5zcGluZXNbJ3JpZ2h0J10uc2V0X3Zpc2libGUoRmFsc2UpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfdmlzaWJsZShUcnVlKQogICAgICAgIGF4LnNwaW5lc1snbGVmdCddLnNldF92aXNpYmxlKFRydWUpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfbGluZXdpZHRoKDEuNSkKICAgICAgICBheC5zcGluZXNbJ2xlZnQnXS5zZXRfbGluZXdpZHRoKDEuNSkKICAgICAgICAKICAgICAgICAjIEV4cGFuZCBheGlzIHJhbmdlCiAgICAgICAgcGx0LnhsaW0oWy0wLjA1LCAxLjA1XSkKICAgICAgICBwbHQueWxpbShbLTAuMDUsIDEuMDVdKQogICAgICAgIAogICAgICAgICMgU2F2ZSBpbWFnZQogICAgICAgIHBsdC50aWdodF9sYXlvdXQoKQogICAgICAgIAogICAgICAgICMg5qC55o2u5paH5Lu25omp5bGV5ZCN5Yaz5a6a5piv5ZCm5bqU55So5Y6L57yp5ZKMRFBJ6K6+572uCiAgICAgICAgZmlsZV9leHQgPSBvcy5wYXRoLnNwbGl0ZXh0KHNhdmVfbmFtZSlbMV0ubG93ZXIoKQogICAgICAgIGlmIGZpbGVfZXh0ID09ICcucGRmJzoKICAgICAgICAgICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKHNlbGYub3V0cHV0X2Rpciwgc2F2ZV9uYW1lKSwgYmJveF9pbmNoZXM9J3RpZ2h0JykKICAgICAgICBlbGlmIGZpbGVfZXh0IGluIFsnLnRpZicsICcudGlmZiddOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpLCBmb3JtYXQ9J3RpZicsIGNvbXByZXNzaW9uPSd0aWZmX2x6dycpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKHNlbGYub3V0cHV0X2Rpciwgc2F2ZV9uYW1lKSwgYmJveF9pbmNoZXM9J3RpZ2h0JywgCiAgICAgICAgICAgICAgICAgICAgICAgIGRwaT1zZWxmLmRwaSkKICAgICAgICAKICAgICAgICBwbHQuY2xvc2UoKQogICAgICAgICAgICAgCiAgICBkZWYgcGxvdF9zaGFwKHNlbGYsIG1vZGVsOiBBbnksIFg6IG5wLm5kYXJyYXksIGZlYXR1cmVfbmFtZXM6IExpc3Rbc3RyXSwgc2F2ZV9uYW1lOiBzdHIgPSAnU0hBUC5wZGYnKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIFBsb3QgU0hBUCB2YWx1ZXMgd2l0aCBiYXIgYW5kIGJlZXN3YXJtIHBsb3RzCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbW9kZWwgKEFueSk6IFRyYWluZWQgbW9kZWwKICAgICAgICAgICAgWCAobnAubmRhcnJheSk6IEZlYXR1cmUgZGF0YQogICAgICAgICAgICBmZWF0dXJlX25hbWVzIChMaXN0W3N0cl0pOiBMaXN0IG9mIGZlYXR1cmUgbmFtZXMKICAgICAgICAgICAgc2F2ZV9uYW1lIChzdHIpOiBOYW1lIG9mIHRoZSBmaWxlIHRvIHNhdmUgdGhlIHBsb3QKICAgICAgICAiIiIKICAgICAgICAjIEdldCBtb2RlbCB0eXBlIC0gaWYgbm90IGF2YWlsYWJsZSwgdHJ5IHRvIGluZmVyIGZyb20gbW9kZWwgb2JqZWN0CiAgICAgICAgbW9kZWxfdHlwZSA9IGdldGF0dHIobW9kZWwsICdtb2RlbF90eXBlJywgTm9uZSkKICAgICAgICAKICAgICAgICAjIENhbGN1bGF0ZSBTSEFQIHZhbHVlcyBiYXNlZCBvbiBtb2RlbCB0eXBlCiAgICAgICAgaWYgbW9kZWxfdHlwZSA9PSAnbGluZWFyJzoKICAgICAgICAgICAgIyBGb3IgY3VzdG9tIGxpbmVhciBtb2RlbHMsIHRyeSB0byBhY2Nlc3MgdGhlIHVuZGVybHlpbmcgc2tsZWFybiBtb2RlbAogICAgICAgICAgICBpZiBoYXNhdHRyKG1vZGVsLCAnbW9kZWwnKToKICAgICAgICAgICAgICAgICMgQWNjZXNzIHRoZSBpbnRlcm5hbCBza2xlYXJuIG1vZGVsCiAgICAgICAgICAgICAgICBza2xlYXJuX21vZGVsID0gbW9kZWwubW9kZWwKICAgICAgICAgICAgICAgIGV4cGxhaW5lciA9IHNoYXAuTGluZWFyRXhwbGFpbmVyKHNrbGVhcm5fbW9kZWwsIFgpCiAgICAgICAgICAgIGVsaWYgaGFzYXR0cihtb2RlbCwgJ2NvZWZfJykgYW5kIGhhc2F0dHIobW9kZWwsICdpbnRlcmNlcHRfJyk6CiAgICAgICAgICAgICAgICAjIElmIG1vZGVsIGhhcyBjb2VmZmljaWVudHMgYW5kIGludGVyY2VwdCBkaXJlY3RseQogICAgICAgICAgICAgICAgZXhwbGFpbmVyID0gc2hhcC5MaW5lYXJFeHBsYWluZXIoKG1vZGVsLmNvZWZfLCBtb2RlbC5pbnRlcmNlcHRfKSwgWCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gS2VybmVsRXhwbGFpbmVyIGlmIHdlIGNhbid0IGFjY2VzcyB0aGUgbW9kZWwgc3RydWN0dXJlCiAgICAgICAgICAgICAgICBleHBsYWluZXIgPSBzaGFwLktlcm5lbEV4cGxhaW5lcihtb2RlbC5wcmVkaWN0X3Byb2JhLCBYKQogICAgICAgIGVsaWYgbW9kZWxfdHlwZSA9PSAndHJlZSc6CiAgICAgICAgICAgICMgRm9yIHRyZWUtYmFzZWQgbW9kZWxzCiAgICAgICAgICAgIGlmIGhhc2F0dHIobW9kZWwsICdtb2RlbCcpOgogICAgICAgICAgICAgICAgIyBBY2Nlc3MgdGhlIGludGVybmFsIHNrbGVhcm4gbW9kZWwKICAgICAgICAgICAgICAgIHNrbGVhcm5fbW9kZWwgPSBtb2RlbC5tb2RlbAogICAgICAgICAgICAgICAgZXhwbGFpbmVyID0gc2hhcC5UcmVlRXhwbGFpbmVyKHNrbGVhcm5fbW9kZWwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRyeSB0byB1c2UgdGhlIG1vZGVsIGRpcmVjdGx5CiAgICAgICAgICAgICAgICBleHBsYWluZXIgPSBzaGFwLlRyZWVFeHBsYWluZXIobW9kZWwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBEZWZhdWx0IHRvIEtlcm5lbEV4cGxhaW5lciBmb3Igb3RoZXIgbW9kZWwgdHlwZXMKICAgICAgICAgICAgZXhwbGFpbmVyID0gc2hhcC5LZXJuZWxFeHBsYWluZXIobW9kZWwucHJlZGljdF9wcm9iYSwgWCkKICAgICAgICAKICAgICAgICAjIEdldCBTSEFQIHZhbHVlcwogICAgICAgIHNoYXBfdmFsdWVzID0gZXhwbGFpbmVyLnNoYXBfdmFsdWVzKFgpCiAgICAgICAgCiAgICAgICAgIyBQcm9jZXNzIFNIQVAgZXhwbGFuYXRpb24gZm9yIGNvbnNpc3RlbmN5CiAgICAgICAgc2hhcF92YWx1ZXMgPSBwcm9jZXNzX3NoYXBfZXhwbGFuYXRpb24oc2hhcF92YWx1ZXMpCiAgICAgICAgCiAgICAgICAgIyBQbG90IDE6IEZlYXR1cmUgaW1wb3J0YW5jZSBiYXIgcGxvdAogICAgICAgIHBsdC5maWd1cmUoZmlnc2l6ZT0oMTAsIDgpKQogICAgICAgIHBsdC50aXRsZSgnRmVhdHVyZSBJbXBvcnRhbmNlJywgZm9udHNpemU9MTQpCiAgICAgICAgc2hhcC5zdW1tYXJ5X3Bsb3QoCiAgICAgICAgICAgIHNoYXBfdmFsdWVzLCAKICAgICAgICAgICAgWCwKICAgICAgICAgICAgZmVhdHVyZV9uYW1lcz1mZWF0dXJlX25hbWVzLAogICAgICAgICAgICBwbG90X3R5cGU9ImJhciIsCiAgICAgICAgICAgIHNob3c9RmFsc2UKICAgICAgICApCiAgICAgICAgcGx0LnRpZ2h0X2xheW91dCgpCiAgICAgICAgYmFyX2ZpbGVuYW1lID0gb3MucGF0aC5zcGxpdGV4dChzYXZlX25hbWUpWzBdICsgJ19iYXInICsgb3MucGF0aC5zcGxpdGV4dChzYXZlX25hbWUpWzFdCiAgICAgICAgc2VsZi5fc2F2ZV9maWd1cmUoYmFyX2ZpbGVuYW1lKQogICAgICAgIHBsdC5jbG9zZSgpCiAgICAgICAgCiAgICAgICAgIyBQbG90IDI6IEJlZXN3YXJtIHBsb3QKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDEwLCA4KSkKICAgICAgICBwbHQudGl0bGUoJ0ZlYXR1cmUgSW1wYWN0IERpc3RyaWJ1dGlvbicsIGZvbnRzaXplPTE0KQogICAgICAgIHNoYXAuc3VtbWFyeV9wbG90KAogICAgICAgICAgICBzaGFwX3ZhbHVlcywgCiAgICAgICAgICAgIFgsCiAgICAgICAgICAgIGZlYXR1cmVfbmFtZXM9ZmVhdHVyZV9uYW1lcywKICAgICAgICAgICAgc2hvdz1GYWxzZQogICAgICAgICkKICAgICAgICBwbHQudGlnaHRfbGF5b3V0KCkKICAgICAgICBzZWxmLl9zYXZlX2ZpZ3VyZShzYXZlX25hbWUpCiAgICAgICAgcGx0LmNsb3NlKCkKICAgIAogICAgZGVmIF9zYXZlX2ZpZ3VyZShzZWxmLCBzYXZlX25hbWU6IHN0cikgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBIZWxwZXIgbWV0aG9kIHRvIHNhdmUgZmlndXJlcyB3aXRoIGFwcHJvcHJpYXRlIGZvcm1hdCBhbmQgRFBJCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgc2F2ZV9uYW1lIChzdHIpOiBOYW1lIG9mIHRoZSBmaWxlIHRvIHNhdmUKICAgICAgICAiIiIKICAgICAgICBmaWxlX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoc2F2ZV9uYW1lKVsxXS5sb3dlcigpCiAgICAgICAgaWYgZmlsZV9leHQgPT0gJy5wZGYnOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgICAgIGVsaWYgZmlsZV9leHQgaW4gWycudGlmJywgJy50aWZmJ106CiAgICAgICAgICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihzZWxmLm91dHB1dF9kaXIsIHNhdmVfbmFtZSksIGJib3hfaW5jaGVzPSd0aWdodCcsIAogICAgICAgICAgICAgICAgICAgICAgICBkcGk9c2VsZi5kcGksIGZvcm1hdD0ndGlmJywgY29tcHJlc3Npb249J3RpZmZfbHp3JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpKQogICAgCiAgICBkZWYgcGxvdF9wcl9jdXJ2ZShzZWxmLCBtb2RlbHNfZGF0YTogRGljdFtzdHIsIFR1cGxlW25wLm5kYXJyYXksIG5wLm5kYXJyYXldXSwgCiAgICAgICAgICAgICAgICAgIHNhdmVfbmFtZTogc3RyID0gJ1BSX2N1cnZlLnBkZicsIAogICAgICAgICAgICAgICAgICB0aXRsZTogc3RyID0gJ2V2YWx1YXRpb24nKSAtPiBOb25lOgoKICAgICAgICAiIiIKICAgICAgICBQbG90IFByZWNpc2lvbi1SZWNhbGwgY3VydmUgZm9yIG11bHRpcGxlIG1vZGVscwogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIG1vZGVsc19kYXRhOiBEaWN0aW9uYXJ5IHdpdGggbW9kZWwgbmFtZXMgYXMga2V5cyBhbmQgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSB0dXBsZXMgYXMgdmFsdWVzCiAgICAgICAgICAgIHNhdmVfbmFtZTogTmFtZSBvZiB0aGUgZmlsZSB0byBzYXZlIHRoZSBwbG90CiAgICAgICAgICAgIHRpdGxlOiBEYXRhIHR5cGUgZm9yIHRpdGxlIGRpc3BsYXkgKCd0cmFpbicsICd0ZXN0Jywgb3IgJ2V2YWx1YXRpb24nKQoKICAgICAgICAiIiIKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDYsIDYpKQogICAgICAgICMgUGxvdCBQUiBjdXJ2ZXMgZm9yIGVhY2ggbW9kZWwKICAgICAgICBmb3IgbW9kZWxfbmFtZSwgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSBpbiBtb2RlbHNfZGF0YS5pdGVtcygpOgogICAgICAgICAgICBwcmVjaXNpb24sIHJlY2FsbCwgXyA9IHByZWNpc2lvbl9yZWNhbGxfY3VydmUoeV90cnVlLCB5X3ByZWRfcHJvYmEpCiAgICAgICAgICAgICMgQ2FsY3VsYXRlIGF2ZXJhZ2UgcHJlY2lzaW9uIHNjb3JlCiAgICAgICAgICAgIGFwID0gbnAudHJhcHoocHJlY2lzaW9uLCByZWNhbGwpCiAgICAgICAgICAgICMg5YWz6ZSu5L+u5pS577ya57uY5Yi25pe25Lqk5o2ieOWSjHnovbTvvIzkvb/lm77lvaLku47lt6bkuIvliLDlj7PkuIoKICAgICAgICAgICAgcGx0LnBsb3QoMSAtIHByZWNpc2lvbiwgcmVjYWxsLCBsaW5ld2lkdGg9MiwgbGFiZWw9Zid7bW9kZWxfbmFtZX0gKEFQID0ge2FwOi4zZn0pJykKICAgICAgICAKICAgICAgICAjIEJlYXV0aWZ5IHRoZSBwbG90CiAgICAgICAgcGx0LnhsYWJlbCgnMSAtIFByZWNpc2lvbicpICAjIOS/ruaUuVjovbTmoIfnrb4KCiAgICAgICAgcGx0LnlsYWJlbCgnUmVjYWxsJykKICAgICAgICBwbHQudGl0bGUoZidNb2RpZmllZCBQcmVjaXNpb24tUmVjYWxsIEN1cnZlICh7dGl0bGUuY2FwaXRhbGl6ZSgpfSknKQogICAgICAgIHBsdC5sZWdlbmQobG9jPSdiZXN0JykKICAgICAgICBwbHQuZ3JpZChUcnVlLCBsaW5lc3R5bGU9Jy0tJywgYWxwaGE9MC43KQogICAgICAgICMgU2V0IGF4aXMgbGltaXRzIGZvciBsZWZ0LXRvLXJpZ2h0LCBib3R0b20tdG8tdG9wIGRpcmVjdGlvbgogICAgICAgIHBsdC54bGltKFstMC4wMiwgMS4wMl0pCiAgICAgICAgcGx0LnlsaW0oWy0wLjAyLCAxLjAyXSkKCiAgICAgICAgIyBPbmx5IHNob3cgbGVmdCBhbmQgYm90dG9tIHNwaW5lcyBhbmQgc2V0IHRoZWlyIHdpZHRoIHRvIDEuNQogICAgICAgIGF4ID0gcGx0LmdjYSgpCiAgICAgICAgYXguc3BpbmVzWyd0b3AnXS5zZXRfdmlzaWJsZShGYWxzZSkKICAgICAgICBheC5zcGluZXNbJ3JpZ2h0J10uc2V0X3Zpc2libGUoRmFsc2UpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfdmlzaWJsZShUcnVlKQogICAgICAgIGF4LnNwaW5lc1snbGVmdCddLnNldF92aXNpYmxlKFRydWUpCiAgICAgICAgYXguc3BpbmVzWydib3R0b20nXS5zZXRfbGluZXdpZHRoKDEuNSkKICAgICAgICBheC5zcGluZXNbJ2xlZnQnXS5zZXRfbGluZXdpZHRoKDEuNSkKCiAgICAgICAgcGx0LnRpZ2h0X2xheW91dCgpCiAgICAgICAgCiAgICAgICAgIyDmoLnmja7mlofku7bmianlsZXlkI3lhrPlrprmmK/lkKblupTnlKjljovnvKnlkoxEUEnorr7nva4KICAgICAgICBmaWxlX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoc2F2ZV9uYW1lKVsxXS5sb3dlcigpCiAgICAgICAgaWYgZmlsZV9leHQgPT0gJy5wZGYnOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgICAgIGVsaWYgZmlsZV9leHQgaW4gWycudGlmJywgJy50aWZmJ106CiAgICAgICAgICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihzZWxmLm91dHB1dF9kaXIsIHNhdmVfbmFtZSksIGJib3hfaW5jaGVzPSd0aWdodCcsIAogICAgICAgICAgICAgICAgICAgICAgICBkcGk9c2VsZi5kcGksIGZvcm1hdD0ndGlmJywgY29tcHJlc3Npb249J3RpZmZfbHp3JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzYXZlX25hbWUpLCBiYm94X2luY2hlcz0ndGlnaHQnLCAKICAgICAgICAgICAgICAgICAgICAgICAgZHBpPXNlbGYuZHBpKQogICAgICAgIAogICAgICAgIHBsdC5jbG9zZSgp').decode())
