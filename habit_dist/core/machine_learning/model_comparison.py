
import base64
exec(base64.b64decode(b'IiIiCk11bHRpZmlsZUV2YWx1YXRvcuS9v+eUqOekuuS+iwrlsZXnpLrlpoLkvZXkvb/nlKjlpJrmlofku7bor4TkvLDlt6Xlhbfor4TkvLDlpJrkuKrmqKHlnovnmoTmgKfog70KIiIiCgppbXBvcnQgb3MKaW1wb3J0IHlhbWwKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQganNvbgppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSBoYWJpdC5jb3JlLm1hY2hpbmVfbGVhcm5pbmcuZXZhbHVhdGlvbi5tb2RlbF9ldmFsdWF0aW9uIGltcG9ydCBNdWx0aWZpbGVFdmFsdWF0b3IKZnJvbSBoYWJpdC5jb3JlLm1hY2hpbmVfbGVhcm5pbmcudmlzdWFsaXphdGlvbi5wbG90dGluZyBpbXBvcnQgUGxvdHRlcgpmcm9tIGhhYml0LmNvcmUubWFjaGluZV9sZWFybmluZy5ldmFsdWF0aW9uLm1ldHJpY3MgaW1wb3J0ICgKICAgIGNhbGN1bGF0ZV9tZXRyaWNzLCAKICAgIGNhbGN1bGF0ZV9tZXRyaWNzX3lvdWRlbiwgCiAgICBjYWxjdWxhdGVfbWV0cmljc19hdF90YXJnZXQsCiAgICBhcHBseV95b3VkZW5fdGhyZXNob2xkLAogICAgYXBwbHlfdGFyZ2V0X3RocmVzaG9sZAopCmZyb20gaGFiaXQudXRpbHMubG9nX3V0aWxzIGltcG9ydCBnZXRfbG9nZ2VyCgpjbGFzcyBNb2RlbENvbXBhcmlzb246CiAgICAiIiIKICAgIFRvb2wgZm9yIGNvbXBhcmluZyBhbmQgZXZhbHVhdGluZyBtdWx0aXBsZSBtYWNoaW5lIGxlYXJuaW5nIG1vZGVscwogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZmlnX3BhdGgpOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIG1vZGVsIGNvbXBhcmlzb24gdG9vbAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGNvbmZpZ19wYXRoIChzdHIpOiBQYXRoIHRvIGNvbmZpZ3VyYXRpb24gWUFNTCBmaWxlCiAgICAgICAgIiIiCiAgICAgICAgIyDor7vlj5bphY3nva7mlofku7YKICAgICAgICB3aXRoIG9wZW4oY29uZmlnX3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgc2VsZi5jb25maWcgPSB5YW1sLnNhZmVfbG9hZChmKQogICAgCiAgICAgICAgIyDorr7nva7ovpPlh7rnm67lvZUKICAgICAgICBzZWxmLm91dHB1dF9kaXIgPSBzZWxmLmNvbmZpZy5nZXQoJ291dHB1dF9kaXInLCAnLi9yZXN1bHRzL21vZGVsX2NvbXBhcmlzb24nKQogICAgICAgIG9zLm1ha2VkaXJzKHNlbGYub3V0cHV0X2RpciwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAKICAgICAgICAjIOWIneWni+WMlmxvZ2dlcgogICAgICAgIHNlbGYubG9nZ2VyID0gZ2V0X2xvZ2dlcihzZWxmLm91dHB1dF9kaXIsICJNb2RlbENvbXBhcmlzb24iKQogICAgICAgIAogICAgICAgICMg5Yid5aeL5YyW6K+E5Lyw5ZmoCiAgICAgICAgc2VsZi5ldmFsdWF0b3IgPSBNdWx0aWZpbGVFdmFsdWF0b3Iob3V0cHV0X2Rpcj1zZWxmLm91dHB1dF9kaXIpCiAgICAgICAgCiAgICAgICAgIyDliJ3lp4vljJbliIbnu4TmlbDmja7lrZjlgqgKICAgICAgICBzZWxmLnNwbGl0X2dyb3VwcyA9IHt9CiAgICAgICAgc2VsZi5zcGxpdF9jb2x1bW4gPSBOb25lCiAgICAgICAgCiAgICAgICAgIyDnlKjkuo7lrZjlgqjnprvmlaPpooTmtYvliJfnmoTmmKDlsIQKICAgICAgICBzZWxmLnByZWRfY29sX21hcHBpbmcgPSB7fQogICAgICAgIAogICAgICAgICMg5Yid5aeL5YyW5oyH5qCH5a2Y5YKo5a2X5YW4CiAgICAgICAgc2VsZi5hbGxfbWV0cmljcyA9IHt9CiAgICAKICAgIGRlZiBzZXR1cChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBTZXR1cCB0aGUgdG9vbCBieSByZWFkaW5nIHByZWRpY3Rpb24gZmlsZXMgYW5kIHByZXBhcmluZyBkYXRhCiAgICAgICAgIiIiCiAgICAgICAgIyDphY3nva7lpJrkuKrpooTmtYvmlofku7YKICAgICAgICBmaWxlc19jb25maWcgPSBzZWxmLmNvbmZpZy5nZXQoJ2ZpbGVzX2NvbmZpZycsIFtdKQogICAgCiAgICAgICAgIyDor7vlj5bmiYDmnInpooTmtYvmlofku7blubbojrflj5ZzcGxpdOWIl+S/oeaBrwogICAgICAgIHNwbGl0X2NvbHMgPSBbXQogICAgICAgIGZvciBmaWxlX2NvbmYgaW4gZmlsZXNfY29uZmlnOgogICAgICAgICAgICBpZiAic3BsaXRfY29sIiBpbiBmaWxlX2NvbmY6CiAgICAgICAgICAgICAgICBzcGxpdF9jb2xzLmFwcGVuZChmaWxlX2NvbmZbInNwbGl0X2NvbCJdKQogICAgICAgIAogICAgICAgICAgICAjIOa3u+WKoHNwbGl05YiX5Yiw5ZCI5bm25pWw5o2u5LitCiAgICAgICAgICAgIHNlbGYuX2FkZF9zcGxpdF9jb2x1bW5zKGZpbGVzX2NvbmZpZywgc3BsaXRfY29scykKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5Yib5bu656a75pWj6aKE5rWL5YiX55qE5pig5bCECiAgICAgICAgICAgIGZvciBmaWxlX2NvbmZpZyBpbiBmaWxlc19jb25maWc6CiAgICAgICAgICAgICAgICBpZiAncHJlZF9jb2wnIGluIGZpbGVfY29uZmlnIGFuZCAnbW9kZWxfbmFtZScgaW4gZmlsZV9jb25maWc6CiAgICAgICAgICAgICAgICAgICAgbW9kZWxfbmFtZSA9IGZpbGVfY29uZmlnWydtb2RlbF9uYW1lJ10KICAgICAgICAgICAgICAgICAgICBwcmVkX2NvbCA9IGZpbGVfY29uZmlnWydwcmVkX2NvbCddCiAgICAgICAgICAgICAgICAgICAgc2VsZi5wcmVkX2NvbF9tYXBwaW5nW21vZGVsX25hbWVdID0gcHJlZF9jb2wKICAgICAgICAgICAgCiAgICAgICAgICAgICMg6I635Y+Wc3BsaXTphY3nva4KICAgICAgICAgICAgc3BsaXRfY29uZmlnID0gc2VsZi5jb25maWcuZ2V0KCdzcGxpdCcsIHt9KQogICAgICAgICAgICB1c2Vfc3BsaXQgPSBzcGxpdF9jb25maWcuZ2V0KCdlbmFibGVkJywgRmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOmAieaLqeimgeS9v+eUqOeahOWIhue7hOWIlwogICAgICAgICAgICAjIOajgOafpeaJgOaciXNwbGl05YiX5piv5ZCm5a2Y5Zyo5LqO5pWw5o2u5Lit77yM5aaC5p6c5a2Y5Zyo5YiZ5L2/55So56ys5LiA5LiqCiAgICAgICAgICAgIGZvciBjb2wgaW4gc3BsaXRfY29sczoKICAgICAgICAgICAgICAgIGlmIGNvbCBpbiBzZWxmLmV2YWx1YXRvci5kYXRhLmNvbHVtbnM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zcGxpdF9jb2x1bW4gPSBjb2wKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgIyDlpoLmnpzlkK/nlKjliIbnu4TvvIzliJvlu7rliIbnu4TmlbDmja4KICAgICAgICAgICAgaWYgdXNlX3NwbGl0IGFuZCBzZWxmLnNwbGl0X2NvbHVtbjoKICAgICAgICAgICAgICAgIHNlbGYuX2NyZWF0ZV9zcGxpdF9ncm91cHMoKQogICAgCiAgICBkZWYgX2FkZF9zcGxpdF9jb2x1bW5zKHNlbGYsIGZpbGVzX2NvbmZpZywgc3BsaXRfY29scyk6CiAgICAgICAgIiIiCiAgICAgICAgQWRkIHNwbGl0IGNvbHVtbnMgZnJvbSBvcmlnaW5hbCBkYXRhIHRvIG1lcmdlZCBkYXRhCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZmlsZXNfY29uZmlnIChsaXN0KTogTGlzdCBvZiBmaWxlIGNvbmZpZ3VyYXRpb25zCiAgICAgICAgICAgIHNwbGl0X2NvbHMgKGxpc3QpOiBMaXN0IG9mIHNwbGl0IGNvbHVtbiBuYW1lcwogICAgICAgICIiIgogICAgICAgICMg6ZyA6KaB5L+d5a2Y55qE5Y6f5aeL5pWw5o2u77yM5YyF5ZCrc3BsaXTliJcKICAgICAgICBvcmlnaW5hbF9kYXRhX2ZyYW1lcyA9IFtdCiAgICAgICAgZGF0YXNldF92YWx1ZXNfYnlfaWQgPSB7fSAgIyDnlKjkuo7lrZjlgqjmr4/kuKrmgqPogIXnmoRzcGxpdOWAvAogICAgCiAgICAgICAgIyDpppblhYjor7vlj5bmiYDmnInljp/lp4vmlbDmja7vvIzlubbkv53lrZjljIXlkKtzcGxpdOWIl+eahOaVsOaNruahhgogICAgICAgIGZvciBpZHgsIGZpbGVfY29uZmlnIGluIGVudW1lcmF0ZShmaWxlc19jb25maWcpOgogICAgICAgICAgICBmaWxlX3BhdGggPSBmaWxlX2NvbmZpZ1sncGF0aCddCiAgICAgICAgICAgIHN1YmplY3RfaWRfY29sID0gZmlsZV9jb25maWcuZ2V0KCdzdWJqZWN0X2lkX2NvbCcpCiAgICAgICAgICAgIHNwbGl0X2NvbCA9IGZpbGVfY29uZmlnLmdldCgnc3BsaXRfY29sJykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNwbGl0X2NvbCBhbmQgb3MucGF0aC5leGlzdHMoZmlsZV9wYXRoKToKICAgICAgICAgICAgICAgICMg6K+75Y+W5Y6f5aeL5paH5Lu2CiAgICAgICAgICAgICAgICBkZiA9IHBkLnJlYWRfY3N2KGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDmo4Dmn6VzcGxpdOWIl+aYr+WQpuWtmOWcqAogICAgICAgICAgICAgICAgaWYgc3BsaXRfY29sIGluIGRmLmNvbHVtbnM6CiAgICAgICAgICAgICAgICAgICAgIyDkv53lrZhpZOWSjHNwbGl05YiXCiAgICAgICAgICAgICAgICAgICAgZGZfc3Vic2V0ID0gZGZbW3N1YmplY3RfaWRfY29sLCBzcGxpdF9jb2xdXS5jb3B5KCkKICAgICAgICAgICAgICAgICAgICBkZl9zdWJzZXRbc3ViamVjdF9pZF9jb2xdID0gZGZfc3Vic2V0W3N1YmplY3RfaWRfY29sXS5hc3R5cGUoc3RyKQogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX2RhdGFfZnJhbWVzLmFwcGVuZChkZl9zdWJzZXQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDmo4Dmn6VzcGxpdOWAvOeahOS4gOiHtOaApwogICAgICAgICAgICAgICAgICAgIGZvciBfLCByb3cgaW4gZGZfc3Vic2V0Lml0ZXJyb3dzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmpfaWQgPSByb3dbc3ViamVjdF9pZF9jb2xdCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRfdmFsdWUgPSByb3dbc3BsaXRfY29sXQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3Vial9pZCBpbiBkYXRhc2V0X3ZhbHVlc19ieV9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg5bey57uP5a2Y5Zyo6L+Z5Liq5oKj6ICF55qEc3BsaXTlgLzvvIzmo4Dmn6XmmK/lkKbkuIDoh7QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRhdGFzZXRfdmFsdWVzX2J5X2lkW3N1YmpfaWRdICE9IGRhdGFzZXRfdmFsdWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoZiLmlbDmja7kuI3kuIDoh7Q6IOaCo+iAhSB7c3Vial9pZH0g5Zyo5LiN5ZCM5paH5Lu25Lit55qEc3BsaXTlgLzkuI3lkIwgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIih7ZGF0YXNldF92YWx1ZXNfYnlfaWRbc3Vial9pZF19IHZzIHtkYXRhc2V0X3ZhbHVlfSkiKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDmt7vliqDmlrDnmoTmgqPogIVzcGxpdOWAvAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldF92YWx1ZXNfYnlfaWRbc3Vial9pZF0gPSBkYXRhc2V0X3ZhbHVlCiAgICAgICAgCiAgICAgICAgIyDor7vlj5bpooTmtYvmlofku7bvvIjkvb/nlKhNdWx0aWZpbGVFdmFsdWF0b3LnmoTmoIflh4blip/og73vvIkKICAgICAgICBzZWxmLmV2YWx1YXRvci5yZWFkX3ByZWRpY3Rpb25fZmlsZXMoZmlsZXNfY29uZmlnKQogICAgICAgIAogICAgICAgICMg5aaC5p6c5om+5Yiw5LqGc3BsaXTliJfvvIzmiYvliqjlsIblhbbmt7vliqDliLDlkIjlubblkI7nmoTmlbDmja7kuK0KICAgICAgICBpZiBvcmlnaW5hbF9kYXRhX2ZyYW1lcyBhbmQgc2VsZi5ldmFsdWF0b3IuZGF0YSBpcyBub3QgTm9uZToKICAgICAgICAgICAgIyDliJvlu7rkuIDkuKrljIXlkKvntKLlvJXnmoTlia/mnKwKICAgICAgICAgICAgbWVyZ2VkX2RhdGEgPSBzZWxmLmV2YWx1YXRvci5kYXRhLmNvcHkoKQogICAgICAgICAgICBtZXJnZWRfZGF0YS5yZXNldF9pbmRleChpbnBsYWNlPVRydWUpICAjIOWwhue0ouW8leWPmOS4uuW4uOinhOWIlwogICAgICAgICAgICAKICAgICAgICAgICAgIyDlr7nkuo7mr4/kuKrljIXlkKtzcGxpdOWIl+eahOWOn+Wni+aVsOaNruahhgogICAgICAgICAgICBmb3IgZGZfc3Vic2V0IGluIG9yaWdpbmFsX2RhdGFfZnJhbWVzOgogICAgICAgICAgICAgICAgc3ViamVjdF9pZF9jb2wgPSBkZl9zdWJzZXQuY29sdW1uc1swXQogICAgICAgICAgICAgICAgc3BsaXRfY29sID0gZGZfc3Vic2V0LmNvbHVtbnNbMV0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDliJvlu7rkuIDkuKrmmKDlsITlrZflhbjvvIznlKjkuo7lv6vpgJ/mn6Xmib4KICAgICAgICAgICAgICAgIHNwbGl0X2RpY3QgPSBkaWN0KHppcChkZl9zdWJzZXRbc3ViamVjdF9pZF9jb2xdLCBkZl9zdWJzZXRbc3BsaXRfY29sXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5aaC5p6cc3BsaXTliJflsJrmnKrlrZjlnKjvvIzliJnmt7vliqDlroMKICAgICAgICAgICAgICAgIGlmIHNwbGl0X2NvbCBub3QgaW4gbWVyZ2VkX2RhdGEuY29sdW1uczoKICAgICAgICAgICAgICAgICAgICAjIOagueaNrklE5aGr5YWFc3BsaXTlgLwKICAgICAgICAgICAgICAgICAgICBtZXJnZWRfZGF0YVtzcGxpdF9jb2xdID0gbWVyZ2VkX2RhdGFbc3ViamVjdF9pZF9jb2xdLm1hcChzcGxpdF9kaWN0KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmm7TmlrBldmFsdWF0b3LnmoRkYXRh5bGe5oCnCiAgICAgICAgICAgIGlmIHN1YmplY3RfaWRfY29sIGluIG1lcmdlZF9kYXRhLmNvbHVtbnM6CiAgICAgICAgICAgICAgICBtZXJnZWRfZGF0YS5zZXRfaW5kZXgoc3ViamVjdF9pZF9jb2wsIGlucGxhY2U9VHJ1ZSkKICAgICAgICAgICAgc2VsZi5ldmFsdWF0b3IuZGF0YSA9IG1lcmdlZF9kYXRhCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOi+k+WHuuWMheWQq3NwbGl05YiX55qE5L+h5oGvCiAgICAgICAgICAgIGV4aXN0aW5nX3NwbGl0X2NvbHMgPSBbY29sIGZvciBjb2wgaW4gbWVyZ2VkX2RhdGEuY29sdW1ucyBpZiBjb2wgaW4gc3BsaXRfY29sc10KICAgICAgICAgICAgaWYgZXhpc3Rpbmdfc3BsaXRfY29sczoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLmiJDlip/mt7vliqBzcGxpdOWIl+WIsOWQiOW5tuaVsOaNruS4rToge2V4aXN0aW5nX3NwbGl0X2NvbHN9IikKICAgIAogICAgZGVmIF9jcmVhdGVfc3BsaXRfZ3JvdXBzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBkYXRhIGdyb3VwcyBiYXNlZCBvbiBzcGxpdCBjb2x1bW4KICAgICAgICAiIiIKICAgICAgICBpZiBub3Qgc2VsZi5zcGxpdF9jb2x1bW46CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIG1lcmdlZF9kZiA9IHNlbGYuZXZhbHVhdG9yLmRhdGEuY29weSgpCiAgICAgICAgCiAgICAgICAgIyDnm7TmjqXku47mlbDmja7kuK3ojrflj5bmiYDmnInllK/kuIDnmoTliIbnu4TlgLwKICAgICAgICBkYXRhc2V0X3ZhbHVlcyA9IG1lcmdlZF9kZltzZWxmLnNwbGl0X2NvbHVtbl0uZHJvcG5hKCkudW5pcXVlKCkudG9saXN0KCkKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi5oyJ54WnIHtzZWxmLnNwbGl0X2NvbHVtbn0g5YiX6L+b6KGM5YiG57uE77yM6K+G5Yir5Yiw55qE5YiG57uE77yae2RhdGFzZXRfdmFsdWVzfSIpCiAgICAgICAgCiAgICAgICAgIyDkuLrmr4/kuKrliIbnu4TliJvlu7rmqKHlnovmlbDmja4KICAgICAgICBmb3IgZGF0YXNldF92YWx1ZSBpbiBkYXRhc2V0X3ZhbHVlczoKICAgICAgICAgICAgZ3JvdXBfZGYgPSBtZXJnZWRfZGZbbWVyZ2VkX2RmW3NlbGYuc3BsaXRfY29sdW1uXSA9PSBkYXRhc2V0X3ZhbHVlXQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGdyb3VwX2RmLmVtcHR5OgogICAgICAgICAgICAgICAgZ3JvdXBfbW9kZWxzX2RhdGEgPSB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgbW9kZWxfbmFtZSBpbiBzZWxmLmV2YWx1YXRvci5tb2RlbHNfZGF0YS5rZXlzKCk6CiAgICAgICAgICAgICAgICAgICAgcHJvYl9jb2x1bW5fbmFtZSA9IGYie21vZGVsX25hbWV9X3Byb2IiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcHJvYl9jb2x1bW5fbmFtZSBpbiBncm91cF9kZi5jb2x1bW5zOgogICAgICAgICAgICAgICAgICAgICAgICBncm91cF9tb2RlbHNfZGF0YVttb2RlbF9uYW1lXSA9ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2RmW3NlbGYuZXZhbHVhdG9yLmxhYmVsX2NvbF0udmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfZGZbcHJvYl9jb2x1bW5fbmFtZV0udmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zcGxpdF9ncm91cHNbZGF0YXNldF92YWx1ZV0gPSBncm91cF9tb2RlbHNfZGF0YQogICAgCiAgICBkZWYgc2F2ZV9tZXJnZWRfZGF0YShzZWxmKToKICAgICAgICAiIiIKICAgICAgICBTYXZlIG1lcmdlZCBkYXRhIHRvIGEgZmlsZQogICAgICAgICIiIgogICAgICAgIG1lcmdlZF9kYXRhX2NvbmZpZyA9IHNlbGYuY29uZmlnLmdldCgnbWVyZ2VkX2RhdGEnLCB7fSkKICAgICAgICBpZiBtZXJnZWRfZGF0YV9jb25maWcuZ2V0KCdlbmFibGVkJywgVHJ1ZSk6CiAgICAgICAgICAgIHNlbGYuZXZhbHVhdG9yLnNhdmVfbWVyZ2VkX2RhdGEobWVyZ2VkX2RhdGFfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ2NvbWJpbmVkX3ByZWRpY3Rpb25zLmNzdicpKQogICAgCiAgICBkZWYgcnVuX2V2YWx1YXRpb24oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgUnVuIHRoZSBlbnRpcmUgZXZhbHVhdGlvbiBwcm9jZXNzCiAgICAgICAgIiIiCiAgICAgICAgIyDojrflj5ZzcGxpdOmFjee9rgogICAgICAgIHNwbGl0X2NvbmZpZyA9IHNlbGYuY29uZmlnLmdldCgnc3BsaXQnLCB7fSkKICAgICAgICB1c2Vfc3BsaXQgPSBzcGxpdF9jb25maWcuZ2V0KCdlbmFibGVkJywgRmFsc2UpCiAgICAgICAgCiAgICAgICAgIyDmoLnmja7mmK/lkKbmnInliIbnu4TliIbliKvlpITnkIYKICAgICAgICBpZiB1c2Vfc3BsaXQgYW5kIHNlbGYuc3BsaXRfY29sdW1uIGFuZCBzZWxmLnNwbGl0X2dyb3VwczoKICAgICAgICAgICAgIyDmjInliIbnu4TlpITnkIbmlbDmja4KICAgICAgICAgICAgc2VsZi5fcnVuX2V2YWx1YXRpb25fYnlfZ3JvdXAoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMg5LiN5YiG57uE77yM5aSE55CG5omA5pyJ5pWw5o2uCiAgICAgICAgICAgIHNlbGYuX3J1bl9ldmFsdWF0aW9uX2FsbF9kYXRhKCkKICAgIAogICAgZGVmIF9ydW5fZXZhbHVhdGlvbl9ieV9ncm91cChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBSdW4gZXZhbHVhdGlvbiBmb3IgZWFjaCBkYXRhIGdyb3VwCiAgICAgICAgIiIiCiAgICAgICAgZm9yIGRhdGFzZXRfdmFsdWUsIGdyb3VwX21vZGVsc19kYXRhIGluIHNlbGYuc3BsaXRfZ3JvdXBzLml0ZW1zKCk6CiAgICAgICAgICAgICMg5Yib5bu65YiG57uE5a2Q55uu5b2VCiAgICAgICAgICAgIGdyb3VwX291dHB1dF9kaXIgPSBvcy5wYXRoLmpvaW4oc2VsZi5vdXRwdXRfZGlyLCBzdHIoZGF0YXNldF92YWx1ZSkpCiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGdyb3VwX291dHB1dF9kaXIsIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOmHjeaWsOiOt+WPluW9k+WJjWRhdGFzZXRfdmFsdWXlr7nlupTnmoTmlbDmja7moYYKICAgICAgICAgICAgZ3JvdXBfZGYgPSBzZWxmLmV2YWx1YXRvci5kYXRhW3NlbGYuZXZhbHVhdG9yLmRhdGFbc2VsZi5zcGxpdF9jb2x1bW5dID09IGRhdGFzZXRfdmFsdWVdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWIm+W7uuivpeWIhue7hOeahOS4k+eUqHBsb3R0ZXIKICAgICAgICAgICAgZ3JvdXBfcGxvdHRlciA9IFBsb3R0ZXIoZ3JvdXBfb3V0cHV0X2RpcikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg57uY5Yi25ZCE56eN5Y+v6KeG5YyW5Zu+6KGoCiAgICAgICAgICAgIHNlbGYuX2dlbmVyYXRlX3Zpc3VhbGl6YXRpb25zKGdyb3VwX3Bsb3R0ZXIsIGdyb3VwX21vZGVsc19kYXRhLCBncm91cF9vdXRwdXRfZGlyLCBkYXRhc2V0X3ZhbHVlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmiafooYxEZUxvbmfmo4DpqowKICAgICAgICAgICAgc2VsZi5fcnVuX2RlbG9uZ190ZXN0KGdyb3VwX21vZGVsc19kYXRhLCBncm91cF9kZiwgZ3JvdXBfb3V0cHV0X2RpciwgZGF0YXNldF92YWx1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg6K6h566XWW91ZGVu5oyH5pWwCiAgICAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV95b3VkZW5fbWV0cmljcyhkYXRhc2V0X3ZhbHVlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDorqHnrpfnm67moIfmjIfmoIcKICAgICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3RhcmdldF9tZXRyaWNzKGRhdGFzZXRfdmFsdWUpCiAgICAgICAgCiAgICAgICAgIyDpm4bkuK3orqHnrpfmiYDmnInliIbnu4TnmoTln7rmnKzmjIfmoIflubbkv53lrZgKICAgICAgICBzZWxmLl9jYWxjdWxhdGVfYWxsX2Jhc2ljX21ldHJpY3MoKQogICAgCiAgICBkZWYgX3J1bl9ldmFsdWF0aW9uX2FsbF9kYXRhKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFJ1biBldmFsdWF0aW9uIGZvciBhbGwgZGF0YSB3aXRob3V0IGdyb3VwaW5nCiAgICAgICAgIiIiCiAgICAgICAgIyDnu5jliLblkITnp43lj6/op4bljJblm77ooagKICAgICAgICBzZWxmLl9nZW5lcmF0ZV92aXN1YWxpemF0aW9ucyhzZWxmLmV2YWx1YXRvci5wbG90dGVyLCBzZWxmLmV2YWx1YXRvci5tb2RlbHNfZGF0YSwgc2VsZi5vdXRwdXRfZGlyKQogICAgICAgIAogICAgICAgICMg5omn6KGMRGVMb25n5qOA6aqMCiAgICAgICAgc2VsZi5fcnVuX2RlbG9uZ190ZXN0KHNlbGYuZXZhbHVhdG9yLm1vZGVsc19kYXRhLCBzZWxmLmV2YWx1YXRvci5kYXRhLCBzZWxmLm91dHB1dF9kaXIpCiAgICAgICAgCiAgICAgICAgIyDorqHnrpfln7rmnKxtZXRyaWNzCiAgICAgICAgc2VsZi5fY2FsY3VsYXRlX2Jhc2ljX21ldHJpY3Moc2VsZi5ldmFsdWF0b3IubW9kZWxzX2RhdGEsIHNlbGYuZXZhbHVhdG9yLmRhdGEsIHNlbGYub3V0cHV0X2RpcikKICAgICAgICAKICAgICAgICAjIOiuoeeul1lvdWRlbuaMh+aVsAogICAgICAgIHNlbGYuX2NhbGN1bGF0ZV95b3VkZW5fbWV0cmljcygpCiAgICAgICAgCiAgICAgICAgIyDorqHnrpfnm67moIfmjIfmoIcKICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdGFyZ2V0X21ldHJpY3MoKQogICAgCiAgICBkZWYgX2dlbmVyYXRlX3Zpc3VhbGl6YXRpb25zKHNlbGYsIHBsb3R0ZXIsIG1vZGVsc19kYXRhLCBvdXRwdXRfZGlyLCBkYXRhc2V0X3ZhbHVlPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEdlbmVyYXRlIHZpc3VhbGl6YXRpb24gcGxvdHMKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwbG90dGVyIChQbG90dGVyKTogUGxvdHRlciBvYmplY3QKICAgICAgICAgICAgbW9kZWxzX2RhdGEgKGRpY3QpOiBNb2RlbHMgZGF0YQogICAgICAgICAgICBvdXRwdXRfZGlyIChzdHIpOiBPdXRwdXQgZGlyZWN0b3J5CiAgICAgICAgICAgIGRhdGFzZXRfdmFsdWUgKHN0ciwgb3B0aW9uYWwpOiBTcGxpdCB2YWx1ZSBmb3IgdGl0bGUuIERlZmF1bHRzIHRvIE5vbmUuCiAgICAgICAgIiIiCiAgICAgICAgdml6X2NvbmZpZyA9IHNlbGYuY29uZmlnLmdldCgndmlzdWFsaXphdGlvbicsIHt9KQogICAgICAgIAogICAgICAgICMg57uY5Yi2Uk9D5puy57q/CiAgICAgICAgcm9jX2NvbmZpZyA9IHZpel9jb25maWcuZ2V0KCdyb2MnLCB7fSkKICAgICAgICBpZiByb2NfY29uZmlnLmdldCgnZW5hYmxlZCcsIFRydWUpOgogICAgICAgICAgICBzYXZlX25hbWUgPSByb2NfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ3JvY19jdXJ2ZXMucGRmJykKICAgICAgICAgICAgdGl0bGUgPSByb2NfY29uZmlnLmdldCgndGl0bGUnLCAnUk9DIEN1cnZlcyBDb21wYXJpc29uJykKICAgICAgICAgICAgaWYgZGF0YXNldF92YWx1ZToKICAgICAgICAgICAgICAgIHRpdGxlID0gZiJ7dGl0bGV9IC0ge2RhdGFzZXRfdmFsdWV9IgogICAgICAgICAgICBwbG90dGVyLnBsb3Rfcm9jX3YyKG1vZGVsc19kYXRhLCBzYXZlX25hbWU9c2F2ZV9uYW1lLCB0aXRsZT10aXRsZSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIntkYXRhc2V0X3ZhbHVlKyfnu4QgJyBpZiBkYXRhc2V0X3ZhbHVlIGVsc2UgJyd9Uk9D5puy57q/5bey5L+d5a2Y5YiwIHtvcy5wYXRoLmpvaW4ob3V0cHV0X2Rpciwgc2F2ZV9uYW1lKX0iKQogICAgICAgIAogICAgICAgICMg57uY5Yi25Yaz562W5puy57q/CiAgICAgICAgZGNhX2NvbmZpZyA9IHZpel9jb25maWcuZ2V0KCdkY2EnLCB7fSkKICAgICAgICBpZiBkY2FfY29uZmlnLmdldCgnZW5hYmxlZCcsIFRydWUpOgogICAgICAgICAgICBzYXZlX25hbWUgPSBkY2FfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ2RlY2lzaW9uX2N1cnZlcy5wZGYnKQogICAgICAgICAgICB0aXRsZSA9IGRjYV9jb25maWcuZ2V0KCd0aXRsZScsICdEZWNpc2lvbiBDdXJ2ZSBBbmFseXNpcycpCiAgICAgICAgICAgIGlmIGRhdGFzZXRfdmFsdWU6CiAgICAgICAgICAgICAgICB0aXRsZSA9IGYie3RpdGxlfSAtIHtkYXRhc2V0X3ZhbHVlfSIKICAgICAgICAgICAgcGxvdHRlci5wbG90X2RjYV92Mihtb2RlbHNfZGF0YSwgc2F2ZV9uYW1lPXNhdmVfbmFtZSwgdGl0bGU9dGl0bGUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJ7ZGF0YXNldF92YWx1ZSsn57uEICcgaWYgZGF0YXNldF92YWx1ZSBlbHNlICcnfeWGs+etluabsue6v+W3suS/neWtmOWIsCB7b3MucGF0aC5qb2luKG91dHB1dF9kaXIsIHNhdmVfbmFtZSl9IikKICAgICAgICAKICAgICAgICAjIOe7mOWItuagoeWHhuabsue6vwogICAgICAgIGNhbF9jb25maWcgPSB2aXpfY29uZmlnLmdldCgnY2FsaWJyYXRpb24nLCB7fSkKICAgICAgICBpZiBjYWxfY29uZmlnLmdldCgnZW5hYmxlZCcsIFRydWUpOgogICAgICAgICAgICBzYXZlX25hbWUgPSBjYWxfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ2NhbGlicmF0aW9uX2N1cnZlcy5wZGYnKQogICAgICAgICAgICB0aXRsZSA9IGNhbF9jb25maWcuZ2V0KCd0aXRsZScsICdDYWxpYnJhdGlvbiBDdXJ2ZXMnKQogICAgICAgICAgICBpZiBkYXRhc2V0X3ZhbHVlOgogICAgICAgICAgICAgICAgdGl0bGUgPSBmInt0aXRsZX0gLSB7ZGF0YXNldF92YWx1ZX0iCiAgICAgICAgICAgIG5fYmlucyA9IGNhbF9jb25maWcuZ2V0KCduX2JpbnMnLCAxMCkKICAgICAgICAgICAgcGxvdHRlci5wbG90X2NhbGlicmF0aW9uX3YyKG1vZGVsc19kYXRhLCBzYXZlX25hbWU9c2F2ZV9uYW1lLCBuX2JpbnM9bl9iaW5zLCB0aXRsZT10aXRsZSkKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIntkYXRhc2V0X3ZhbHVlKyfnu4QgJyBpZiBkYXRhc2V0X3ZhbHVlIGVsc2UgJyd95qCh5YeG5puy57q/5bey5L+d5a2Y5YiwIHtvcy5wYXRoLmpvaW4ob3V0cHV0X2Rpciwgc2F2ZV9uYW1lKX0iKQogICAgICAgIAogICAgICAgICMg57uY5Yi257K+56Gu546HLeWPrOWbnueOh+absue6vwogICAgICAgIHByX2NvbmZpZyA9IHZpel9jb25maWcuZ2V0KCdwcl9jdXJ2ZScsIHt9KQogICAgICAgIGlmIHByX2NvbmZpZy5nZXQoJ2VuYWJsZWQnLCBUcnVlKToKICAgICAgICAgICAgc2F2ZV9uYW1lID0gcHJfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ3ByZWNpc2lvbl9yZWNhbGxfY3VydmVzLnBkZicpCiAgICAgICAgICAgIHRpdGxlID0gcHJfY29uZmlnLmdldCgndGl0bGUnLCAnUHJlY2lzaW9uLVJlY2FsbCBDdXJ2ZXMnKQogICAgICAgICAgICBpZiBkYXRhc2V0X3ZhbHVlOgogICAgICAgICAgICAgICAgdGl0bGUgPSBmInt0aXRsZX0gLSB7ZGF0YXNldF92YWx1ZX0iCiAgICAgICAgICAgIHBsb3R0ZXIucGxvdF9wcl9jdXJ2ZShtb2RlbHNfZGF0YSwgc2F2ZV9uYW1lPXNhdmVfbmFtZSwgdGl0bGU9dGl0bGUpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJ7ZGF0YXNldF92YWx1ZSsn57uEICcgaWYgZGF0YXNldF92YWx1ZSBlbHNlICcnfeeyvuehrueOhy3lj6zlm57njofmm7Lnur/lt7Lkv53lrZjliLAge29zLnBhdGguam9pbihvdXRwdXRfZGlyLCBzYXZlX25hbWUpfSIpCiAgICAKICAgIGRlZiBfcnVuX2RlbG9uZ190ZXN0KHNlbGYsIG1vZGVsc19kYXRhLCBkYXRhX2RmLCBvdXRwdXRfZGlyLCBkYXRhc2V0X3ZhbHVlPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIFJ1biBEZUxvbmcgdGVzdCBmb3IgY29tcGFyaW5nIEFVQ3MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtb2RlbHNfZGF0YSAoZGljdCk6IE1vZGVscyBkYXRhCiAgICAgICAgICAgIGRhdGFfZGYgKHBkLkRhdGFGcmFtZSk6IERhdGEgRGF0YUZyYW1lCiAgICAgICAgICAgIG91dHB1dF9kaXIgKHN0cik6IE91dHB1dCBkaXJlY3RvcnkKICAgICAgICAgICAgZGF0YXNldF92YWx1ZSAoc3RyLCBvcHRpb25hbCk6IFNwbGl0IHZhbHVlIGZvciBsb2dnaW5nLiBEZWZhdWx0cyB0byBOb25lLgogICAgICAgICIiIgogICAgICAgIGRlbG9uZ19jb25maWcgPSBzZWxmLmNvbmZpZy5nZXQoJ2RlbG9uZ190ZXN0Jywge30pCiAgICAgICAgaWYgZGVsb25nX2NvbmZpZy5nZXQoJ2VuYWJsZWQnLCBUcnVlKSBhbmQgbGVuKG1vZGVsc19kYXRhKSA+PSAyOgogICAgICAgICAgICBzYXZlX25hbWUgPSBkZWxvbmdfY29uZmlnLmdldCgnc2F2ZV9uYW1lJywgJ2RlbG9uZ19yZXN1bHRzLmpzb24nKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDliJvlu7rkuLTml7bor4TkvLDlmagKICAgICAgICAgICAgdGVtcF9ldmFsdWF0b3IgPSBNdWx0aWZpbGVFdmFsdWF0b3Iob3V0cHV0X2Rpcj1vdXRwdXRfZGlyKQogICAgICAgICAgICB0ZW1wX2V2YWx1YXRvci5kYXRhID0gZGF0YV9kZgogICAgICAgICAgICB0ZW1wX2V2YWx1YXRvci5tb2RlbHNfZGF0YSA9IG1vZGVsc19kYXRhCiAgICAgICAgICAgIHRlbXBfZXZhbHVhdG9yLmxhYmVsX2NvbCA9IHNlbGYuZXZhbHVhdG9yLmxhYmVsX2NvbAogICAgICAgICAgICB0ZW1wX2V2YWx1YXRvci5zdWJqZWN0X2lkX2NvbCA9IHNlbGYuZXZhbHVhdG9yLnN1YmplY3RfaWRfY29sCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOiwg+eUqOivhOS8sOWZqOiHquW4pueahERlTG9uZ+ajgOmqjOaWueazlQogICAgICAgICAgICB0ZW1wX2V2YWx1YXRvci5ydW5fZGVsb25nX3Rlc3Qoc2F2ZV9uYW1lKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYie2RhdGFzZXRfdmFsdWUrJ+e7hCAnIGlmIGRhdGFzZXRfdmFsdWUgZWxzZSAnJ31EZUxvbmfmo4Dpqoznu5Pmnpzlt7Lkv53lrZjliLAge29zLnBhdGguam9pbihvdXRwdXRfZGlyLCBzYXZlX25hbWUpfSIpCiAgICAKICAgIGRlZiBfY2FsY3VsYXRlX2FsbF9iYXNpY19tZXRyaWNzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENhbGN1bGF0ZSBhbmQgc2F2ZSBiYXNpYyBtZXRyaWNzIGZvciBhbGwgZGF0YXNldHMgaW4gYSBzaW5nbGUgZmlsZQogICAgICAgICIiIgogICAgICAgIGJhc2ljX21ldHJpY3NfY29uZmlnID0gc2VsZi5jb25maWcuZ2V0KCdtZXRyaWNzJywge30pLmdldCgnYmFzaWNfbWV0cmljcycsIHt9KQogICAgICAgIGlmIG5vdCBiYXNpY19tZXRyaWNzX2NvbmZpZy5nZXQoJ2VuYWJsZWQnLCBGYWxzZSk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLlvIDlp4vorqHnrpfmiYDmnInmlbDmja7pm4bnmoTln7rmnKzmjIfmoIcuLi4iKQogICAgICAgIAogICAgICAgICMg5Li65q+P5Liq5pWw5o2u6ZuG6K6h566X5oyH5qCHCiAgICAgICAgZm9yIGRhdGFzZXRfdmFsdWUsIGRhdGFzZXRfbW9kZWxzX2RhdGEgaW4gc2VsZi5zcGxpdF9ncm91cHMuaXRlbXMoKToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIuiuoeeulyB7ZGF0YXNldF92YWx1ZX0g5pWw5o2u6ZuG55qE5Z+65pys5oyH5qCHLi4uIikKICAgICAgICAgICAgZ3JvdXBfZGYgPSBzZWxmLmV2YWx1YXRvci5kYXRhW3NlbGYuZXZhbHVhdG9yLmRhdGFbc2VsZi5zcGxpdF9jb2x1bW5dID09IGRhdGFzZXRfdmFsdWVdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOehruS/neivpeaVsOaNrumbhuWcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICBpZiBkYXRhc2V0X3ZhbHVlIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXSA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5Li65q+P5Liq5qih5Z6L6K6h566XbWV0cmljcwogICAgICAgICAgICBmb3IgbW9kZWxfbmFtZSwgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSBpbiBkYXRhc2V0X21vZGVsc19kYXRhLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAjIOehruS/neivpeaooeWei+WcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgaWYgbW9kZWxfbmFtZSBub3QgaW4gc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdW21vZGVsX25hbWVdID0ge30KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5aSE55CG5pWw5o2u5bm26K6h566XbWV0cmljcwogICAgICAgICAgICAgICAgbW9kZWxfbWV0cmljcyA9IHNlbGYuX2NvbXB1dGVfbW9kZWxfbWV0cmljcyhtb2RlbF9uYW1lLCB5X3RydWUsIHlfcHJlZF9wcm9iYSwgZ3JvdXBfZGYsIGRhdGFzZXRfdmFsdWUpCiAgICAgICAgICAgICAgICBpZiBtb2RlbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbZGF0YXNldF92YWx1ZV1bbW9kZWxfbmFtZV1bJ2Jhc2ljX21ldHJpY3MnXSA9IG1vZGVsX21ldHJpY3MKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLmiYDmnInmlbDmja7pm4bnmoTln7rmnKzmjIfmoIforqHnrpflrozmiJAiKQogICAgCiAgICBkZWYgX2NhbGN1bGF0ZV9iYXNpY19tZXRyaWNzKHNlbGYsIG1vZGVsc19kYXRhOiBkaWN0LCBkYXRhX2RmOiBwZC5EYXRhRnJhbWUsIG91dHB1dF9kaXI6IHN0ciwgZGF0YXNldF92YWx1ZTogc3RyID0gTm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgQ2FsY3VsYXRlIGJhc2ljIG1ldHJpY3MgZm9yIGVhY2ggbW9kZWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtb2RlbHNfZGF0YSAoZGljdCk6IE1vZGVscyBkYXRhCiAgICAgICAgICAgIGRhdGFfZGYgKHBkLkRhdGFGcmFtZSk6IERhdGEgRGF0YUZyYW1lCiAgICAgICAgICAgIG91dHB1dF9kaXIgKHN0cik6IE91dHB1dCBkaXJlY3RvcnkKICAgICAgICAgICAgZGF0YXNldF92YWx1ZSAoc3RyLCBvcHRpb25hbCk6IFNwbGl0IHZhbHVlIGZvciBsb2dnaW5nLiBEZWZhdWx0cyB0byBOb25lLgogICAgICAgICIiIgogICAgICAgIGJhc2ljX21ldHJpY3NfY29uZmlnID0gc2VsZi5jb25maWcuZ2V0KCdtZXRyaWNzJywge30pLmdldCgnYmFzaWNfbWV0cmljcycsIHt9KQogICAgICAgIGlmIG5vdCBiYXNpY19tZXRyaWNzX2NvbmZpZy5nZXQoJ2VuYWJsZWQnLCBGYWxzZSk6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIuWfuuacrOaMh+agh+iuoeeul+acquWQr+eUqO+8jOi3s+i/h+iuoeeulyIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIuW8gOWni+iuoeeul+WfuuacrOaMh+aghy4uLiIpCiAgICAgICAgCiAgICAgICAgIyDlpoLmnpzmmK/liIbnu4Tor4TkvLDvvIzlsIbnu5Pmnpzmt7vliqDliLDliIbnu4TkuIsKICAgICAgICBpZiBkYXRhc2V0X3ZhbHVlIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjIOehruS/neivpeaVsOaNrumbhuWcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICBpZiBkYXRhc2V0X3ZhbHVlIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXSA9IHt9CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi5Yib5bu65paw55qE5pWw5o2u6ZuG5YiG57uEOiB7ZGF0YXNldF92YWx1ZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDkuLrmr4/kuKrmqKHlnovorqHnrpdtZXRyaWNzCiAgICAgICAgICAgIGZvciBtb2RlbF9uYW1lLCAoeV90cnVlLCB5X3ByZWRfcHJvYmEpIGluIG1vZGVsc19kYXRhLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi6K6h566X5qih5Z6LIHttb2RlbF9uYW1lfSDnmoTln7rmnKzmjIfmoIcuLi4iKQogICAgICAgICAgICAgICAgIyDnoa7kv53or6XmqKHlnovlnKjnu5PmnpzkuK3mnInmnaHnm64KICAgICAgICAgICAgICAgIGlmIG1vZGVsX25hbWUgbm90IGluIHNlbGYuYWxsX21ldHJpY3NbZGF0YXNldF92YWx1ZV06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5aSE55CG5pWw5o2u5bm26K6h566XbWV0cmljcwogICAgICAgICAgICAgICAgbW9kZWxfbWV0cmljcyA9IHNlbGYuX2NvbXB1dGVfbW9kZWxfbWV0cmljcyhtb2RlbF9uYW1lLCB5X3RydWUsIHlfcHJlZF9wcm9iYSwgZGF0YV9kZiwgZGF0YXNldF92YWx1ZSkKICAgICAgICAgICAgICAgIGlmIG1vZGVsX21ldHJpY3M6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXVsnYmFzaWNfbWV0cmljcyddID0gbW9kZWxfbWV0cmljcwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLmqKHlnosge21vZGVsX25hbWV9IOeahOWfuuacrOaMh+agh+iuoeeul+WujOaIkCIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IOaooeWeiyB7bW9kZWxfbmFtZX0g55qE5Z+65pys5oyH5qCH6K6h566X5aSx6LSlIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiJ7ZGF0YXNldF92YWx1ZX3nu4Tln7rmnKzmjIfmoIforqHnrpflrozmiJAiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMg5aaC5p6c5LiN5piv5YiG57uE6K+E5Lyw77yM5Yib5bu65LiA5LiqImFsbCLliIbnu4QKICAgICAgICAgICAgaWYgJ2FsbCcgbm90IGluIHNlbGYuYWxsX21ldHJpY3M6CiAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWydhbGwnXSA9IHt9CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLliJvlu7onYWxsJ+WIhue7hCIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOS4uuavj+S4quaooeWei+iuoeeul21ldHJpY3MKICAgICAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gbW9kZWxzX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLorqHnrpfmqKHlnosge21vZGVsX25hbWV9IOeahOWfuuacrOaMh+aghy4uLiIpCiAgICAgICAgICAgICAgICAjIOehruS/neivpeaooeWei+WcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgaWYgbW9kZWxfbmFtZSBub3QgaW4gc2VsZi5hbGxfbWV0cmljc1snYWxsJ106CiAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1snYWxsJ11bbW9kZWxfbmFtZV0gPSB7fQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOWkhOeQhuaVsOaNruW5tuiuoeeul21ldHJpY3MKICAgICAgICAgICAgICAgIG1vZGVsX21ldHJpY3MgPSBzZWxmLl9jb21wdXRlX21vZGVsX21ldHJpY3MobW9kZWxfbmFtZSwgeV90cnVlLCB5X3ByZWRfcHJvYmEsIGRhdGFfZGYsIGRhdGFzZXRfdmFsdWUpCiAgICAgICAgICAgICAgICBpZiBtb2RlbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddW21vZGVsX25hbWVdWydiYXNpY19tZXRyaWNzJ10gPSBtb2RlbF9tZXRyaWNzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIuaooeWeiyB7bW9kZWxfbmFtZX0g55qE5Z+65pys5oyH5qCH6K6h566X5a6M5oiQIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijog5qih5Z6LIHttb2RlbF9uYW1lfSDnmoTln7rmnKzmjIfmoIforqHnrpflpLHotKUiKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi5Z+65pys5oyH5qCH6K6h566X5a6M5oiQIikKICAgIAogICAgZGVmIF9jYWxjdWxhdGVfeW91ZGVuX21ldHJpY3Moc2VsZiwgZGF0YXNldF92YWx1ZT1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBDYWxjdWxhdGUgWW91ZGVuIG1ldHJpY3MKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkYXRhc2V0X3ZhbHVlIChzdHIsIG9wdGlvbmFsKTogU3BsaXQgdmFsdWUuIERlZmF1bHRzIHRvIE5vbmUuCiAgICAgICAgIiIiCiAgICAgICAgeW91ZGVuX2NvbmZpZyA9IHNlbGYuY29uZmlnLmdldCgnbWV0cmljcycsIHt9KS5nZXQoJ3lvdWRlbl9tZXRyaWNzJywge30pCiAgICAgICAgaWYgbm90IHlvdWRlbl9jb25maWcuZ2V0KCdlbmFibGVkJywgRmFsc2UpOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJZb3VkZW7mjIfmoIforqHnrpfmnKrlkK/nlKjvvIzot7Pov4forqHnrpciKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLlvIDlp4vorqHnrpdZb3VkZW7mjIfmoIcuLi4iKQogICAgICAgIAogICAgICAgICMg5qOA5p+l5piv5ZCm5pyJ5YiG57uECiAgICAgICAgaWYgc2VsZi5zcGxpdF9jb2x1bW4gYW5kIHNlbGYuc3BsaXRfZ3JvdXBzIGFuZCBkYXRhc2V0X3ZhbHVlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfeW91ZGVuX21ldHJpY3NfYnlfc3BsaXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMg5LiN5L2/55So5YiG57uE77yM5Zyo5YWo6YOo5pWw5o2u5LiK6K6h566XWW91ZGVu5oyH5pWwCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIuayoeacieWQr+eUqOaVsOaNruWIhuWJsu+8jOWcqOWFqOmDqOaVsOaNruS4iuiuoeeul1lvdWRlbuaMh+aVsC4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOehruS/nSdhbGwn5YiG57uE5a2Y5ZyoCiAgICAgICAgICAgIGlmICdhbGwnIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1snYWxsJ10gPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgIyDkuLrmr4/kuKrmqKHlnovorqHnrpdZb3VkZW7mjIfmoIcKICAgICAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gc2VsZi5ldmFsdWF0b3IubW9kZWxzX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgICMg5Yib5bu6RGF0YUZyYW1l5Lul5L6/5aSE55CG5Y+v6IO955qETmFO5YC8CiAgICAgICAgICAgICAgICB0ZW1wX2RmID0gcGQuRGF0YUZyYW1lKHsKICAgICAgICAgICAgICAgICAgICAneV90cnVlJzogeV90cnVlLAogICAgICAgICAgICAgICAgICAgICd5X3ByZWRfcHJvYmEnOiB5X3ByZWRfcHJvYmEKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAjIOWIoOmZpOS7u+S9leWMheWQq05hTueahOihjAogICAgICAgICAgICAgICAgdGVtcF9kZiA9IHRlbXBfZGYuZHJvcG5hKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbGVuKHRlbXBfZGYpID4gMDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMg6LCD55SobWV0cmljcy5weeS4reeahGNhbGN1bGF0ZV9tZXRyaWNzX3lvdWRlbuWHveaVsAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9tZXRyaWNzID0gY2FsY3VsYXRlX21ldHJpY3NfeW91ZGVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV90cnVlJ10udmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV9wcmVkX3Byb2JhJ10udmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmInttb2RlbF9uYW1lfSDorqHnrpdZb3VkZW7mjIfmlbDvvIzmnInmlYjmoLfmnKzmlbA6IHtsZW4odGVtcF9kZil9IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMg56Gu5L+d5qih5Z6L5p2h55uu5a2Y5ZyoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsX25hbWUgbm90IGluIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1snYWxsJ11bbW9kZWxfbmFtZV0gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmt7vliqBZb3VkZW7mjIfmoIcKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1snYWxsJ11bbW9kZWxfbmFtZV1bJ3lvdWRlbl9tZXRyaWNzJ10gPSBtb2RlbF9tZXRyaWNzCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOS/neWtmOmYiOWAvOS/oeaBrwogICAgICAgICAgICAgICAgICAgICAgICBpZiAndGhyZXNob2xkJyBpbiBtb2RlbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3RocmVzaG9sZHMnIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzWydhbGwnXVttb2RlbF9uYW1lXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWydhbGwnXVttb2RlbF9uYW1lXVsndGhyZXNob2xkcyddID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddW21vZGVsX25hbWVdWyd0aHJlc2hvbGRzJ11bJ3lvdWRlbiddID0gbW9kZWxfbWV0cmljc1sndGhyZXNob2xkJ10KICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IHttb2RlbF9uYW1lfSDorqHnrpdZb3VkZW7mjIfmlbDml7blh7rplJk6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOayoeacieacieaViOeahOmihOa1i+aVsOaNriIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCJZb3VkZW7mjIfmoIforqHnrpflrozmiJAiKQogICAgCiAgICBkZWYgX2NhbGN1bGF0ZV95b3VkZW5fbWV0cmljc19ieV9zcGxpdChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDYWxjdWxhdGUgWW91ZGVuIG1ldHJpY3MgZm9yIHRyYWluL3Rlc3Qgc3BsaXQgc2NlbmFyaW8KICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi5qC55o2uIHtzZWxmLnNwbGl0X2NvbHVtbn0g5YiG57uE6K6h566XWW91ZGVu5oyH5pWwLi4uIikKICAgICAgICAKICAgICAgICAjIOWcqOiuree7g+mbhuS4iuehruWumumYiOWAvAogICAgICAgIGlmICd0cmFpbicgaW4gc2VsZi5zcGxpdF9ncm91cHM6CiAgICAgICAgICAgIHRyYWluX21vZGVsc19kYXRhID0gc2VsZi5zcGxpdF9ncm91cHNbJ3RyYWluJ10KICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi5L2/55So6K6t57uD6ZuG56Gu5a6aWW91ZGVu5oyH5pWw5pyA5LyY6ZiI5YC8Li4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5Li65q+P5Liq5qih5Z6L6K6h566XWW91ZGVu5oyH5pWw6ZiI5YC8CiAgICAgICAgICAgIHRyYWluX3RocmVzaG9sZHMgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gdHJhaW5fbW9kZWxzX2RhdGEuaXRlbXMoKToKICAgICAgICAgICAgICAgICMg5Yib5bu6RGF0YUZyYW1l5Lul5L6/5aSE55CG5Y+v6IO955qETmFO5YC8CiAgICAgICAgICAgICAgICB0ZW1wX2RmID0gcGQuRGF0YUZyYW1lKHsKICAgICAgICAgICAgICAgICAgICAneV90cnVlJzogeV90cnVlLAogICAgICAgICAgICAgICAgICAgICd5X3ByZWRfcHJvYmEnOiB5X3ByZWRfcHJvYmEKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAjIOWIoOmZpOS7u+S9leWMheWQq05hTueahOihjAogICAgICAgICAgICAgICAgdGVtcF9kZiA9IHRlbXBfZGYuZHJvcG5hKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbGVuKHRlbXBfZGYpID4gMDoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMg6LCD55SobWV0cmljcy5weeS4reeahGNhbGN1bGF0ZV9tZXRyaWNzX3lvdWRlbuWHveaVsAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9tZXRyaWNzID0gY2FsY3VsYXRlX21ldHJpY3NfeW91ZGVuKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV90cnVlJ10udmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV9wcmVkX3Byb2JhJ10udmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmInttb2RlbF9uYW1lfSDorq3nu4Ppm4borqHnrpdZb3VkZW7mjIfmlbDvvIzmnInmlYjmoLfmnKzmlbA6IHtsZW4odGVtcF9kZil9IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMg5L+d5a2Y5q+P5Liq5qih5Z6L55qE5pyA5LyY6ZiI5YC877yM55So5LqO5ZCO57ut5bqU55So5Yiw5rWL6K+V6ZuGCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd0aHJlc2hvbGQnIGluIG1vZGVsX21ldHJpY3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl90aHJlc2hvbGRzW21vZGVsX25hbWVdID0gbW9kZWxfbWV0cmljc1sndGhyZXNob2xkJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLmqKHlnosge21vZGVsX25hbWV9IFlvdWRlbuaMh+aVsOacgOS8mOmYiOWAvDoge3RyYWluX3RocmVzaG9sZHNbbW9kZWxfbmFtZV19IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDnoa7kv510cmFpbuWIhue7hOWtmOWcqAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3RyYWluJyBub3QgaW4gc2VsZi5hbGxfbWV0cmljczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDnoa7kv53mqKHlnovmnaHnm67lrZjlnKgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsX25hbWUgbm90IGluIHNlbGYuYWxsX21ldHJpY3NbJ3RyYWluJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1sndHJhaW4nXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg5re75YqgWW91ZGVu5oyH5qCHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddW21vZGVsX25hbWVdWyd5b3VkZW5fbWV0cmljcyddID0gbW9kZWxfbWV0cmljcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOS/neWtmOmYiOWAvOS/oeaBrwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3RocmVzaG9sZHMnIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddW21vZGVsX25hbWVdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ3RyYWluJ11bbW9kZWxfbmFtZV1bJ3RocmVzaG9sZHMnXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddW21vZGVsX25hbWVdWyd0aHJlc2hvbGRzJ11bJ3lvdWRlbiddID0gbW9kZWxfbWV0cmljc1sndGhyZXNob2xkJ10KICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IHttb2RlbF9uYW1lfSDorqHnrpdZb3VkZW7mjIfmlbDml7blh7rplJk6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOiuree7g+mbhuayoeacieacieaViOeahOmihOa1i+aVsOaNriIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWmguaenOaJvuWIsOS6humYiOWAvO+8jOWwhuWFtuW6lOeUqOWIsOaJgOacieaVsOaNrumbhgogICAgICAgICAgICBpZiB0cmFpbl90aHJlc2hvbGRzOgogICAgICAgICAgICAgICAgIyDlsIbpmIjlgLzlupTnlKjliLDmiYDmnInmlbDmja7pm4YKICAgICAgICAgICAgICAgIGZvciBkYXRhc2V0X3ZhbHVlLCBkYXRhc2V0X21vZGVsc19kYXRhIGluIHNlbGYuc3BsaXRfZ3JvdXBzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIuWwhllvdWRlbuaMh+aVsOacgOS8mOmYiOWAvOW6lOeUqOWIsCB7ZGF0YXNldF92YWx1ZX0g5pWw5o2u6ZuGLi4uIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIOehruS/neivpeaVsOaNrumbhuWcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgICAgIGlmIGRhdGFzZXRfdmFsdWUgbm90IGluIHNlbGYuYWxsX21ldHJpY3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbZGF0YXNldF92YWx1ZV0gPSB7fQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg5Li65q+P5Liq5qih5Z6L5bqU55So6ZiI5YC8CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldF9tZXRyaWNzX3Jlc3VsdHMgPSBzZWxmLl9hcHBseV90aHJlc2hvbGRzX3RvX3Rlc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRfbW9kZWxzX2RhdGEsIHRyYWluX3RocmVzaG9sZHMsICdhcHBseV95b3VkZW5fdGhyZXNob2xkJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIOWwhue7k+aenOa3u+WKoOWIsGFsbF9yZXN1bHRz5LitCiAgICAgICAgICAgICAgICAgICAgZm9yIG1vZGVsX25hbWUsIG1ldHJpY3NfZGF0YSBpbiBkYXRhc2V0X21ldHJpY3NfcmVzdWx0cy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICAjIOehruS/neivpeaooeWei+WcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtb2RlbF9uYW1lIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOa3u+WKoFlvdWRlbuaMh+agh+e7k+aenAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdW21vZGVsX25hbWVdWyd5b3VkZW5fbWV0cmljcyddID0gbWV0cmljc19kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICMg5re75Yqg5L2/55So55qE6ZiI5YC8CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsX25hbWUgaW4gdHJhaW5fdGhyZXNob2xkczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICd0aHJlc2hvbGRzJyBub3QgaW4gc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdW21vZGVsX25hbWVdWyd0aHJlc2hvbGRzJ10gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXVsndGhyZXNob2xkcyddWyd5b3VkZW4nXSA9IHRyYWluX3RocmVzaG9sZHNbbW9kZWxfbmFtZV0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi5omA5pyJ5pWw5o2u6ZuG55qEWW91ZGVu5oyH5pWw6K+E5Lyw5a6M5oiQIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIuitpuWRijog5rKh5pyJ5om+5Yiw5Lu75L2VWW91ZGVu5oyH5pWw5pyA5LyY6ZiI5YC877yM5peg5rOV6K+E5Lyw5pWw5o2u6ZuGIikKICAgIAogICAgZGVmIF9jYWxjdWxhdGVfdGFyZ2V0X21ldHJpY3Moc2VsZiwgZGF0YXNldF92YWx1ZT1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBDYWxjdWxhdGUgbWV0cmljcyBiYXNlZCBvbiB0YXJnZXQgc2Vuc2l0aXZpdHkvc3BlY2lmaWNpdHkKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBkYXRhc2V0X3ZhbHVlIChzdHIsIG9wdGlvbmFsKTogU3BsaXQgdmFsdWUuIERlZmF1bHRzIHRvIE5vbmUuCiAgICAgICAgIiIiCiAgICAgICAgdGFyZ2V0X21ldHJpY3NfY29uZmlnID0gc2VsZi5jb25maWcuZ2V0KCdtZXRyaWNzJywge30pLmdldCgndGFyZ2V0X21ldHJpY3MnLCB7fSkKICAgICAgICBpZiBub3QgdGFyZ2V0X21ldHJpY3NfY29uZmlnLmdldCgnZW5hYmxlZCcsIEZhbHNlKToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi55uu5qCH5oyH5qCH6K6h566X5pyq5ZCv55So77yM6Lez6L+H6K6h566XIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi5byA5aeL6K6h566X55uu5qCH5oyH5qCHLi4uIikKICAgICAgICAKICAgICAgICAjIOajgOafpeaYr+WQpuacieacieaViOeahOebruagh+aMh+agh+mFjee9rgogICAgICAgIGlmIG5vdCB0YXJnZXRfbWV0cmljc19jb25maWcuZ2V0KCd0YXJnZXRzJywge30pOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKCLorablkYo6IOebruagh+aMh+agh+mFjee9ruS4uuepuu+8jOi3s+i/h+ebruagh+aMh+agh+iuoeeulyIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg5qOA5p+l5piv5ZCm5pyJ5YiG57uECiAgICAgICAgaWYgc2VsZi5zcGxpdF9jb2x1bW4gYW5kIHNlbGYuc3BsaXRfZ3JvdXBzIGFuZCBkYXRhc2V0X3ZhbHVlIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjIOi/meaYr+aMiee7hOWIhuaekOeahOWFpeWPo+eCue+8jOmcgOimgeWFiOWcqOiuree7g+mbhuehruWumumYiOWAvO+8jOWGjeW6lOeUqOWIsOa1i+ivlembhgogICAgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdGFyZ2V0X21ldHJpY3NfYnlfc3BsaXQodGFyZ2V0X21ldHJpY3NfY29uZmlnLmdldCgndGFyZ2V0cycsIHt9KSkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIOS4jeS9v+eUqOWIhue7hO+8jOWcqOWFqOmDqOaVsOaNruS4iuiuoeeul+ebruagh+aMh+aghwogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLmsqHmnInlkK/nlKjmlbDmja7liIblibLvvIzlnKjlhajpg6jmlbDmja7kuIrorqHnrpfnm67moIfmjIfmoIfpmIjlgLwuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnoa7kv50nYWxsJ+WIhue7hOWtmOWcqAogICAgICAgICAgICBpZiAnYWxsJyBub3QgaW4gc2VsZi5hbGxfbWV0cmljczoKICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddID0ge30KICAgICAgICAgICAgCiAgICAgICAgICAgICMg5Li65q+P5Liq5qih5Z6L6K6h566X55uu5qCH5oyH5qCHCiAgICAgICAgICAgIGZvciBtb2RlbF9uYW1lLCAoeV90cnVlLCB5X3ByZWRfcHJvYmEpIGluIHNlbGYuZXZhbHVhdG9yLm1vZGVsc19kYXRhLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAjIOWIm+W7ukRhdGFGcmFtZeS7peS+v+WkhOeQhuWPr+iDveeahE5hTuWAvAogICAgICAgICAgICAgICAgdGVtcF9kZiA9IHBkLkRhdGFGcmFtZSh7CiAgICAgICAgICAgICAgICAgICAgJ3lfdHJ1ZSc6IHlfdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAneV9wcmVkX3Byb2JhJzogeV9wcmVkX3Byb2JhCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgIyDliKDpmaTku7vkvZXljIXlkKtOYU7nmoTooYwKICAgICAgICAgICAgICAgIHRlbXBfZGYgPSB0ZW1wX2RmLmRyb3BuYSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGxlbih0ZW1wX2RmKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIOiwg+eUqG1ldHJpY3MucHnkuK3nmoRjYWxjdWxhdGVfbWV0cmljc19hdF90YXJnZXTlh73mlbAKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfbWV0cmljcyA9IGNhbGN1bGF0ZV9tZXRyaWNzX2F0X3RhcmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfdHJ1ZSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfcHJlZF9wcm9iYSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9tZXRyaWNzX2NvbmZpZy5nZXQoJ3RhcmdldHMnLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYie21vZGVsX25hbWV9IOiuoeeul+ebruagh+aMh+agh++8jOacieaViOagt+acrOaVsDoge2xlbih0ZW1wX2RmKX0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDnoa7kv53mqKHlnovmnaHnm67lrZjlnKgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbW9kZWxfbmFtZSBub3QgaW4gc2VsZi5hbGxfbWV0cmljc1snYWxsJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWydhbGwnXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOa3u+WKoOebruagh+aMh+aghwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWydhbGwnXVttb2RlbF9uYW1lXVsndGFyZ2V0X21ldHJpY3MnXSA9IG1vZGVsX21ldHJpY3MKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMg5L+d5a2Y6ZiI5YC85L+h5oGvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdjb21iaW5lZF9yZXN1bHRzJyBpbiBtb2RlbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluZWRfa2V5ID0gJyAmICcuam9pbih0YXJnZXRfbWV0cmljc19jb25maWcuZ2V0KCd0YXJnZXRzJywge30pLmtleXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvbWJpbmVkX2tleSBpbiBtb2RlbF9tZXRyaWNzWydjb21iaW5lZF9yZXN1bHRzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluZWRfdGhyZXNob2xkcyA9IG1vZGVsX21ldHJpY3NbJ2NvbWJpbmVkX3Jlc3VsdHMnXVtjb21iaW5lZF9rZXldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29tYmluZWRfdGhyZXNob2xkczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfdGhyZXNob2xkX2tleSA9IG5leHQoaXRlcihjb21iaW5lZF90aHJlc2hvbGRzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3RocmVzaG9sZCA9IGZsb2F0KGZpcnN0X3RocmVzaG9sZF9rZXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAndGhyZXNob2xkcycgbm90IGluIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddW21vZGVsX25hbWVdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1snYWxsJ11bbW9kZWxfbmFtZV1bJ3RocmVzaG9sZHMnXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ2FsbCddW21vZGVsX25hbWVdWyd0aHJlc2hvbGRzJ11bJ3RhcmdldCddID0gdGFyZ2V0X3RocmVzaG9sZAogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOiuoeeul+ebruagh+aMh+agh+aXtuWHuumUmToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYi6K2m5ZGKOiB7bW9kZWxfbmFtZX0g5rKh5pyJ5pyJ5pWI55qE6aKE5rWL5pWw5o2uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIuebruagh+aMh+agh+iuoeeul+WujOaIkCIpCiAgICAKICAgIGRlZiBfY2FsY3VsYXRlX3RhcmdldF9tZXRyaWNzX2J5X3NwbGl0KHNlbGYsIHRhcmdldHMpOgogICAgICAgICIiIgogICAgICAgIENhbGN1bGF0ZSB0YXJnZXQgbWV0cmljcyBmb3IgdHJhaW4vdGVzdCBzcGxpdCBzY2VuYXJpbwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRhcmdldHMgKGRpY3QpOiBUYXJnZXQgbWV0cmljcwogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLmoLnmja4ge3NlbGYuc3BsaXRfY29sdW1ufSDliIbnu4TorqHnrpfnm67moIfmjIfmoIfpmIjlgLwuLi4iKQogICAgICAgIAogICAgICAgICMg5Zyo6K6t57uD6ZuG5LiK56Gu5a6a6ZiI5YC8CiAgICAgICAgaWYgJ3RyYWluJyBpbiBzZWxmLnNwbGl0X2dyb3VwczoKICAgICAgICAgICAgdHJhaW5fbW9kZWxzX2RhdGEgPSBzZWxmLnNwbGl0X2dyb3Vwc1sndHJhaW4nXQogICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKCLkvb/nlKjorq3nu4Ppm4bnoa7lrprnm67moIfmjIfmoIfpmIjlgLwuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDkuLrorq3nu4Ppm4borqHnrpfnm67moIfmjIfmoIcKICAgICAgICAgICAgdHJhaW5fdGhyZXNob2xkcyA9IHt9CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgbW9kZWxfbmFtZSwgKHlfdHJ1ZSwgeV9wcmVkX3Byb2JhKSBpbiB0cmFpbl9tb2RlbHNfZGF0YS5pdGVtcygpOgogICAgICAgICAgICAgICAgIyDliJvlu7pEYXRhRnJhbWXku6Xkvr/lpITnkIblj6/og73nmoROYU7lgLwKICAgICAgICAgICAgICAgIHRlbXBfZGYgPSBwZC5EYXRhRnJhbWUoewogICAgICAgICAgICAgICAgICAgICd5X3RydWUnOiB5X3RydWUsCiAgICAgICAgICAgICAgICAgICAgJ3lfcHJlZF9wcm9iYSc6IHlfcHJlZF9wcm9iYQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICMg5Yig6Zmk5Lu75L2V5YyF5ZCrTmFO55qE6KGMCiAgICAgICAgICAgICAgICB0ZW1wX2RmID0gdGVtcF9kZi5kcm9wbmEoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBsZW4odGVtcF9kZikgPiAwOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyDorqHnrpfnm67moIfmjIfmoIcKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfbWV0cmljcyA9IGNhbGN1bGF0ZV9tZXRyaWNzX2F0X3RhcmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfdHJ1ZSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfcHJlZF9wcm9iYSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHMKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYie21vZGVsX25hbWV9IOiuree7g+mbhuiuoeeul+ebruagh+aMh+agh++8jOacieaViOagt+acrOaVsDoge2xlbih0ZW1wX2RmKX0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDnoa7kv510cmFpbuWIhue7hOWtmOWcqAogICAgICAgICAgICAgICAgICAgICAgICBpZiAndHJhaW4nIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1sndHJhaW4nXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOehruS/neaooeWei+adoeebruWtmOWcqAogICAgICAgICAgICAgICAgICAgICAgICBpZiBtb2RlbF9uYW1lIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1sndHJhaW4nXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOa3u+WKoOebruagh+aMh+aghwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzWyd0cmFpbiddW21vZGVsX25hbWVdWyd0YXJnZXRfbWV0cmljcyddID0gbW9kZWxfbWV0cmljcwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmo4Dmn6XmmK/lkKbmnInlkIzml7bmu6HotrPmiYDmnInnm67moIfnmoTpmIjlgLwKICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluZWRfa2V5ID0gJyAmICcuam9pbih0YXJnZXRzLmtleXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2NvbWJpbmVkX3Jlc3VsdHMnIGluIG1vZGVsX21ldHJpY3MgYW5kIGNvbWJpbmVkX2tleSBpbiBtb2RlbF9tZXRyaWNzWydjb21iaW5lZF9yZXN1bHRzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOaJvuWIsOesrOS4gOS4quWQjOaXtua7oei2s+aJgOacieebruagh+eahOmYiOWAvAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluZWRfdGhyZXNob2xkcyA9IG1vZGVsX21ldHJpY3NbJ2NvbWJpbmVkX3Jlc3VsdHMnXVtjb21iaW5lZF9rZXldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb21iaW5lZF90aHJlc2hvbGRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg6I635Y+W56ys5LiA5Liq6ZiI5YC8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfdGhyZXNob2xkX2tleSA9IG5leHQoaXRlcihjb21iaW5lZF90aHJlc2hvbGRzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl90aHJlc2hvbGRzW21vZGVsX25hbWVdID0gZmxvYXQoZmlyc3RfdGhyZXNob2xkX2tleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi5qih5Z6LIHttb2RlbF9uYW1lfSDlkIzml7bmu6HotrPmiYDmnInnm67moIfnmoTpmIjlgLw6IHt0cmFpbl90aHJlc2hvbGRzW21vZGVsX25hbWVdfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDkv53lrZjpmIjlgLzkv6Hmga8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAndGhyZXNob2xkcycgbm90IGluIHNlbGYuYWxsX21ldHJpY3NbJ3RyYWluJ11bbW9kZWxfbmFtZV06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbJ3RyYWluJ11bbW9kZWxfbmFtZV1bJ3RocmVzaG9sZHMnXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1sndHJhaW4nXVttb2RlbF9uYW1lXVsndGhyZXNob2xkcyddWyd0YXJnZXQnXSA9IHRyYWluX3RocmVzaG9sZHNbbW9kZWxfbmFtZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOayoeacieaJvuWIsOWQjOaXtua7oei2s+aJgOacieebruagh+eahOmYiOWAvCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYi6K2m5ZGKOiB7bW9kZWxfbmFtZX0g5rKh5pyJ5om+5Yiw5ZCM5pe25ruh6Laz5omA5pyJ55uu5qCH55qE6ZiI5YC8IikKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IHttb2RlbF9uYW1lfSDorqHnrpfnm67moIfmjIfmoIfml7blh7rplJk6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOiuree7g+mbhuayoeacieacieaViOeahOmihOa1i+aVsOaNriIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWmguaenOaJvuWIsOS6humYiOWAvO+8jOWwhuWFtuW6lOeUqOWIsOaJgOacieaVsOaNrumbhgogICAgICAgICAgICBpZiB0cmFpbl90aHJlc2hvbGRzOgogICAgICAgICAgICAgICAgIyDlsIbpmIjlgLzlupTnlKjliLDmiYDmnInmlbDmja7pm4YKICAgICAgICAgICAgICAgIGZvciBkYXRhc2V0X3ZhbHVlLCBkYXRhc2V0X21vZGVsc19kYXRhIGluIHNlbGYuc3BsaXRfZ3JvdXBzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIuWwhuebruagh+aMh+agh+mYiOWAvOW6lOeUqOWIsCB7ZGF0YXNldF92YWx1ZX0g5pWw5o2u6ZuGLi4uIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIOehruS/neivpeaVsOaNrumbhuWcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgICAgIGlmIGRhdGFzZXRfdmFsdWUgbm90IGluIHNlbGYuYWxsX21ldHJpY3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWxsX21ldHJpY3NbZGF0YXNldF92YWx1ZV0gPSB7fQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg5Li65q+P5Liq5qih5Z6L5bqU55So6ZiI5YC8CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldF9tZXRyaWNzX3Jlc3VsdHMgPSBzZWxmLl9hcHBseV90aHJlc2hvbGRzX3RvX3Rlc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRfbW9kZWxzX2RhdGEsIHRyYWluX3RocmVzaG9sZHMsICdhcHBseV90YXJnZXRfdGhyZXNob2xkJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIOWwhue7k+aenOa3u+WKoOWIsGFsbF9tZXRyaWNz5LitCiAgICAgICAgICAgICAgICAgICAgZm9yIG1vZGVsX25hbWUsIG1ldHJpY3NfZGF0YSBpbiBkYXRhc2V0X21ldHJpY3NfcmVzdWx0cy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICAjIOehruS/neivpeaooeWei+WcqOe7k+aenOS4reacieadoeebrgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtb2RlbF9uYW1lIG5vdCBpbiBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOa3u+WKoOebruagh+aMh+agh+e7k+aenAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdW21vZGVsX25hbWVdWyd0YXJnZXRfbWV0cmljcyddID0gbWV0cmljc19kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICMg5re75Yqg5L2/55So55qE6ZiI5YC8CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsX25hbWUgaW4gdHJhaW5fdGhyZXNob2xkczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICd0aHJlc2hvbGRzJyBub3QgaW4gc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsbF9tZXRyaWNzW2RhdGFzZXRfdmFsdWVdW21vZGVsX25hbWVdWyd0aHJlc2hvbGRzJ10gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljc1tkYXRhc2V0X3ZhbHVlXVttb2RlbF9uYW1lXVsndGhyZXNob2xkcyddWyd0YXJnZXQnXSA9IHRyYWluX3RocmVzaG9sZHNbbW9kZWxfbmFtZV0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygi5omA5pyJ5pWw5o2u6ZuG55qE55uu5qCH5oyH5qCH6K+E5Lyw5a6M5oiQIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoIuitpuWRijog5rKh5pyJ5om+5Yiw5Lu75L2V5ZCM5pe25ruh6Laz5omA5pyJ55uu5qCH55qE6ZiI5YC877yM5peg5rOV6K+E5Lyw5pWw5o2u6ZuGIikKICAgIAogICAgZGVmIF9hcHBseV90aHJlc2hvbGRzX3RvX3Rlc3Qoc2VsZiwgdGVzdF9tb2RlbHNfZGF0YSwgdHJhaW5fdGhyZXNob2xkcywgYXBwbHlfZnVuY3Rpb25fbmFtZSk6CiAgICAgICAgIiIiCiAgICAgICAgQXBwbHkgdGhyZXNob2xkcyBmcm9tIHRyYWluaW5nIHNldCB0byB0ZXN0IHNldAogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRlc3RfbW9kZWxzX2RhdGEgKGRpY3QpOiBUZXN0IHNldCBtb2RlbHMgZGF0YQogICAgICAgICAgICB0cmFpbl90aHJlc2hvbGRzIChkaWN0KTogVGhyZXNob2xkcyBmcm9tIHRyYWluaW5nIHNldAogICAgICAgICAgICBhcHBseV9mdW5jdGlvbl9uYW1lIChzdHIpOiBOYW1lIG9mIHRoZSBmdW5jdGlvbiB0byBhcHBseSB0aHJlc2hvbGRzCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IFJlc3VsdHMgb2YgYXBwbHlpbmcgdGhyZXNob2xkcyB0byB0ZXN0IHNldAogICAgICAgICIiIgogICAgICAgIHRlc3RfcmVzdWx0cyA9IHt9CiAgICAgICAgCiAgICAgICAgZm9yIG1vZGVsX25hbWUsICh5X3RydWUsIHlfcHJlZF9wcm9iYSkgaW4gdGVzdF9tb2RlbHNfZGF0YS5pdGVtcygpOgogICAgICAgICAgICAjIOajgOafpeaYr+WQpuacieivpeaooeWei+eahOiuree7g+mbhumYiOWAvAogICAgICAgICAgICBpZiBtb2RlbF9uYW1lIGluIHRyYWluX3RocmVzaG9sZHM6CiAgICAgICAgICAgICAgICAjIOWIm+W7ukRhdGFGcmFtZeS7peS+v+WkhOeQhuWPr+iDveeahE5hTuWAvAogICAgICAgICAgICAgICAgdGVtcF9kZiA9IHBkLkRhdGFGcmFtZSh7CiAgICAgICAgICAgICAgICAgICAgJ3lfdHJ1ZSc6IHlfdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAneV9wcmVkX3Byb2JhJzogeV9wcmVkX3Byb2JhCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgIyDliKDpmaTku7vkvZXljIXlkKtOYU7nmoTooYwKICAgICAgICAgICAgICAgIHRlbXBfZGYgPSB0ZW1wX2RmLmRyb3BuYSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGxlbih0ZW1wX2RmKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgIyDkvb/nlKjorq3nu4Ppm4bnoa7lrprnmoTpmIjlgLzor4TkvLDmtYvor5Xpm4YKICAgICAgICAgICAgICAgICAgICB0aHJlc2hvbGQgPSB0cmFpbl90aHJlc2hvbGRzW21vZGVsX25hbWVdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIOagueaNruWHveaVsOWQjeWKqOaAgemAieaLqeW6lOeUqOmYiOWAvOeahOWHveaVsAogICAgICAgICAgICAgICAgICAgICAgICBpZiBhcHBseV9mdW5jdGlvbl9uYW1lID09ICdhcHBseV95b3VkZW5fdGhyZXNob2xkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RfbWV0cmljcyA9IGFwcGx5X3lvdWRlbl90aHJlc2hvbGQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV90cnVlJ10udmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfcHJlZF9wcm9iYSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlc2hvbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhcHBseV9mdW5jdGlvbl9uYW1lID09ICdhcHBseV90YXJnZXRfdGhyZXNob2xkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RfbWV0cmljcyA9IGFwcGx5X3RhcmdldF90aHJlc2hvbGQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9kZlsneV90cnVlJ10udmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBfZGZbJ3lfcHJlZF9wcm9iYSddLnZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJlc2hvbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiLmnKrnn6XnmoTlupTnlKjpmIjlgLzlh73mlbA6IHthcHBseV9mdW5jdGlvbl9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0ZXN0X3Jlc3VsdHNbbW9kZWxfbmFtZV0gPSB0ZXN0X21ldHJpY3MKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmInttb2RlbF9uYW1lfSDmtYvor5Xpm4blupTnlKjorq3nu4Ppm4bpmIjlgLzor4TkvLDlrozmiJDvvIzmnInmlYjmoLfmnKzmlbA6IHtsZW4odGVtcF9kZil9IikKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IHttb2RlbF9uYW1lfSDmtYvor5Xpm4blupTnlKjpmIjlgLzml7blh7rplJk6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijoge21vZGVsX25hbWV9IOa1i+ivlembhuayoeacieacieaViOeahOmihOa1i+aVsOaNriIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYi6K2m5ZGKOiB7bW9kZWxfbmFtZX0g5rWL6K+V6ZuG6K+E5Lyw5aSx6LSl77yM5rKh5pyJ5om+5Yiw6K6t57uD6ZuG6ZiI5YC8IikKICAgICAgICAKICAgICAgICByZXR1cm4gdGVzdF9yZXN1bHRzCgogICAgZGVmIF9jb21wdXRlX21vZGVsX21ldHJpY3Moc2VsZiwgbW9kZWxfbmFtZTogc3RyLCB5X3RydWU6IG5wLm5kYXJyYXksIHlfcHJlZF9wcm9iYTogbnAubmRhcnJheSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YV9kZjogcGQuRGF0YUZyYW1lLCBkYXRhc2V0X3ZhbHVlOiBzdHIgPSBOb25lKSAtPiBkaWN0OgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgYmFzaWMgbWV0cmljcyBmb3IgYSBzaW5nbGUgbW9kZWwKICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBtb2RlbF9uYW1lIChzdHIpOiBOYW1lIG9mIHRoZSBtb2RlbAogICAgICAgICAgICB5X3RydWUgKG5wLm5kYXJyYXkpOiBUcnVlIGxhYmVscwogICAgICAgICAgICB5X3ByZWRfcHJvYmEgKG5wLm5kYXJyYXkpOiBQcmVkaWN0ZWQgcHJvYmFiaWxpdGllcwogICAgICAgICAgICBkYXRhX2RmIChwZC5EYXRhRnJhbWUpOiBEYXRhIERhdGFGcmFtZQogICAgICAgICAgICBkYXRhc2V0X3ZhbHVlIChzdHIsIG9wdGlvbmFsKTogU3BsaXQgdmFsdWUgZm9yIGxvZ2dpbmcuIERlZmF1bHRzIHRvIE5vbmUuCiAgICAgICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGRpY3Q6IERpY3Rpb25hcnkgY29udGFpbmluZyBiYXNpYyBtZXRyaWNzCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENyZWF0ZSBhIHRlbXBvcmFyeSBEYXRhRnJhbWUgdG8gaGFuZGxlIE5hTiB2YWx1ZXMKICAgICAgICAgICAgdGVtcF9kZiA9IHBkLkRhdGFGcmFtZSh7CiAgICAgICAgICAgICAgICAneV90cnVlJzogeV90cnVlLAogICAgICAgICAgICAgICAgJ3lfcHJlZF9wcm9iYSc6IHlfcHJlZF9wcm9iYQogICAgICAgICAgICB9KQogICAgICAgICAgICAjIFJlbW92ZSBhbnkgcm93cyBjb250YWluaW5nIE5hTgogICAgICAgICAgICB0ZW1wX2RmID0gdGVtcF9kZi5kcm9wbmEoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbGVuKHRlbXBfZGYpID4gMDoKICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIGJhc2ljIG1ldHJpY3MgdXNpbmcgdGhlIG1ldHJpY3MgbW9kdWxlCiAgICAgICAgICAgICAgICAjIOehruS/nXlfdHJ1ZeWSjHlfcHJlZF9wcm9iYemDveaYr251bXB55pWw57uECiAgICAgICAgICAgICAgICB5X3RydWVfYXJyYXkgPSB0ZW1wX2RmWyd5X3RydWUnXS52YWx1ZXMKICAgICAgICAgICAgICAgIHlfcHJlZF9wcm9iYV9hcnJheSA9IHRlbXBfZGZbJ3lfcHJlZF9wcm9iYSddLnZhbHVlcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOiuoeeul+mihOa1i+agh+etvu+8iOS9v+eUqDAuNeS9nOS4uumYiOWAvO+8iQogICAgICAgICAgICAgICAgeV9wcmVkX2FycmF5ID0gKHlfcHJlZF9wcm9iYV9hcnJheSA+PSAwLjUpLmFzdHlwZShpbnQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5omT5Y2w6LCD6K+V5L+h5oGvCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmIuiwg+ivleS/oeaBryAtIHttb2RlbF9uYW1lfToiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJ5X3RydWUgc2hhcGU6IHt5X3RydWVfYXJyYXkuc2hhcGV9IikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYieV9wcmVkX3Byb2JhIHNoYXBlOiB7eV9wcmVkX3Byb2JhX2FycmF5LnNoYXBlfSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmInlfcHJlZCBzaGFwZToge3lfcHJlZF9hcnJheS5zaGFwZX0iKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoZiJ5X3RydWUgdW5pcXVlIHZhbHVlczoge25wLnVuaXF1ZSh5X3RydWVfYXJyYXkpfSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZyhmInlfcHJlZCB1bmlxdWUgdmFsdWVzOiB7bnAudW5pcXVlKHlfcHJlZF9hcnJheSl9IikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKGYieV9wcmVkX3Byb2JhIHJhbmdlOiBbe25wLm1pbih5X3ByZWRfcHJvYmFfYXJyYXkpfSwge25wLm1heCh5X3ByZWRfcHJvYmFfYXJyYXkpfV0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBtZXRyaWNzID0gY2FsY3VsYXRlX21ldHJpY3MoCiAgICAgICAgICAgICAgICAgICAgeV90cnVlPXlfdHJ1ZV9hcnJheSwKICAgICAgICAgICAgICAgICAgICB5X3ByZWRfcHJvYmE9eV9wcmVkX3Byb2JhX2FycmF5LAogICAgICAgICAgICAgICAgICAgIHlfcHJlZD15X3ByZWRfYXJyYXkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmInttb2RlbF9uYW1lfSB7JygnICsgZGF0YXNldF92YWx1ZSArICfnu4QpICcgaWYgZGF0YXNldF92YWx1ZSBlbHNlICcnfeiuoeeul+WfuuacrOaMh+agh++8jOacieaViOagt+acrOaVsDoge2xlbih0ZW1wX2RmKX0iKQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldHJpY3MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm5pbmcoZiLorablkYo6IHttb2RlbF9uYW1lfSB7JygnICsgZGF0YXNldF92YWx1ZSArICfnu4QpICcgaWYgZGF0YXNldF92YWx1ZSBlbHNlICcnfeayoeacieacieaViOeahOmihOa1i+aVsOaNriIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKGYi6K2m5ZGKOiB7bW9kZWxfbmFtZX0geycoJyArIGRhdGFzZXRfdmFsdWUgKyAn57uEKSAnIGlmIGRhdGFzZXRfdmFsdWUgZWxzZSAnJ33orqHnrpfln7rmnKzmjIfmoIfml7blh7rplJk6IHtzdHIoZSl9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgc2F2ZV9hbGxfbWV0cmljcyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBTYXZlIGFsbCBtZXRyaWNzIHRvIGEgc2luZ2xlIEpTT04gZmlsZQogICAgICAgICIiIgogICAgICAgICMg5Yib5bu6bWV0cmljc+ebruW9lQogICAgICAgIG1ldHJpY3NfZGlyID0gb3MucGF0aC5qb2luKHNlbGYub3V0cHV0X2RpciwgJ21ldHJpY3MnKQogICAgICAgIG9zLm1ha2VkaXJzKG1ldHJpY3NfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgIAogICAgICAgICMg6K6+572u5L+d5a2Y6Lev5b6ECiAgICAgICAgc2F2ZV9wYXRoID0gb3MucGF0aC5qb2luKG1ldHJpY3NfZGlyLCAnbWV0cmljcy5qc29uJykKICAgICAgICAKICAgICAgICAjIOWmguaenOaWh+S7tuW3suWtmOWcqO+8jOWFiOWKoOi9veWugwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNhdmVfcGF0aCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihzYXZlX3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBleGlzdGluZ19tZXRyaWNzID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgICAgICAjIOWQiOW5tueOsOacieaMh+agh+WSjOaWsOiuoeeul+eahOaMh+aghwogICAgICAgICAgICAgICAgZm9yIGdyb3VwX2tleSBpbiBzZWxmLmFsbF9tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgIGlmIGdyb3VwX2tleSBpbiBleGlzdGluZ19tZXRyaWNzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbW9kZWxfa2V5IGluIHNlbGYuYWxsX21ldHJpY3NbZ3JvdXBfa2V5XToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsX2tleSBpbiBleGlzdGluZ19tZXRyaWNzW2dyb3VwX2tleV06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfbWV0cmljc1tncm91cF9rZXldW21vZGVsX2tleV0udXBkYXRlKHNlbGYuYWxsX21ldHJpY3NbZ3JvdXBfa2V5XVttb2RlbF9rZXldKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ19tZXRyaWNzW2dyb3VwX2tleV1bbW9kZWxfa2V5XSA9IHNlbGYuYWxsX21ldHJpY3NbZ3JvdXBfa2V5XVttb2RlbF9rZXldCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfbWV0cmljc1tncm91cF9rZXldID0gc2VsZi5hbGxfbWV0cmljc1tncm91cF9rZXldCiAgICAgICAgICAgICAgICAjIOabtOaWsOacrOWcsOaMh+agh+Wtl+WFuAogICAgICAgICAgICAgICAgc2VsZi5hbGxfbWV0cmljcyA9IGV4aXN0aW5nX21ldHJpY3MKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybmluZyhmIuitpuWRijog5peg5rOV6K+75Y+W546w5pyJbWV0cmljc+aWh+S7tjoge3N0cihlKX0iKQogICAgICAgIAogICAgICAgICMg5L+d5a2Y57uT5p6cCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oc2F2ZV9wYXRoLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICBqc29uLmR1bXAoc2VsZi5hbGxfbWV0cmljcywgZiwgaW5kZW50PTQpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oZiLmiYDmnInmjIfmoIflt7Lkv53lrZjliLAge3NhdmVfcGF0aH0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmiZPljbDnu5Pmnpznu5/orqEKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhmIuS/neWtmOeahOaMh+agh+WIhue7hOaVsOmHjzoge2xlbihzZWxmLmFsbF9tZXRyaWNzKX0iKQogICAgICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBzZWxmLmFsbF9tZXRyaWNzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYi5YiG57uEIHtrZXl9IOS4reeahOaooeWei+aVsOmHjzoge2xlbih2YWx1ZSl9IikKICAgICAgICAgICAgICAgIGZvciBtb2RlbF9uYW1lLCBtZXRyaWNzIGluIHZhbHVlLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgbWV0cmljX3R5cGVzID0gbGlzdChtZXRyaWNzLmtleXMoKSkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5pbmZvKGYiICDmqKHlnosge21vZGVsX25hbWV9IOeahOaMh+agh+exu+WeizogeycsICcuam9pbihtZXRyaWNfdHlwZXMpfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihmIuS/neWtmOaMh+agh+aXtuWHuumUmToge3N0cihlKX0iKQoKICAgIGRlZiBydW4oc2VsZik6ICAgIAogICAgICAgIAogICAgICAgICMg6K+75Y+W5ZKM5YeG5aSH5pWw5o2uCiAgICAgICAgc2VsZi5zZXR1cCgpCiAgICAgICAgCiAgICAgICAgIyDkv53lrZjlkIjlubbmlbDmja4KICAgICAgICBzZWxmLnNhdmVfbWVyZ2VkX2RhdGEoKQogICAgICAgIAogICAgICAgICMg5omn6KGM6K+E5LywCiAgICAgICAgc2VsZi5ydW5fZXZhbHVhdGlvbigpCiAgICAgICAgCiAgICAgICAgIyDkv53lrZjmiYDmnInmjIfmoIcKICAgICAgICBzZWxmLnNhdmVfYWxsX21ldHJpY3MoKQogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmluZm8oIuivhOS8sOWujOaIkO+8geaJgOaciee7k+aenOW3suS/neWtmOWIsCIgKyBzZWxmLm91dHB1dF9kaXIpCg==').decode())
