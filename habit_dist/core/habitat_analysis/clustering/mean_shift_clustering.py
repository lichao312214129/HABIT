
import base64
exec(base64.b64decode(b'IiIiDQpJbXBsZW1lbnRhdGlvbiBvZiBNZWFuIFNoaWZ0IENsdXN0ZXJpbmcgYWxnb3JpdGhtDQoiIiINCg0KaW1wb3J0IG51bXB5IGFzIG5wDQpmcm9tIHNrbGVhcm4uY2x1c3RlciBpbXBvcnQgTWVhblNoaWZ0DQpmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgc2lsaG91ZXR0ZV9zY29yZSwgY2FsaW5za2lfaGFyYWJhc3pfc2NvcmUsIGRhdmllc19ib3VsZGluX3Njb3JlDQpmcm9tIHR5cGluZyBpbXBvcnQgVHVwbGUsIERpY3QsIEFueSwgT3B0aW9uYWwsIExpc3QNCmZyb20gaGFiaXRhdF9jbHVzdGVyaW5nLmNsdXN0ZXJpbmcuYmFzZV9jbHVzdGVyaW5nIGltcG9ydCBCYXNlQ2x1c3RlcmluZywgcmVnaXN0ZXJfY2x1c3RlcmluZw0KDQpAcmVnaXN0ZXJfY2x1c3RlcmluZygnbWVhbl9zaGlmdCcpDQpjbGFzcyBNZWFuU2hpZnRDbHVzdGVyaW5nKEJhc2VDbHVzdGVyaW5nKToNCiAgICAiIiINCiAgICBNZWFuIFNoaWZ0IENsdXN0ZXJpbmcgaW1wbGVtZW50YXRpb24NCiAgICANCiAgICBQYXJhbWV0ZXJzOg0KICAgIC0tLS0tLS0tLS0tDQogICAgYmFuZHdpZHRoIDogZmxvYXQsIG9wdGlvbmFsIChkZWZhdWx0PU5vbmUpDQogICAgICAgIEJhbmR3aWR0aCB1c2VkIGluIHRoZSBSQkYga2VybmVsLiBJZiBub3QgZ2l2ZW4sIHRoZSBiYW5kd2lkdGggaXMgZXN0aW1hdGVkDQogICAgICAgIHVzaW5nIHNrbGVhcm4uY2x1c3Rlci5lc3RpbWF0ZV9iYW5kd2lkdGgNCiAgICAgICAgDQogICAgc2VlZHMgOiBhcnJheSwgc2hhcGU9W25fc2FtcGxlcywgbl9mZWF0dXJlc10sIG9wdGlvbmFsIChkZWZhdWx0PU5vbmUpDQogICAgICAgIFNlZWRzIHVzZWQgdG8gaW5pdGlhbGl6ZSBrZXJuZWxzLiBJZiBub3Qgc2V0LCB0aGUgc2VlZHMgYXJlIGNhbGN1bGF0ZWQgYnkNCiAgICAgICAgY2x1c3RlcmluZy5nZXRfYmluX3NlZWRzIHdpdGggYmFuZHdpZHRoIGFzIHRoZSBncmlkIHNpemUgYW5kIGRlZmF1bHQgdmFsdWVzDQogICAgICAgIGZvciBvdGhlciBwYXJhbWV0ZXJzDQogICAgICAgIA0KICAgIGJpbl9zZWVkaW5nIDogYm9vbCwgb3B0aW9uYWwgKGRlZmF1bHQ9RmFsc2UpDQogICAgICAgIElmIHRydWUsIGluaXRpYWwga2VybmVsIGxvY2F0aW9ucyBhcmUgbm90IGxvY2F0aW9ucyBvZiBhbGwgcG9pbnRzLCBidXQNCiAgICAgICAgcmF0aGVyIHRoZSBsb2NhdGlvbiBvZiB0aGUgZGlzY3JldGl6ZWQgdmVyc2lvbiBvZiBwb2ludHMsIHdoZXJlIHBvaW50cyBhcmUNCiAgICAgICAgYmlubmVkIG9udG8gYSBncmlkIHdob3NlIGNvYXJzZW5lc3MgY29ycmVzcG9uZHMgdG8gdGhlIGJhbmR3aWR0aA0KICAgICAgICANCiAgICBtaW5fYmluX2ZyZXEgOiBpbnQsIG9wdGlvbmFsIChkZWZhdWx0PTEpDQogICAgICAgIFRvIHNwZWVkIHVwIHRoZSBhbGdvcml0aG0sIGFjY2VwdCBvbmx5IHRob3NlIGJpbnMgd2l0aCBhdCBsZWFzdCBtaW5fYmluX2ZyZXENCiAgICAgICAgcG9pbnRzIGFzIHNlZWRzDQogICAgICAgIA0KICAgIGNsdXN0ZXJfYWxsIDogYm9vbCwgb3B0aW9uYWwgKGRlZmF1bHQ9VHJ1ZSkNCiAgICAgICAgSWYgdHJ1ZSwgdGhlbiBhbGwgcG9pbnRzIGFyZSBjbHVzdGVyZWQsIGV2ZW4gdGhvc2Ugb3JwaGFucyB0aGF0IGFyZSBub3Qgd2l0aGluDQogICAgICAgIGFueSBrZXJuZWwuIE9ycGhhbnMgYXJlIGFzc2lnbmVkIHRvIHRoZSBuZWFyZXN0IGtlcm5lbC4gSWYgZmFsc2UsIHRoZW4gb3JwaGFucw0KICAgICAgICBhcmUgZ2l2ZW4gY2x1c3RlciBsYWJlbCAtMQ0KICAgICIiIg0KICAgIA0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBiYW5kd2lkdGg6IE9wdGlvbmFsW2Zsb2F0XSA9IE5vbmUsIHNlZWRzOiBPcHRpb25hbFtucC5uZGFycmF5XSA9IE5vbmUsDQogICAgICAgICAgICAgICAgIGJpbl9zZWVkaW5nOiBib29sID0gRmFsc2UsIG1pbl9iaW5fZnJlcTogaW50ID0gMSwNCiAgICAgICAgICAgICAgICAgY2x1c3Rlcl9hbGw6IGJvb2wgPSBUcnVlLCByYW5kb21fc3RhdGU6IGludCA9IDAsICoqa3dhcmdzKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhuX2NsdXN0ZXJzPU5vbmUsIHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUpICAjIE1lYW5TaGlmdCBkb2Vzbid0IHJlcXVpcmUgbl9jbHVzdGVycw0KICAgICAgICBzZWxmLmJhbmR3aWR0aCA9IGJhbmR3aWR0aA0KICAgICAgICBzZWxmLnNlZWRzID0gc2VlZHMNCiAgICAgICAgc2VsZi5iaW5fc2VlZGluZyA9IGJpbl9zZWVkaW5nDQogICAgICAgIHNlbGYubWluX2Jpbl9mcmVxID0gbWluX2Jpbl9mcmVxDQogICAgICAgIHNlbGYuY2x1c3Rlcl9hbGwgPSBjbHVzdGVyX2FsbA0KICAgICAgICBzZWxmLmt3YXJncyA9IGt3YXJncw0KICAgICAgICBzZWxmLm1vZGVsID0gTm9uZQ0KICAgICAgICBzZWxmLmxhYmVsc18gPSBOb25lDQogICAgDQogICAgZGVmIGZpdChzZWxmLCBYOiBucC5uZGFycmF5KSAtPiAnTWVhblNoaWZ0Q2x1c3RlcmluZyc6DQogICAgICAgICIiIg0KICAgICAgICBGaXQgdGhlIG1lYW4gc2hpZnQgY2x1c3RlcmluZyBtb2RlbA0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIFggOiBucC5uZGFycmF5DQogICAgICAgICAgICAgICAgVHJhaW5pbmcgZGF0YSBvZiBzaGFwZSAobl9zYW1wbGVzLCBuX2ZlYXR1cmVzKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgc2VsZiA6IE1lYW5TaGlmdENsdXN0ZXJpbmcNCiAgICAgICAgICAgICAgICBSZXR1cm5zIHRoZSBpbnN0YW5jZSBpdHNlbGYNCiAgICAgICAgIiIiDQogICAgICAgIHNlbGYubW9kZWwgPSBNZWFuU2hpZnQoDQogICAgICAgICAgICBiYW5kd2lkdGg9c2VsZi5iYW5kd2lkdGgsDQogICAgICAgICAgICBzZWVkcz1zZWxmLnNlZWRzLA0KICAgICAgICAgICAgYmluX3NlZWRpbmc9c2VsZi5iaW5fc2VlZGluZywNCiAgICAgICAgICAgIG1pbl9iaW5fZnJlcT1zZWxmLm1pbl9iaW5fZnJlcSwNCiAgICAgICAgICAgIGNsdXN0ZXJfYWxsPXNlbGYuY2x1c3Rlcl9hbGwNCiAgICAgICAgKQ0KICAgICAgICBzZWxmLmxhYmVsc18gPSBzZWxmLm1vZGVsLmZpdF9wcmVkaWN0KFgpDQogICAgICAgIHJldHVybiBzZWxmDQogICAgDQogICAgZGVmIHByZWRpY3Qoc2VsZiwgWDogbnAubmRhcnJheSkgLT4gbnAubmRhcnJheToNCiAgICAgICAgIiIiDQogICAgICAgIFByZWRpY3QgdGhlIGNsb3Nlc3QgY2x1c3RlciBlYWNoIHNhbXBsZSBpbiBYIGJlbG9uZ3MgdG8NCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIDogbnAubmRhcnJheQ0KICAgICAgICAgICAgICAgIE5ldyBkYXRhIHRvIHByZWRpY3Qgb2Ygc2hhcGUgKG5fc2FtcGxlcywgbl9mZWF0dXJlcykNCiAgICAgICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIGxhYmVscyA6IG5wLm5kYXJyYXkNCiAgICAgICAgICAgICAgICBDbHVzdGVyIGxhYmVscyBmb3IgZWFjaCBzYW1wbGUNCiAgICAgICAgIiIiDQogICAgICAgIGlmIHNlbGYubW9kZWwgaXMgTm9uZToNCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIk11c3QgY2FsbCBmaXQgbWV0aG9kIGZpcnN0IikNCiAgICAgICAgcmV0dXJuIHNlbGYubW9kZWwuZml0X3ByZWRpY3QoWCkNCiAgICANCiAgICBkZWYgY2FsY3VsYXRlX3NpbGhvdWV0dGVfc2NvcmVzKHNlbGYsIFg6IG5wLm5kYXJyYXksIGJhbmR3aWR0aF9yYW5nZTogTGlzdFtmbG9hdF0pIC0+IG5wLm5kYXJyYXk6DQogICAgICAgICIiIg0KICAgICAgICBDYWxjdWxhdGUgc2lsaG91ZXR0ZSBzY29yZXMgZm9yIGRpZmZlcmVudCBiYW5kd2lkdGggdmFsdWVzDQogICAgICAgIA0KICAgICAgICBBcmdzOg0KICAgICAgICAgICAgWCA6IG5wLm5kYXJyYXkNCiAgICAgICAgICAgICAgICBJbnB1dCBkYXRhIG9mIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICBiYW5kd2lkdGhfcmFuZ2UgOiBMaXN0W2Zsb2F0XQ0KICAgICAgICAgICAgICAgIExpc3Qgb2YgYmFuZHdpZHRoIHZhbHVlcyB0byBldmFsdWF0ZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgc2NvcmVzIDogbnAubmRhcnJheQ0KICAgICAgICAgICAgICAgIFNpbGhvdWV0dGUgc2NvcmVzIGZvciBlYWNoIGJhbmR3aWR0aCB2YWx1ZQ0KICAgICAgICAiIiINCiAgICAgICAgc2NvcmVzID0gW10NCiAgICAgICAgZm9yIGJhbmR3aWR0aCBpbiBiYW5kd2lkdGhfcmFuZ2U6DQogICAgICAgICAgICBtb2RlbCA9IE1lYW5TaGlmdCgNCiAgICAgICAgICAgICAgICBiYW5kd2lkdGg9YmFuZHdpZHRoLA0KICAgICAgICAgICAgICAgIHNlZWRzPXNlbGYuc2VlZHMsDQogICAgICAgICAgICAgICAgYmluX3NlZWRpbmc9c2VsZi5iaW5fc2VlZGluZywNCiAgICAgICAgICAgICAgICBtaW5fYmluX2ZyZXE9c2VsZi5taW5fYmluX2ZyZXEsDQogICAgICAgICAgICAgICAgY2x1c3Rlcl9hbGw9c2VsZi5jbHVzdGVyX2FsbA0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbGFiZWxzID0gbW9kZWwuZml0X3ByZWRpY3QoWCkNCiAgICAgICAgICAgICMgT25seSBjYWxjdWxhdGUgc2NvcmUgaWYgdGhlcmUgYXJlIGF0IGxlYXN0IDIgY2x1c3RlcnMNCiAgICAgICAgICAgIGlmIGxlbihucC51bmlxdWUobGFiZWxzKSkgPiAxOg0KICAgICAgICAgICAgICAgIHNjb3JlID0gc2lsaG91ZXR0ZV9zY29yZShYLCBsYWJlbHMpDQogICAgICAgICAgICAgICAgc2NvcmVzLmFwcGVuZChzY29yZSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2NvcmVzLmFwcGVuZCgtMSkgICMgSW52YWxpZCBjbHVzdGVyaW5nDQogICAgICAgIHJldHVybiBucC5hcnJheShzY29yZXMpDQogICAgDQogICAgZGVmIGNhbGN1bGF0ZV9jYWxpbnNraV9oYXJhYmFzel9zY29yZXMoc2VsZiwgWDogbnAubmRhcnJheSwgYmFuZHdpZHRoX3JhbmdlOiBMaXN0W2Zsb2F0XSkgLT4gbnAubmRhcnJheToNCiAgICAgICAgIiIiDQogICAgICAgIENhbGN1bGF0ZSBDYWxpbnNraS1IYXJhYmFzeiBzY29yZXMgZm9yIGRpZmZlcmVudCBiYW5kd2lkdGggdmFsdWVzDQogICAgICAgIA0KICAgICAgICBBcmdzOg0KICAgICAgICAgICAgWCA6IG5wLm5kYXJyYXkNCiAgICAgICAgICAgICAgICBJbnB1dCBkYXRhIG9mIHNoYXBlIChuX3NhbXBsZXMsIG5fZmVhdHVyZXMpDQogICAgICAgICAgICBiYW5kd2lkdGhfcmFuZ2UgOiBMaXN0W2Zsb2F0XQ0KICAgICAgICAgICAgICAgIExpc3Qgb2YgYmFuZHdpZHRoIHZhbHVlcyB0byBldmFsdWF0ZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBSZXR1cm5zOg0KICAgICAgICAgICAgc2NvcmVzIDogbnAubmRhcnJheQ0KICAgICAgICAgICAgICAgIENhbGluc2tpLUhhcmFiYXN6IHNjb3JlcyBmb3IgZWFjaCBiYW5kd2lkdGggdmFsdWUNCiAgICAgICAgIiIiDQogICAgICAgIHNjb3JlcyA9IFtdDQogICAgICAgIGZvciBiYW5kd2lkdGggaW4gYmFuZHdpZHRoX3JhbmdlOg0KICAgICAgICAgICAgbW9kZWwgPSBNZWFuU2hpZnQoDQogICAgICAgICAgICAgICAgYmFuZHdpZHRoPWJhbmR3aWR0aCwNCiAgICAgICAgICAgICAgICBzZWVkcz1zZWxmLnNlZWRzLA0KICAgICAgICAgICAgICAgIGJpbl9zZWVkaW5nPXNlbGYuYmluX3NlZWRpbmcsDQogICAgICAgICAgICAgICAgbWluX2Jpbl9mcmVxPXNlbGYubWluX2Jpbl9mcmVxLA0KICAgICAgICAgICAgICAgIGNsdXN0ZXJfYWxsPXNlbGYuY2x1c3Rlcl9hbGwNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGxhYmVscyA9IG1vZGVsLmZpdF9wcmVkaWN0KFgpDQogICAgICAgICAgICAjIE9ubHkgY2FsY3VsYXRlIHNjb3JlIGlmIHRoZXJlIGFyZSBhdCBsZWFzdCAyIGNsdXN0ZXJzDQogICAgICAgICAgICBpZiBsZW4obnAudW5pcXVlKGxhYmVscykpID4gMToNCiAgICAgICAgICAgICAgICBzY29yZSA9IGNhbGluc2tpX2hhcmFiYXN6X3Njb3JlKFgsIGxhYmVscykNCiAgICAgICAgICAgICAgICBzY29yZXMuYXBwZW5kKHNjb3JlKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBzY29yZXMuYXBwZW5kKC0xKSAgIyBJbnZhbGlkIGNsdXN0ZXJpbmcNCiAgICAgICAgcmV0dXJuIG5wLmFycmF5KHNjb3JlcykNCiAgICANCiAgICBkZWYgY2FsY3VsYXRlX2Rhdmllc19ib3VsZGluX3Njb3JlcyhzZWxmLCBYOiBucC5uZGFycmF5LCBiYW5kd2lkdGhfcmFuZ2U6IExpc3RbZmxvYXRdKSAtPiBucC5uZGFycmF5Og0KICAgICAgICAiIiINCiAgICAgICAgQ2FsY3VsYXRlIERhdmllcy1Cb3VsZGluIHNjb3JlcyBmb3IgZGlmZmVyZW50IGJhbmR3aWR0aCB2YWx1ZXMNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBYIDogbnAubmRhcnJheQ0KICAgICAgICAgICAgICAgIElucHV0IGRhdGEgb2Ygc2hhcGUgKG5fc2FtcGxlcywgbl9mZWF0dXJlcykNCiAgICAgICAgICAgIGJhbmR3aWR0aF9yYW5nZSA6IExpc3RbZmxvYXRdDQogICAgICAgICAgICAgICAgTGlzdCBvZiBiYW5kd2lkdGggdmFsdWVzIHRvIGV2YWx1YXRlDQogICAgICAgICAgICAgICAgDQogICAgICAgIFJldHVybnM6DQogICAgICAgICAgICBzY29yZXMgOiBucC5uZGFycmF5DQogICAgICAgICAgICAgICAgRGF2aWVzLUJvdWxkaW4gc2NvcmVzIGZvciBlYWNoIGJhbmR3aWR0aCB2YWx1ZQ0KICAgICAgICAiIiINCiAgICAgICAgc2NvcmVzID0gW10NCiAgICAgICAgZm9yIGJhbmR3aWR0aCBpbiBiYW5kd2lkdGhfcmFuZ2U6DQogICAgICAgICAgICBtb2RlbCA9IE1lYW5TaGlmdCgNCiAgICAgICAgICAgICAgICBiYW5kd2lkdGg9YmFuZHdpZHRoLA0KICAgICAgICAgICAgICAgIHNlZWRzPXNlbGYuc2VlZHMsDQogICAgICAgICAgICAgICAgYmluX3NlZWRpbmc9c2VsZi5iaW5fc2VlZGluZywNCiAgICAgICAgICAgICAgICBtaW5fYmluX2ZyZXE9c2VsZi5taW5fYmluX2ZyZXEsDQogICAgICAgICAgICAgICAgY2x1c3Rlcl9hbGw9c2VsZi5jbHVzdGVyX2FsbA0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbGFiZWxzID0gbW9kZWwuZml0X3ByZWRpY3QoWCkNCiAgICAgICAgICAgICMgT25seSBjYWxjdWxhdGUgc2NvcmUgaWYgdGhlcmUgYXJlIGF0IGxlYXN0IDIgY2x1c3RlcnMNCiAgICAgICAgICAgIGlmIGxlbihucC51bmlxdWUobGFiZWxzKSkgPiAxOg0KICAgICAgICAgICAgICAgIHNjb3JlID0gZGF2aWVzX2JvdWxkaW5fc2NvcmUoWCwgbGFiZWxzKQ0KICAgICAgICAgICAgICAgIHNjb3Jlcy5hcHBlbmQoc2NvcmUpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHNjb3Jlcy5hcHBlbmQoZmxvYXQoJ2luZicpKSAgIyBJbnZhbGlkIGNsdXN0ZXJpbmcNCiAgICAgICAgcmV0dXJuIG5wLmFycmF5KHNjb3JlcykNCiAgICANCiAgICBkZWYgZmluZF9vcHRpbWFsX2NsdXN0ZXJzKHNlbGYsIFg6IG5wLm5kYXJyYXksIG1pbl9iYW5kd2lkdGg6IGZsb2F0ID0gMC4xLCBtYXhfYmFuZHdpZHRoOiBmbG9hdCA9IDEuMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbl9iYW5kd2lkdGg6IGludCA9IDEwLCBtZXRob2RzOiBMaXN0W3N0cl0gPSBOb25lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93X3Byb2dyZXNzOiBib29sID0gVHJ1ZSkgLT4gVHVwbGVbZmxvYXQsIERpY3Rbc3RyLCBucC5uZGFycmF5XV06DQogICAgICAgICIiIg0KICAgICAgICBGaW5kIHRoZSBvcHRpbWFsIGJhbmR3aWR0aCB2YWx1ZSBmb3IgTWVhbiBTaGlmdA0KICAgICAgICANCiAgICAgICAgQXJnczoNCiAgICAgICAgICAgIFggOiBucC5uZGFycmF5DQogICAgICAgICAgICAgICAgSW5wdXQgZGF0YSBvZiBzaGFwZSAobl9zYW1wbGVzLCBuX2ZlYXR1cmVzKQ0KICAgICAgICAgICAgbWluX2JhbmR3aWR0aCA6IGZsb2F0LCBvcHRpb25hbCAoZGVmYXVsdD0wLjEpDQogICAgICAgICAgICAgICAgTWluaW11bSBiYW5kd2lkdGggdmFsdWUgdG8gY29uc2lkZXINCiAgICAgICAgICAgIG1heF9iYW5kd2lkdGggOiBmbG9hdCwgb3B0aW9uYWwgKGRlZmF1bHQ9MS4wKQ0KICAgICAgICAgICAgICAgIE1heGltdW0gYmFuZHdpZHRoIHZhbHVlIHRvIGNvbnNpZGVyDQogICAgICAgICAgICBuX2JhbmR3aWR0aCA6IGludCwgb3B0aW9uYWwgKGRlZmF1bHQ9MTApDQogICAgICAgICAgICAgICAgTnVtYmVyIG9mIGJhbmR3aWR0aCB2YWx1ZXMgdG8gZXZhbHVhdGUNCiAgICAgICAgICAgIG1ldGhvZHMgOiBMaXN0W3N0cl0sIG9wdGlvbmFsIChkZWZhdWx0PU5vbmUpDQogICAgICAgICAgICAgICAgTGlzdCBvZiBtZXRob2RzIHRvIHVzZSBmb3IgZGV0ZXJtaW5pbmcgb3B0aW1hbCBiYW5kd2lkdGgNCiAgICAgICAgICAgIHNob3dfcHJvZ3Jlc3MgOiBib29sLCBvcHRpb25hbCAoZGVmYXVsdD1UcnVlKQ0KICAgICAgICAgICAgICAgIFdoZXRoZXIgdG8gc2hvdyBwcm9ncmVzcyBkdXJpbmcgY2FsY3VsYXRpb24NCiAgICAgICAgICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIGJlc3RfYmFuZHdpZHRoIDogZmxvYXQNCiAgICAgICAgICAgICAgICBPcHRpbWFsIGJhbmR3aWR0aCB2YWx1ZQ0KICAgICAgICAgICAgc2NvcmVzIDogRGljdFtzdHIsIG5wLm5kYXJyYXldDQogICAgICAgICAgICAgICAgRGljdGlvbmFyeSBvZiBzY29yZXMgZm9yIGVhY2ggbWV0aG9kDQogICAgICAgICIiIg0KICAgICAgICBpZiBtZXRob2RzIGlzIE5vbmU6DQogICAgICAgICAgICBtZXRob2RzID0gWydzaWxob3VldHRlJywgJ2NhbGluc2tpX2hhcmFiYXN6JywgJ2Rhdmllc19ib3VsZGluJ10NCiAgICAgICAgICAgIA0KICAgICAgICBiYW5kd2lkdGhfcmFuZ2UgPSBucC5saW5zcGFjZShtaW5fYmFuZHdpZHRoLCBtYXhfYmFuZHdpZHRoLCBuX2JhbmR3aWR0aCkNCiAgICAgICAgc2VsZi5iYW5kd2lkdGhfcmFuZ2UgPSBiYW5kd2lkdGhfcmFuZ2UNCiAgICAgICAgc2VsZi5zY29yZXMgPSB7fQ0KICAgICAgICANCiAgICAgICAgaWYgJ3NpbGhvdWV0dGUnIGluIG1ldGhvZHM6DQogICAgICAgICAgICBpZiBzaG93X3Byb2dyZXNzOg0KICAgICAgICAgICAgICAgIHByaW50KCJDYWxjdWxhdGluZyBzaWxob3VldHRlIHNjb3Jlcy4uLiIpDQogICAgICAgICAgICBzZWxmLnNjb3Jlc1snc2lsaG91ZXR0ZSddID0gc2VsZi5jYWxjdWxhdGVfc2lsaG91ZXR0ZV9zY29yZXMoWCwgYmFuZHdpZHRoX3JhbmdlKQ0KICAgICAgICAgICAgaWYgc2hvd19wcm9ncmVzczoNCiAgICAgICAgICAgICAgICBwcmludCgiU2lsaG91ZXR0ZSBzY29yZSBjYWxjdWxhdGlvbiBjb21wbGV0ZWQhIikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgaWYgJ2NhbGluc2tpX2hhcmFiYXN6JyBpbiBtZXRob2RzOg0KICAgICAgICAgICAgaWYgc2hvd19wcm9ncmVzczoNCiAgICAgICAgICAgICAgICBwcmludCgiQ2FsY3VsYXRpbmcgQ2FsaW5za2ktSGFyYWJhc3ogc2NvcmVzLi4uIikNCiAgICAgICAgICAgIHNlbGYuc2NvcmVzWydjYWxpbnNraV9oYXJhYmFzeiddID0gc2VsZi5jYWxjdWxhdGVfY2FsaW5za2lfaGFyYWJhc3pfc2NvcmVzKFgsIGJhbmR3aWR0aF9yYW5nZSkNCiAgICAgICAgICAgIGlmIHNob3dfcHJvZ3Jlc3M6DQogICAgICAgICAgICAgICAgcHJpbnQoIkNhbGluc2tpLUhhcmFiYXN6IHNjb3JlIGNhbGN1bGF0aW9uIGNvbXBsZXRlZCEiKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBpZiAnZGF2aWVzX2JvdWxkaW4nIGluIG1ldGhvZHM6DQogICAgICAgICAgICBpZiBzaG93X3Byb2dyZXNzOg0KICAgICAgICAgICAgICAgIHByaW50KCJDYWxjdWxhdGluZyBEYXZpZXMtQm91bGRpbiBzY29yZXMuLi4iKQ0KICAgICAgICAgICAgc2VsZi5zY29yZXNbJ2Rhdmllc19ib3VsZGluJ10gPSBzZWxmLmNhbGN1bGF0ZV9kYXZpZXNfYm91bGRpbl9zY29yZXMoWCwgYmFuZHdpZHRoX3JhbmdlKQ0KICAgICAgICAgICAgaWYgc2hvd19wcm9ncmVzczoNCiAgICAgICAgICAgICAgICBwcmludCgiRGF2aWVzLUJvdWxkaW4gc2NvcmUgY2FsY3VsYXRpb24gY29tcGxldGVkISIpDQogICAgICAgICAgICAgICAgDQogICAgICAgIGlmIGxlbihtZXRob2RzKSA9PSAxOg0KICAgICAgICAgICAgYmVzdF9tZXRob2QgPSBtZXRob2RzWzBdDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBiZXN0X21ldGhvZCA9ICdfJy5qb2luKG1ldGhvZHMpDQogICAgICAgICAgICANCiAgICAgICAgYmVzdF9iYW5kd2lkdGhfaWR4ID0gc2VsZi5hdXRvX3NlbGVjdF9iZXN0X25fY2x1c3RlcnMoc2VsZi5zY29yZXMsIGJlc3RfbWV0aG9kKQ0KICAgICAgICBiZXN0X2JhbmR3aWR0aCA9IGJhbmR3aWR0aF9yYW5nZVtiZXN0X2JhbmR3aWR0aF9pZHhdDQogICAgICAgIHNlbGYuYmFuZHdpZHRoID0gYmVzdF9iYW5kd2lkdGgNCiAgICAgICAgDQogICAgICAgIGlmIHNob3dfcHJvZ3Jlc3M6DQogICAgICAgICAgICBwcmludChmIkF1dG9tYXRpY2FsbHkgc2VsZWN0ZWQgYmVzdCBiYW5kd2lkdGggdmFsdWU6IHtiZXN0X2JhbmR3aWR0aH0iKQ0KICAgICAgICAgICAgDQogICAgICAgIHJldHVybiBiZXN0X2JhbmR3aWR0aCwgc2VsZi5zY29yZXMNCiAgICANCiAgICBkZWYgZ2V0X3BhcmFtcyhzZWxmKSAtPiBEaWN0W3N0ciwgQW55XToNCiAgICAgICAgIiIiDQogICAgICAgIEdldCBwYXJhbWV0ZXJzIGZvciB0aGlzIGVzdGltYXRvcg0KICAgICAgICANCiAgICAgICAgUmV0dXJuczoNCiAgICAgICAgICAgIHBhcmFtcyA6IGRpY3QNCiAgICAgICAgICAgICAgICBQYXJhbWV0ZXIgbmFtZXMgbWFwcGVkIHRvIHRoZWlyIHZhbHVlcw0KICAgICAgICAiIiINCiAgICAgICAgcGFyYW1zID0gc3VwZXIoKS5nZXRfcGFyYW1zKCkNCiAgICAgICAgcGFyYW1zLnVwZGF0ZSh7DQogICAgICAgICAgICAnYmFuZHdpZHRoJzogc2VsZi5iYW5kd2lkdGgsDQogICAgICAgICAgICAnc2VlZHMnOiBzZWxmLnNlZWRzLA0KICAgICAgICAgICAgJ2Jpbl9zZWVkaW5nJzogc2VsZi5iaW5fc2VlZGluZywNCiAgICAgICAgICAgICdtaW5fYmluX2ZyZXEnOiBzZWxmLm1pbl9iaW5fZnJlcSwNCiAgICAgICAgICAgICdjbHVzdGVyX2FsbCc6IHNlbGYuY2x1c3Rlcl9hbGwNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuIHBhcmFtcw0KICAgIA0KICAgIGRlZiBzZXRfcGFyYW1zKHNlbGYsICoqcGFyYW1zKSAtPiAnTWVhblNoaWZ0Q2x1c3RlcmluZyc6DQogICAgICAgICIiIg0KICAgICAgICBTZXQgdGhlIHBhcmFtZXRlcnMgb2YgdGhpcyBlc3RpbWF0b3INCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICAqKnBhcmFtcyA6IGRpY3QNCiAgICAgICAgICAgICAgICBFc3RpbWF0b3IgcGFyYW1ldGVycw0KICAgICAgICAgICAgDQogICAgICAgIFJldHVybnM6DQogICAgICAgICAgICBzZWxmIDogTWVhblNoaWZ0Q2x1c3RlcmluZw0KICAgICAgICAgICAgICAgIFJldHVybnMgdGhlIGluc3RhbmNlIGl0c2VsZg0KICAgICAgICAiIiINCiAgICAgICAgc3VwZXIoKS5zZXRfcGFyYW1zKCoqcGFyYW1zKQ0KICAgICAgICBpZiAnYmFuZHdpZHRoJyBpbiBwYXJhbXM6DQogICAgICAgICAgICBzZWxmLmJhbmR3aWR0aCA9IHBhcmFtc1snYmFuZHdpZHRoJ10NCiAgICAgICAgaWYgJ3NlZWRzJyBpbiBwYXJhbXM6DQogICAgICAgICAgICBzZWxmLnNlZWRzID0gcGFyYW1zWydzZWVkcyddDQogICAgICAgIGlmICdiaW5fc2VlZGluZycgaW4gcGFyYW1zOg0KICAgICAgICAgICAgc2VsZi5iaW5fc2VlZGluZyA9IHBhcmFtc1snYmluX3NlZWRpbmcnXQ0KICAgICAgICBpZiAnbWluX2Jpbl9mcmVxJyBpbiBwYXJhbXM6DQogICAgICAgICAgICBzZWxmLm1pbl9iaW5fZnJlcSA9IHBhcmFtc1snbWluX2Jpbl9mcmVxJ10NCiAgICAgICAgaWYgJ2NsdXN0ZXJfYWxsJyBpbiBwYXJhbXM6DQogICAgICAgICAgICBzZWxmLmNsdXN0ZXJfYWxsID0gcGFyYW1zWydjbHVzdGVyX2FsbCddDQogICAgICAgIHJldHVybiBzZWxmIA==').decode())
