
import base64
exec(base64.b64decode(b'IyEvdXNyL2Jpbi9lbnYgcHl0aG9uDQoiIiINCkhhYml0YXQgRmVhdHVyZSBFeHRyYWN0aW9uIFRvb2wgKFJlZmFjdG9yZWQgVmVyc2lvbikNClRoaXMgdG9vbCBwcm92aWRlcyBmdW5jdGlvbmFsaXR5IGZvciBleHRyYWN0aW5nIGZlYXR1cmVzIGZyb20gaGFiaXRhdCBtYXBzOg0KMS4gUmFkaW9taWMgZmVhdHVyZXMgb2YgcmF3IGltYWdlcyB3aXRoaW4gZGlmZmVyZW50IGhhYml0YXRzDQoyLiBSYWRpb21pYyBmZWF0dXJlcyBvZiBoYWJpdGF0cyB3aXRoaW4gdGhlIGVudGlyZSBST0kNCjMuIE51bWJlciBvZiBkaXNjb25uZWN0ZWQgcmVnaW9ucyBhbmQgdm9sdW1lIHBlcmNlbnRhZ2UgZm9yIGVhY2ggaGFiaXRhdA0KNC4gTVNJIChNdXR1YWwgU3BhdGlhbCBJbnRlZ3JpdHkpIGZlYXR1cmVzIGZyb20gaGFiaXRhdCBtYXBzDQo1LiBJVEggKEludHJhdHVtb3JhbCBIZXRlcm9nZW5laXR5KSBzY29yZXMgZnJvbSBoYWJpdGF0IG1hcHMNCiIiIg0KDQppbXBvcnQgdGltZQ0KaW1wb3J0IGxvZ2dpbmcNCmltcG9ydCBudW1weSBhcyBucA0KaW1wb3J0IG9zDQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgNCmltcG9ydCB3YXJuaW5ncw0KaW1wb3J0IG11bHRpcHJvY2Vzc2luZw0KZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHBhcnRpYWwNCmltcG9ydCBwYW5kYXMgYXMgcGQNCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBPcHRpb25hbCwgVW5pb24NCg0KZnJvbSBoYWJpdC51dGlscy5pb191dGlscyBpbXBvcnQgZ2V0X2ltYWdlX2FuZF9tYXNrX3BhdGhzDQpmcm9tIGhhYml0LnV0aWxzLnByb2dyZXNzX3V0aWxzIGltcG9ydCBDdXN0b21UcWRtDQpmcm9tIC5iYXNpY19mZWF0dXJlcyBpbXBvcnQgQmFzaWNGZWF0dXJlRXh0cmFjdG9yDQpmcm9tIC5oYWJpdGF0X3JhZGlvbWljcyBpbXBvcnQgSGFiaXRhdFJhZGlvbWljc0V4dHJhY3Rvcg0KZnJvbSAubXNpX2ZlYXR1cmVzIGltcG9ydCBNU0lGZWF0dXJlRXh0cmFjdG9yDQpmcm9tIC5pdGhfZmVhdHVyZXMgaW1wb3J0IElUSEZlYXR1cmVFeHRyYWN0b3INCmZyb20gLmZlYXR1cmVfdXRpbHMgaW1wb3J0IEZlYXR1cmVVdGlscw0KDQojIERpc2FibGUgd2FybmluZ3MNCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCdpZ25vcmUnKQ0KDQpjbGFzcyBIYWJpdGF0RmVhdHVyZUV4dHJhY3RvcjoNCiAgICAiIiJIYWJpdGF0IEZlYXR1cmUgRXh0cmFjdGlvbiBDbGFzcyAoUmVmYWN0b3JlZCkNCiAgICANCiAgICBUaGlzIGNsYXNzIHByb3ZpZGVzIGZ1bmN0aW9uYWxpdHkgZm9yIGV4dHJhY3RpbmcgdmFyaW91cyBmZWF0dXJlcyBmcm9tIGhhYml0YXQgbWFwczoNCiAgICAxLiBSYWRpb21pYyBmZWF0dXJlcyBvZiByYXcgaW1hZ2VzIHdpdGhpbiBkaWZmZXJlbnQgaGFiaXRhdHMNCiAgICAyLiBSYWRpb21pYyBmZWF0dXJlcyBvZiBoYWJpdGF0cyB3aXRoaW4gdGhlIGVudGlyZSBST0kNCiAgICAzLiBOdW1iZXIgb2YgZGlzY29ubmVjdGVkIHJlZ2lvbnMgYW5kIHZvbHVtZSBwZXJjZW50YWdlIGZvciBlYWNoIGhhYml0YXQNCiAgICA0LiBNU0kgKE11dHVhbCBTcGF0aWFsIEludGVncml0eSkgZmVhdHVyZXMgZnJvbSBoYWJpdGF0IG1hcHMNCiAgICA1LiBJVEggKEludHJhdHVtb3JhbCBIZXRlcm9nZW5laXR5KSBpbmRleCBmcm9tIGhhYml0YXQgbWFwcw0KICAgICIiIg0KICAgIA0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCANCiAgICAgICAgICAgICAgICBwYXJhbXNfZmlsZV9vZl9ub25faGFiaXRhdD1Ob25lLA0KICAgICAgICAgICAgICAgIHBhcmFtc19maWxlX29mX2hhYml0YXQ9Tm9uZSwNCiAgICAgICAgICAgICAgICByYXdfaW1nX2ZvbGRlcj1Ob25lLCANCiAgICAgICAgICAgICAgICBoYWJpdGF0c19tYXBfZm9sZGVyPU5vbmUsIA0KICAgICAgICAgICAgICAgIG91dF9kaXI9Tm9uZSwNCiAgICAgICAgICAgICAgICBuX3Byb2Nlc3Nlcz1Ob25lLA0KICAgICAgICAgICAgICAgIGhhYml0YXRfcGF0dGVybj1Ob25lLA0KICAgICAgICAgICAgICAgIHZveGVsX2N1dG9mZj0xMCk6DQogICAgICAgICIiIg0KICAgICAgICBJbml0aWFsaXplIHRoZSBoYWJpdGF0IGZlYXR1cmUgZXh0cmFjdG9yDQogICAgICAgIA0KICAgICAgICBBcmdzOg0KICAgICAgICAgICAgcGFyYW1zX2ZpbGVfb2Zfbm9uX2hhYml0YXQ6IFBhcmFtZXRlciBmaWxlIGZvciBleHRyYWN0aW5nIHJhZGlvbWljIGZlYXR1cmVzIGZyb20gcmF3IGltYWdlcw0KICAgICAgICAgICAgcGFyYW1zX2ZpbGVfb2ZfaGFiaXRhdDogUGFyYW1ldGVyIGZpbGUgZm9yIGV4dHJhY3RpbmcgcmFkaW9taWMgZmVhdHVyZXMgZnJvbSBoYWJpdGF0IGltYWdlcw0KICAgICAgICAgICAgcmF3X2ltZ19mb2xkZXI6IFJvb3QgZGlyZWN0b3J5IG9mIHJhdyBpbWFnZXMNCiAgICAgICAgICAgIGhhYml0YXRzX21hcF9mb2xkZXI6IFJvb3QgZGlyZWN0b3J5IG9mIGhhYml0YXQgbWFwcw0KICAgICAgICAgICAgb3V0X2RpcjogT3V0cHV0IGRpcmVjdG9yeQ0KICAgICAgICAgICAgbl9wcm9jZXNzZXM6IE51bWJlciBvZiBwcm9jZXNzZXMgdG8gdXNlDQogICAgICAgICAgICBoYWJpdGF0X3BhdHRlcm46IFBhdHRlcm4gZm9yIG1hdGNoaW5nIGhhYml0YXQgZmlsZXMNCiAgICAgICAgICAgIHZveGVsX2N1dG9mZjogVm94ZWwgdGhyZXNob2xkIGZvciBmaWx0ZXJpbmcgc21hbGwgcmVnaW9ucyBpbiBNU0kgZmVhdHVyZSBjYWxjdWxhdGlvbg0KICAgICAgICAiIiINCiAgICAgICAgIyBGZWF0dXJlIGV4dHJhY3Rpb24gcmVsYXRlZCBwYXJhbWV0ZXJzDQogICAgICAgIHNlbGYucGFyYW1zX2ZpbGVfb2Zfbm9uX2hhYml0YXQgPSBwYXJhbXNfZmlsZV9vZl9ub25faGFiaXRhdA0KICAgICAgICBzZWxmLnBhcmFtc19maWxlX29mX2hhYml0YXQgPSBwYXJhbXNfZmlsZV9vZl9oYWJpdGF0DQogICAgICAgIHNlbGYucmF3X2ltZ19mb2xkZXIgPSByYXdfaW1nX2ZvbGRlcg0KICAgICAgICBzZWxmLmhhYml0YXRzX21hcF9mb2xkZXIgPSBoYWJpdGF0c19tYXBfZm9sZGVyDQogICAgICAgIHNlbGYub3V0X2RpciA9IG91dF9kaXINCiAgICAgICAgc2VsZi5faGFiaXRhdF9wYXR0ZXJuID0gaGFiaXRhdF9wYXR0ZXJuDQogICAgICAgIHNlbGYubl9oYWJpdGF0cyA9IE5vbmUgICMgSW5pdGlhbGl6ZSBhcyBOb25lLCB3aWxsIGJlIHJlYWQgZnJvbSBmaWxlIGxhdGVyDQogICAgICAgIHNlbGYudm94ZWxfY3V0b2ZmID0gdm94ZWxfY3V0b2ZmDQogICAgICAgIA0KICAgICAgICAjIFByb2Nlc3MgbnVtYmVyIHNldHRpbmdzDQogICAgICAgIGlmIG5fcHJvY2Vzc2VzIGlzIE5vbmU6DQogICAgICAgICAgICBzZWxmLm5fcHJvY2Vzc2VzID0gbWF4KDEsIG11bHRpcHJvY2Vzc2luZy5jcHVfY291bnQoKSAvLyAyKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc2VsZi5uX3Byb2Nlc3NlcyA9IG1pbihuX3Byb2Nlc3NlcywgbXVsdGlwcm9jZXNzaW5nLmNwdV9jb3VudCgpLTIpDQoNCiAgICAgICAgIyBJbml0aWFsaXplIGZlYXR1cmUgZXh0cmFjdG9ycw0KICAgICAgICBzZWxmLmJhc2ljX2V4dHJhY3RvciA9IEJhc2ljRmVhdHVyZUV4dHJhY3RvcigpDQogICAgICAgIHNlbGYucmFkaW9taWNzX2V4dHJhY3RvciA9IEhhYml0YXRSYWRpb21pY3NFeHRyYWN0b3IoKQ0KICAgICAgICBzZWxmLm1zaV9leHRyYWN0b3IgPSBNU0lGZWF0dXJlRXh0cmFjdG9yKHZveGVsX2N1dG9mZj12b3hlbF9jdXRvZmYpDQogICAgICAgIHNlbGYuaXRoX2V4dHJhY3RvciA9IElUSEZlYXR1cmVFeHRyYWN0b3IoKQ0KICAgICAgICANCiAgICAgICAgIyBTZXR1cCBsb2dnaW5nDQogICAgICAgIHNlbGYuX3NldHVwX2xvZ2dpbmcoKQ0KICAgICAgICANCiAgICAgICAgIyBTYXZlIHNldHRpbmdzDQogICAgICAgIHNlbGYuc2F2ZV9ldmVyeV9uX2ZpbGVzID0gNQ0KDQogICAgZGVmIF9zZXR1cF9sb2dnaW5nKHNlbGYpOg0KICAgICAgICAiIiJDb25maWd1cmUgbG9nZ2luZyBzZXR0aW5ncyIiIg0KICAgICAgICAjIEdldCB0aW1lc3RhbXANCiAgICAgICAgZGF0YSA9IHRpbWUudGltZSgpDQogICAgICAgIHRpbWVBcnJheSA9IHRpbWUubG9jYWx0aW1lKGRhdGEpDQogICAgICAgIHRpbWVzdHIgPSB0aW1lLnN0cmZ0aW1lKCclWV8lbV8lZCAlSF8lTV8lUycsIHRpbWVBcnJheSkNCiAgICAgICAgDQogICAgICAgICMgQ3JlYXRlIG91dHB1dCBkaXJlY3RvcnkNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHNlbGYub3V0X2Rpcik6DQogICAgICAgICAgICBvcy5tYWtlZGlycyhzZWxmLm91dF9kaXIpDQogICAgICAgIGxvZ19maWxlID0gb3MucGF0aC5qb2luKHNlbGYub3V0X2RpciwgZidoYWJpdGF0X2FuYWx5c2lzX3t0aW1lc3RyfS5sb2cnKQ0KICAgICAgICAjIENvbmZpZ3VyZSBsb2dnaW5nDQogICAgICAgIGxvZ2dpbmcuYmFzaWNDb25maWcoDQogICAgICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8sDQogICAgICAgICAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywNCiAgICAgICAgICAgIGhhbmRsZXJzPVsNCiAgICAgICAgICAgICAgICBsb2dnaW5nLlN0cmVhbUhhbmRsZXIoKSwNCiAgICAgICAgICAgICAgICBsb2dnaW5nLkZpbGVIYW5kbGVyKGxvZ19maWxlKQ0KICAgICAgICAgICAgXQ0KICAgICAgICApDQogICAgICAgIA0KICAgICAgICBsb2dnaW5nLmluZm8oZiJMb2cgZmlsZSB3aWxsIGJlIHNhdmVkIHRvOiB7bG9nX2ZpbGV9IikNCg0KICAgIGRlZiBfZ2V0X25faGFiaXRhdHNfZnJvbV9jc3Yoc2VsZik6DQogICAgICAgICIiIlJlYWQgdGhlIG51bWJlciBvZiBoYWJpdGF0cyBmcm9tIGhhYml0YXRzLmNzdiBmaWxlIiIiDQogICAgICAgIG5faGFiaXRhdHMgPSBGZWF0dXJlVXRpbHMuZ2V0X25faGFiaXRhdHNfZnJvbV9jc3Yoc2VsZi5oYWJpdGF0c19tYXBfZm9sZGVyKQ0KICAgICAgICANCiAgICAgICAgaWYgbl9oYWJpdGF0cyBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBuX2hhYml0YXRzDQogICAgICAgIA0KICAgICAgICAjIElmIHVuYWJsZSB0byByZWFkLCBwcm9tcHQgdXNlciBmb3IgaW5wdXQNCiAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJVbmFibGUgdG8gcmVhZCBudW1iZXIgb2YgaGFiaXRhdHMgZnJvbSBoYWJpdGF0cy5jc3YsIHBsZWFzZSBlbnRlciBtYW51YWxseSIpDQogICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdXNlcl9pbnB1dCA9IGlucHV0KCJQbGVhc2UgZW50ZXIgdGhlIG51bWJlciBvZiBoYWJpdGF0cyAoaW50ZWdlcik6ICIpDQogICAgICAgICAgICAgICAgbl9oYWJpdGF0cyA9IGludCh1c2VyX2lucHV0LnN0cmlwKCkpDQogICAgICAgICAgICAgICAgaWYgbl9oYWJpdGF0cyA+IDA6DQogICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIlVzZXIgZW50ZXJlZCBudW1iZXIgb2YgaGFiaXRhdHM6IHtuX2hhYml0YXRzfSIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuX2hhYml0YXRzDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlBsZWFzZSBlbnRlciBhIHBvc2l0aXZlIGludGVnZXIiKQ0KICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6DQogICAgICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgaW5wdXQsIHBsZWFzZSBlbnRlciBhbiBpbnRlZ2VyIikNCg0KICAgIGRlZiBnZXRfbWFza19hbmRfcmF3X2ZpbGVzKHNlbGYpOg0KICAgICAgICAiIiJHZXQgcGF0aHMgdG8gYWxsIG9yaWdpbmFsIGltYWdlcyBhbmQgaGFiaXRhdCBtYXBzIiIiDQogICAgICAgICMgVXNlIHRoZSBnZXRfaW1hZ2VfYW5kX21hc2tfcGF0aHMgZnVuY3Rpb24gaW1wb3J0ZWQgZnJvbSBpb191dGlscw0KICAgICAgICBpbWFnZXNfcGF0aHMsIG1hc2tfcGF0aHMgPSBnZXRfaW1hZ2VfYW5kX21hc2tfcGF0aHMoc2VsZi5yYXdfaW1nX2ZvbGRlcikNCg0KICAgICAgICBoYWJpdGF0X3BhdGhzID0ge30NCiAgICAgICAgZm9yIHN1YmogaW4gUGF0aChzZWxmLmhhYml0YXRzX21hcF9mb2xkZXIpLmdsb2Ioc2VsZi5faGFiaXRhdF9wYXR0ZXJuKToNCiAgICAgICAgICAgIGtleSA9IHN1YmoubmFtZS5yZXBsYWNlKHNlbGYuX2hhYml0YXRfcGF0dGVybi5yZXBsYWNlKCIqIiwgIiIpLCAiIikNCiAgICAgICAgICAgIGhhYml0YXRfcGF0aHNba2V5XSA9IHN0cihzdWJqKQ0KDQogICAgICAgIHJldHVybiBpbWFnZXNfcGF0aHMsIGhhYml0YXRfcGF0aHMsIG1hc2tfcGF0aHMNCg0KICAgIGRlZiBwcm9jZXNzX3N1YmplY3Qoc2VsZiwgc3ViaiwgaW1hZ2VzX3BhdGhzLCBoYWJpdGF0X3BhdGhzLCBtYXNrX3BhdGhzPU5vbmUsIGZlYXR1cmVfdHlwZXM9Tm9uZSk6DQogICAgICAgICIiIlByb2Nlc3MgYSBzaW5nbGUgc3ViamVjdCBmb3IgaGFiaXRhdCBmZWF0dXJlIGV4dHJhY3Rpb24iIiINCiAgICAgICAgc3ViamVjdF9mZWF0dXJlcyA9IHt9DQogICAgICAgIGltZ3MgPSBsaXN0KGltYWdlc19wYXRoc1tzdWJqXS5rZXlzKCkpDQogICAgICAgIA0KICAgICAgICAjIOWmguaenOacquaMh+WumueJueW+geexu+Wei++8jOWImem7mOiupOaPkOWPluaJgOacieeJueW+gQ0KICAgICAgICBpZiBmZWF0dXJlX3R5cGVzIGlzIE5vbmU6DQogICAgICAgICAgICBmZWF0dXJlX3R5cGVzID0gWyd0cmFkaXRpb25hbCcsICdub25fcmFkaW9taWNzJywgJ3dob2xlX2hhYml0YXQnLCAnZWFjaF9oYWJpdGF0JywgJ21zaScsICdpdGhfc2NvcmUnXQ0KDQogICAgICAgICMgRXh0cmFjdCBiYXNpYyBoYWJpdGF0IGZlYXR1cmVzDQogICAgICAgIGlmICdub25fcmFkaW9taWNzJyBpbiBmZWF0dXJlX3R5cGVzOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5vbl9yYWRpb21pY3NfZmVhdHVyZXMgPSBzZWxmLmJhc2ljX2V4dHJhY3Rvci5nZXRfbm9uX3JhZGlvbWljc19mZWF0dXJlcyhoYWJpdGF0X3BhdGhzW3N1YmpdKQ0KICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ25vbl9yYWRpb21pY3NfZmVhdHVyZXMnXSA9IG5vbl9yYWRpb21pY3NfZmVhdHVyZXMNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyBiYXNpYyBmZWF0dXJlcyBmb3Igc3ViamVjdCB7c3Vian06IHtzdHIoZSl9IikNCiAgICAgICAgICAgICAgICBzdWJqZWN0X2ZlYXR1cmVzWydub25fcmFkaW9taWNzX2ZlYXR1cmVzJ10gPSB7ImVycm9yIjogc3RyKGUpfQ0KDQogICAgICAgICMgRXh0cmFjdCB0cmFkaXRpb25hbCByYWRpb21pY3MgZmVhdHVyZXMgZnJvbSBvcmlnaW5hbCBpbWFnZXMNCiAgICAgICAgaWYgJ3RyYWRpdGlvbmFsJyBpbiBmZWF0dXJlX3R5cGVzOg0KICAgICAgICAgICAgc3ViamVjdF9mZWF0dXJlc1sndHJhbmRpdGlvbmFsX3JhZGlvbWljc19mZWF0dXJlcyddID0ge30NCiAgICAgICAgICAgIGZvciBpbWcgaW4gaW1nczoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ3RyYW5kaXRpb25hbF9yYWRpb21pY3NfZmVhdHVyZXMnXVtpbWddID0gXA0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yYWRpb21pY3NfZXh0cmFjdG9yLmV4dHJhY3RfdHJhbmRpdGlvbmFsX3JhZGlvbWljcygNCiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlc19wYXRoc1tzdWJqXVtpbWddLCANCiAgICAgICAgICAgICAgICAgICAgICAgIGhhYml0YXRfcGF0aHNbc3Vial0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViaiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucGFyYW1zX2ZpbGVfb2Zfbm9uX2hhYml0YXQNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHByb2Nlc3NpbmcgdHJhZGl0aW9uYWwgcmFkaW9taWNzIGZlYXR1cmVzIGZvciBzdWJqZWN0IHtzdWJqfSwgaW1hZ2Uge2ltZ306IHtzdHIoZSl9IikNCiAgICAgICAgICAgICAgICAgICAgc3ViamVjdF9mZWF0dXJlc1sndHJhbmRpdGlvbmFsX3JhZGlvbWljc19mZWF0dXJlcyddW2ltZ10gPSB7ImVycm9yIjogc3RyKGUpfQ0KDQogICAgICAgICMgRXh0cmFjdCByYWRpb21pY3MgZmVhdHVyZXMgZnJvbSB0aGUgd2hvbGUgaGFiaXRhdCBtYXANCiAgICAgICAgaWYgJ3dob2xlX2hhYml0YXQnIGluIGZlYXR1cmVfdHlwZXM6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcmFkaW9taWNzX2ZlYXR1cmVzX29mX3dob2xlX2hhYml0YXQgPSBzZWxmLnJhZGlvbWljc19leHRyYWN0b3IuZXh0cmFjdF9yYWRpb21pY3NfZmVhdHVyZXNfZm9yX3dob2xlX2hhYml0YXQoDQogICAgICAgICAgICAgICAgICAgIGhhYml0YXRfcGF0aHNbc3Vial0sIA0KICAgICAgICAgICAgICAgICAgICBzZWxmLnBhcmFtc19maWxlX29mX2hhYml0YXQNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgc3ViamVjdF9mZWF0dXJlc1sncmFkaW9taWNzX2ZlYXR1cmVzX29mX3dob2xlX2hhYml0YXRfbWFwJ10gPSByYWRpb21pY3NfZmVhdHVyZXNfb2Zfd2hvbGVfaGFiaXRhdA0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBwcm9jZXNzaW5nIHdob2xlIGhhYml0YXQgcmFkaW9taWNzIGZlYXR1cmVzIGZvciBzdWJqZWN0IHtzdWJqfToge3N0cihlKX0iKQ0KICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ3JhZGlvbWljc19mZWF0dXJlc19vZl93aG9sZV9oYWJpdGF0X21hcCddID0geyJlcnJvciI6IHN0cihlKX0NCiAgICAgICAgDQogICAgICAgICMgRXh0cmFjdCByYWRpb21pY3MgZmVhdHVyZXMgZnJvbSBlYWNoIGhhYml0YXQNCiAgICAgICAgaWYgJ2VhY2hfaGFiaXRhdCcgaW4gZmVhdHVyZV90eXBlczoNCiAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdCddID0ge30NCiAgICAgICAgICAgIGZvciBpbWcgaW4gaW1nczoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGhhYml0YXRfZmVhdHVyZXMgPSBzZWxmLnJhZGlvbWljc19leHRyYWN0b3IuZXh0cmFjdF9yYWRpb21pY3NfZmVhdHVyZXNfZnJvbV9lYWNoX2hhYml0YXQoDQogICAgICAgICAgICAgICAgICAgICAgICBoYWJpdGF0X3BhdGhzW3N1YmpdLCANCiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlc19wYXRoc1tzdWJqXVtpbWddLCANCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmosIA0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXJhbXNfZmlsZV9vZl9ub25faGFiaXRhdA0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdCddW2ltZ10gPSBoYWJpdGF0X2ZlYXR1cmVzDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyByYWRpb21pY3MgZmVhdHVyZXMgZm9yIHN1YmplY3Qge3N1Ymp9LCBoYWJpdGF0IHtpbWd9OiB7c3RyKGUpfSIpDQogICAgICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdCddW2ltZ10gPSB7ImVycm9yIjogc3RyKGUpfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAjIEV4dHJhY3QgTVNJIGZlYXR1cmVzDQogICAgICAgIGlmICdtc2knIGluIGZlYXR1cmVfdHlwZXM6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgbl9oYWJpdGF0cyA9IHNlbGYuX2dldF9uX2hhYml0YXRzX2Zyb21fY3N2KCkNCiAgICAgICAgICAgICAgICBtc2lfZmVhdHVyZXMgPSBzZWxmLm1zaV9leHRyYWN0b3IuZXh0cmFjdF9NU0lfZmVhdHVyZXMoaGFiaXRhdF9wYXRoc1tzdWJqXSwgbl9oYWJpdGF0cywgc3ViaikNCiAgICAgICAgICAgICAgICBzdWJqZWN0X2ZlYXR1cmVzWydtc2lfZmVhdHVyZXMnXSA9IG1zaV9mZWF0dXJlcw0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBwcm9jZXNzaW5nIE1TSSBmZWF0dXJlcyBmb3Igc3ViamVjdCB7c3Vian06IHtzdHIoZSl9IikNCiAgICAgICAgICAgICAgICBzdWJqZWN0X2ZlYXR1cmVzWydtc2lfZmVhdHVyZXMnXSA9IHsiZXJyb3IiOiBzdHIoZSl9DQogICAgICAgICAgICANCiAgICAgICAgIyBFeHRyYWN0IElUSCBmZWF0dXJlcyBpZiBlbmFibGVkIGFuZCBtYXNrcyBhcmUgYXZhaWxhYmxlDQogICAgICAgIGlmICdpdGhfc2NvcmUnIGluIGZlYXR1cmVfdHlwZXM6DQogICAgICAgICAgICBzdWJqZWN0X2ZlYXR1cmVzWydpdGhfZmVhdHVyZXMnXSA9IHt9DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgIyBFeHRyYWN0IElUSCBmZWF0dXJlcw0KICAgICAgICAgICAgICAgIGl0aF9mZWF0dXJlcyA9IHNlbGYuaXRoX2V4dHJhY3Rvci5leHRyYWN0X2l0aF9mZWF0dXJlcyhoYWJpdGF0X3BhdGhzW3N1YmpdKQ0KICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ2l0aF9mZWF0dXJlcyddID0gaXRoX2ZlYXR1cmVzDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHByb2Nlc3NpbmcgSVRIIGZlYXR1cmVzIGZvciBzdWJqZWN0IHtzdWJqfToge3N0cihlKX0iKQ0KICAgICAgICAgICAgICAgIHN1YmplY3RfZmVhdHVyZXNbJ2l0aF9mZWF0dXJlcyddID0geyJlcnJvciI6IHN0cihlKX0NCg0KICAgICAgICByZXR1cm4gc3Viaiwgc3ViamVjdF9mZWF0dXJlcw0KDQogICAgZGVmIGV4dHJhY3RfZmVhdHVyZXMoc2VsZiwgaW1hZ2VzX3BhdGhzLCBoYWJpdGF0X3BhdGhzLCBtYXNrX3BhdGhzPU5vbmUsIGZlYXR1cmVfdHlwZXM9Tm9uZSk6DQogICAgICAgICIiIkV4dHJhY3QgaGFiaXRhdCBmZWF0dXJlcyBmb3IgYWxsIHN1YmplY3RzIiIiDQogICAgICAgIGZlYXR1cmVzID0ge30NCiAgICAgICAgc3VianMgPSBsaXN0KHNldChpbWFnZXNfcGF0aHMua2V5cygpKSAmIHNldChoYWJpdGF0X3BhdGhzLmtleXMoKSkpDQogICAgICAgIA0KICAgICAgICBpZiBub3Qgc3VianM6DQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKCJObyBtYXRjaGluZyBzdWJqZWN0cyBmb3VuZCBiZXR3ZWVuIG9yaWdpbmFsIGltYWdlcyBhbmQgaGFiaXRhdCBtYXBzIikNCiAgICAgICAgICAgIHJldHVybiBmZWF0dXJlcw0KICAgICAgICAgICAgDQogICAgICAgIHByaW50KGYiKioqKioqKioqKioqKipTdGFydGluZyBoYWJpdGF0IGZlYXR1cmUgZXh0cmFjdGlvbiBmb3Ige2xlbihzdWJqcyl9IHN1YmplY3RzIHVzaW5nIHtzZWxmLm5fcHJvY2Vzc2VzfSBwcm9jZXNzZXMqKioqKioqKioqKioqKiIpDQogICAgICAgIA0KICAgICAgICB3aXRoIG11bHRpcHJvY2Vzc2luZy5Qb29sKHByb2Nlc3Nlcz1zZWxmLm5fcHJvY2Vzc2VzKSBhcyBwb29sOg0KICAgICAgICAgICAgcHJvY2Vzc19mdW5jID0gcGFydGlhbChzZWxmLnByb2Nlc3Nfc3ViamVjdCwgaW1hZ2VzX3BhdGhzPWltYWdlc19wYXRocywgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYWJpdGF0X3BhdGhzPWhhYml0YXRfcGF0aHMsIG1hc2tfcGF0aHM9bWFza19wYXRocywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVfdHlwZXM9ZmVhdHVyZV90eXBlcykNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdG90YWwgPSBsZW4oc3VianMpDQogICAgICAgICAgICBwcm9ncmVzc19iYXIgPSBDdXN0b21UcWRtKHRvdGFsPXRvdGFsLCBkZXNjPSJFeHRyYWN0aW5nIEZlYXR1cmVzIikNCiAgICAgICAgICAgIGZvciBpLCAoc3Viaiwgc3ViamVjdF9mZWF0dXJlcykgaW4gZW51bWVyYXRlKHBvb2wuaW1hcF91bm9yZGVyZWQocHJvY2Vzc19mdW5jLCBzdWJqcykpOg0KICAgICAgICAgICAgICAgIGZlYXR1cmVzW3N1YmpdID0gc3ViamVjdF9mZWF0dXJlcw0KICAgICAgICAgICAgICAgIHByb2dyZXNzX2Jhci51cGRhdGUoMSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgcmV0dXJuIGZlYXR1cmVzDQoNCiAgICBkZWYgcnVuKHNlbGYsIGZlYXR1cmVfdHlwZXM6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lLCBuX2hhYml0YXRzOiBPcHRpb25hbFtpbnRdID0gTm9uZSk6DQogICAgICAgICIiIlJ1biB0aGUgY29tcGxldGUgYW5hbHlzaXMgcGlwZWxpbmUNCiAgICAgICAgDQogICAgICAgIEFyZ3M6DQogICAgICAgICAgICBmZWF0dXJlX3R5cGVzOiBUeXBlcyBvZiBmZWF0dXJlcyB0byBleHRyYWN0DQogICAgICAgICAgICBuX2hhYml0YXRzOiBOdW1iZXIgb2YgaGFiaXRhdHMgdG8gcHJvY2VzcyAoTm9uZSBmb3IgYXV0byBkZXRlY3Rpb24pDQogICAgICAgICIiIg0KICAgICAgICBpZiBub3Qgc2VsZi5vdXRfZGlyOg0KICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiT3V0cHV0IGRpcmVjdG9yeSBtdXN0IGJlIHNwZWNpZmllZCB0byBydW4gdGhlIGFuYWx5c2lzIikNCiAgICAgICAgICAgIA0KICAgICAgICAjIOaPkOWPlueJueW+geW5tuebtOaOpeWkhOeQhuS4ukNTVg0KICAgICAgICBpbWFnZXNfcGF0aHMsIGhhYml0YXRfcGF0aHMsIG1hc2tfcGF0aHMgPSBzZWxmLmdldF9tYXNrX2FuZF9yYXdfZmlsZXMoKQ0KICAgICAgICBmZWF0dXJlX2RhdGEgPSBzZWxmLmV4dHJhY3RfZmVhdHVyZXMoaW1hZ2VzX3BhdGhzLCBoYWJpdGF0X3BhdGhzLCBtYXNrX3BhdGhzLCBmZWF0dXJlX3R5cGVzKQ0KICAgICAgICANCiAgICAgICAgIyDnm7TmjqXnlJ/miJBDU1YgKOWmguaenOacquaMh+WumueJueW+geexu+Wei+WImeS4jeeUn+aIkCkNCiAgICAgICAgaWYgZmVhdHVyZV90eXBlczoNCiAgICAgICAgICAgICMg5aaC5p6c5pyq5oyH5a6abl9oYWJpdGF0c+WImeiHquWKqOajgOa1iw0KICAgICAgICAgICAgaWYgbl9oYWJpdGF0cyBpcyBOb25lOg0KICAgICAgICAgICAgICAgIG5faGFiaXRhdHMgPSBzZWxmLl9nZXRfbl9oYWJpdGF0c19mcm9tX2NzdigpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJVc2luZyBoYWJpdGF0IGNvdW50OiB7bl9oYWJpdGF0c30iKQ0KICAgICAgICAgICAgc2VsZi5uX2hhYml0YXRzID0gbl9oYWJpdGF0cw0KICAgICAgICAgICAgc2VsZi5kYXRhID0gZmVhdHVyZV9kYXRhDQogICAgICAgICAgICANCiAgICAgICAgICAgICMg5qC55o2u5oyH5a6a55qE54m55b6B57G75Z6L55Sf5oiQQ1NWDQogICAgICAgICAgICBpZiAndHJhZGl0aW9uYWwnIGluIGZlYXR1cmVfdHlwZXM6DQogICAgICAgICAgICAgICAgc2VsZi5fZXh0cmFjdF90cmFkaXRpb25hbF9yYWRpb21pY3MoKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgJ25vbl9yYWRpb21pY3MnIGluIGZlYXR1cmVfdHlwZXM6DQogICAgICAgICAgICAgICAgc2VsZi5fZXh0cmFjdF9ub25fcmFkaW9taWNzX2ZlYXR1cmVzKG5faGFiaXRhdHMpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAnd2hvbGVfaGFiaXRhdCcgaW4gZmVhdHVyZV90eXBlczoNCiAgICAgICAgICAgICAgICBzZWxmLl9leHRyYWN0X3JhZGlvbWljc19mZWF0dXJlc19mb3Jfd2hvbGVfaGFiaXRhdF9tYXAoKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgJ2VhY2hfaGFiaXRhdCcgaW4gZmVhdHVyZV90eXBlczoNCiAgICAgICAgICAgICAgICBzZWxmLl9leHRyYWN0X3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdChuX2hhYml0YXRzKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgJ21zaScgaW4gZmVhdHVyZV90eXBlczoNCiAgICAgICAgICAgICAgICBzZWxmLl9leHRyYWN0X21zaV9mZWF0dXJlcygpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAnaXRoX3Njb3JlJyBpbiBmZWF0dXJlX3R5cGVzOg0KICAgICAgICAgICAgICAgIHNlbGYuX2V4dHJhY3RfaXRoX2ZlYXR1cmVzKCkNCiAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gc2VsZg0KDQogICAgZGVmIF9leHRyYWN0X3RyYWRpdGlvbmFsX3JhZGlvbWljcyhzZWxmKToNCiAgICAgICAgIiIiRXh0cmFjdCB0cmFkaXRpb25hbCByYWRpb21pY3MgZmVhdHVyZXMgZnJvbSBvcmlnaW5hbCBpbWFnZXMiIiINCiAgICAgICAgbG9nZ2luZy5pbmZvKCJTdGFydGluZyBleHRyYWN0aW9uIG9mIHRyYWRpdGlvbmFsIHJhZGlvbWljcyBmZWF0dXJlcyIpDQogICAgICAgIHN1YmpzID0gbGlzdChzZWxmLmRhdGEua2V5cygpKQ0KICAgICAgICB0cmFuZGl0aW9uYWxfcmFkaW9taWNzID0gW10NCiAgICAgICAgdG90YWwgPSBsZW4oc3VianMpDQogICAgICAgIA0KICAgICAgICBwcm9ncmVzc19iYXIgPSBDdXN0b21UcWRtKHRvdGFsPXRvdGFsLCBkZXNjPSJQcm9jZXNzaW5nIFRyYWRpdGlvbmFsIFJhZGlvbWljcyIpDQogICAgICAgIGZvciBpLCBzdWJqIGluIGVudW1lcmF0ZShzdWJqcyk6DQogICAgICAgICAgICBwcm9ncmVzc19iYXIudXBkYXRlKDEpDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpbWdzID0gbGlzdChzZWxmLmRhdGEuZ2V0KHN1YmopLmdldCgndHJhbmRpdGlvbmFsX3JhZGlvbWljc19mZWF0dXJlcycpLmtleXMoKSkNCiAgICAgICAgICAgICAgICBkZnMgPSBwZC5EYXRhRnJhbWUoW3NlbGYuZGF0YS5nZXQoc3ViaikuZ2V0KCd0cmFuZGl0aW9uYWxfcmFkaW9taWNzX2ZlYXR1cmVzJykuZ2V0KGltZykgZm9yIGltZyBpbiBpbWdzXSwgaW5kZXg9aW1ncykNCiAgICAgICAgICAgICAgICBkZnMgPSBkZnMubG9jWzosIH5kZnMuY29sdW1ucy5zdHIuY29udGFpbnMoJ2RpYWdub3N0aWMnKV0NCiAgICAgICAgICAgICAgICBuZXdfY29sdW1ucyA9IFtmIntjb2x9X29mX3tpZHh9IiBmb3IgaWR4IGluIGRmcy5pbmRleCBmb3IgY29sIGluIGRmcy5jb2x1bW5zXQ0KICAgICAgICAgICAgICAgIGRmc19yZXNoYXBlZCA9IHBkLkRhdGFGcmFtZShbZGZzLnZhbHVlcy5mbGF0dGVuKCldLCBjb2x1bW5zPW5ld19jb2x1bW5zKQ0KICAgICAgICAgICAgICAgIHRyYW5kaXRpb25hbF9yYWRpb21pY3MuYXBwZW5kKGRmc19yZXNoYXBlZCkNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyB0cmFkaXRpb25hbCByYWRpb21pY3MgZmVhdHVyZXMgZm9yIHN1YmplY3Qge3N1Ymp9OiB7c3RyKGUpfSIpDQogICAgICAgICAgICAgICAgIyBDcmVhdGUgYW4gZW1wdHkgRGF0YUZyYW1lIHdpdGggY29sdW1ucyBtYXRjaGluZyBvdGhlciBzdWJqZWN0cw0KICAgICAgICAgICAgICAgIGlmIGxlbih0cmFuZGl0aW9uYWxfcmFkaW9taWNzKSA+IDA6DQogICAgICAgICAgICAgICAgICAgIGVtcHR5X2RmID0gRmVhdHVyZVV0aWxzLmNyZWF0ZV9lbXB0eV9kYXRhZnJhbWVfbGlrZSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5kaXRpb25hbF9yYWRpb21pY3NbMF0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9WzBdDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgdHJhbmRpdGlvbmFsX3JhZGlvbWljcy5hcHBlbmQoZW1wdHlfZGYpDQogICAgICAgIA0KICAgICAgICBpZiBsZW4odHJhbmRpdGlvbmFsX3JhZGlvbWljcykgPiAwOg0KICAgICAgICAgICAgdHJhbmRpdGlvbmFsX3JhZGlvbWljcyA9IHBkLmNvbmNhdCh0cmFuZGl0aW9uYWxfcmFkaW9taWNzKQ0KICAgICAgICAgICAgdHJhbmRpdGlvbmFsX3JhZGlvbWljcy5pbmRleCA9IHN1YmpzDQogICAgICAgICAgICANCiAgICAgICAgICAgIG91dF9maWxlID0gb3MucGF0aC5qb2luKHNlbGYub3V0X2RpciwgInJhd19pbWFnZV9yYWRpb21pY3MuY3N2IikNCiAgICAgICAgICAgIHRyYW5kaXRpb25hbF9yYWRpb21pY3MudG9fY3N2KG91dF9maWxlLCBpbmRleD1UcnVlKQ0KICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiVHJhZGl0aW9uYWwgcmFkaW9taWNzIGZlYXR1cmVzIHNhdmVkIHRvIHtvdXRfZmlsZX0iKQ0KICAgICAgICAgICAgcmV0dXJuIHRyYW5kaXRpb25hbF9yYWRpb21pY3MNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoIkVycm9yIHByb2Nlc3NpbmcgdHJhZGl0aW9uYWwgcmFkaW9taWNzIGZlYXR1cmVzLCBubyB2YWxpZCByZXN1bHRzIikNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgX2V4dHJhY3Rfbm9uX3JhZGlvbWljc19mZWF0dXJlcyhzZWxmLCBuX2hhYml0YXRzOiBpbnQpOg0KICAgICAgICAiIiJFeHRyYWN0IGJhc2ljIGhhYml0YXQgZmVhdHVyZXMgKG51bWJlciBvZiBkaXNjb25uZWN0ZWQgcmVnaW9ucyBhbmQgdm9sdW1lIHJhdGlvKSIiIg0KICAgICAgICBsb2dnaW5nLmluZm8oIlN0YXJ0aW5nIGV4dHJhY3Rpb24gb2YgYmFzaWMgaGFiaXRhdCBmZWF0dXJlcyIpDQogICAgICAgIHN1YmpzID0gbGlzdChzZWxmLmRhdGEua2V5cygpKQ0KICAgICAgICANCiAgICAgICAgIyDlrprkuYnliJflkI3vvJpudW1faGFiaXRhdHMgKyDmr4/kuKrnlJ/looPnmoTljLrln5/mlbDph4/lkozkvZPnp6/mr5TkvosNCiAgICAgICAgbjEgPSBbZiJ7aX1fbnVtX3JlZ2lvbnMiIGZvciBpIGluIHJhbmdlKDEsIG5faGFiaXRhdHMrMSldDQogICAgICAgIG4yID0gW2Yie2l9X3ZvbHVtZV9yYXRpbyIgZm9yIGkgaW4gcmFuZ2UoMSwgbl9oYWJpdGF0cysxKV0NCiAgICAgICAgY29sdW1ucyA9IFsnbnVtX2hhYml0YXRzJ10gKyBuMSArIG4yDQogICAgICAgIA0KICAgICAgICBub25fcmFkaW9taWNzX2ZlYXR1cmVzID0gcGQuRGF0YUZyYW1lKGluZGV4PXN1YmpzLCBjb2x1bW5zPWNvbHVtbnMpDQogICAgICAgIHRvdGFsID0gbGVuKHN1YmpzKQ0KICAgICAgICANCiAgICAgICAgcHJvZ3Jlc3NfYmFyID0gQ3VzdG9tVHFkbSh0b3RhbD10b3RhbCwgZGVzYz0iUHJvY2Vzc2luZyBCYXNpYyBIYWJpdGF0IEZlYXR1cmVzIikNCiAgICAgICAgZm9yIGksIHN1YmogaW4gZW51bWVyYXRlKHN1YmpzKToNCiAgICAgICAgICAgIHByb2dyZXNzX2Jhci51cGRhdGUoMSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICMg6I635Y+W5Z+65pys54m55b6B5pWw5o2uDQogICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBzZWxmLmRhdGEuZ2V0KHN1YmopLmdldCgnbm9uX3JhZGlvbWljc19mZWF0dXJlcycpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyDlpITnkIZudW1faGFiaXRhdHMNCiAgICAgICAgICAgICAgICBub25fcmFkaW9taWNzX2ZlYXR1cmVzLmxvY1tzdWJqLCAnbnVtX2hhYml0YXRzJ10gPSBmZWF0dXJlcy5nZXQoJ251bV9oYWJpdGF0cycsIDApDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyDlpITnkIbmr4/kuKrnlJ/looPnmoTnibnlvoENCiAgICAgICAgICAgICAgICBmb3IgaGFiaXRhdF9pZCBpbiByYW5nZSgxLCBuX2hhYml0YXRzKzEpOg0KICAgICAgICAgICAgICAgICAgICBoYWJpdGF0X2RhdGEgPSBmZWF0dXJlcy5nZXQoaGFiaXRhdF9pZCwge30pDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAjIOWMuuWfn+aVsOmHjw0KICAgICAgICAgICAgICAgICAgICBudW1fcmVnaW9uc19jb2wgPSBmIntoYWJpdGF0X2lkfV9udW1fcmVnaW9ucyINCiAgICAgICAgICAgICAgICAgICAgaWYgbnVtX3JlZ2lvbnNfY29sIGluIGNvbHVtbnM6DQogICAgICAgICAgICAgICAgICAgICAgICBub25fcmFkaW9taWNzX2ZlYXR1cmVzLmxvY1tzdWJqLCBudW1fcmVnaW9uc19jb2xdID0gaGFiaXRhdF9kYXRhLmdldCgnbnVtX3JlZ2lvbnMnLCAwKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgIyDkvZPnp6/mr5TkvosNCiAgICAgICAgICAgICAgICAgICAgdm9sdW1lX3JhdGlvX2NvbCA9IGYie2hhYml0YXRfaWR9X3ZvbHVtZV9yYXRpbyINCiAgICAgICAgICAgICAgICAgICAgaWYgdm9sdW1lX3JhdGlvX2NvbCBpbiBjb2x1bW5zOg0KICAgICAgICAgICAgICAgICAgICAgICAgbm9uX3JhZGlvbWljc19mZWF0dXJlcy5sb2Nbc3Viaiwgdm9sdW1lX3JhdGlvX2NvbF0gPSBoYWJpdGF0X2RhdGEuZ2V0KCd2b2x1bWVfcmF0aW8nLCAwLjApDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHByb2Nlc3NpbmcgYmFzaWMgaGFiaXRhdCBmZWF0dXJlcyBmb3Igc3ViamVjdCB7c3Vian06IHtzdHIoZSl9IikNCiAgICAgICAgICAgICAgICAjIOiuvue9ruaJgOacieeJueW+geS4uk5hTg0KICAgICAgICAgICAgICAgIG5vbl9yYWRpb21pY3NfZmVhdHVyZXMubG9jW3N1YmosIDpdID0gbnAubmFuDQoNCiAgICAgICAgIyDkv53lrZjliLBDU1bmlofku7YNCiAgICAgICAgb3V0X2ZpbGUgPSBvcy5wYXRoLmpvaW4oc2VsZi5vdXRfZGlyLCAiaGFiaXRhdF9iYXNpY19mZWF0dXJlcy5jc3YiKQ0KICAgICAgICBub25fcmFkaW9taWNzX2ZlYXR1cmVzLnRvX2NzdihvdXRfZmlsZSwgaW5kZXg9VHJ1ZSkNCiAgICAgICAgbG9nZ2luZy5pbmZvKGYiQmFzaWMgaGFiaXRhdCBmZWF0dXJlcyBzYXZlZCB0byB7b3V0X2ZpbGV9IikNCiAgICAgICAgcmV0dXJuIG5vbl9yYWRpb21pY3NfZmVhdHVyZXMNCg0KICAgIGRlZiBfZXh0cmFjdF9yYWRpb21pY3NfZmVhdHVyZXNfZm9yX3dob2xlX2hhYml0YXRfbWFwKHNlbGYpOg0KICAgICAgICAiIiJFeHRyYWN0IHJhZGlvbWljcyBmZWF0dXJlcyBmcm9tIHRoZSB3aG9sZSBoYWJpdGF0IG1hcCIiIg0KICAgICAgICBsb2dnaW5nLmluZm8oIlN0YXJ0aW5nIGV4dHJhY3Rpb24gb2Ygd2hvbGUgaGFiaXRhdCByYWRpb21pY3MgZmVhdHVyZXMiKQ0KICAgICAgICBzdWJqcyA9IGxpc3Qoc2VsZi5kYXRhLmtleXMoKSkNCiAgICAgICAgcmFkaW9taWNzX29mX3dob2xlX2hhYml0YXQgPSBbXQ0KICAgICAgICB0b3RhbCA9IGxlbihzdWJqcykNCiAgICAgICAgDQogICAgICAgIHByb2dyZXNzX2JhciA9IEN1c3RvbVRxZG0odG90YWw9dG90YWwsIGRlc2M9IlByb2Nlc3NpbmcgV2hvbGUgSGFiaXRhdCBSYWRpb21pY3MiKQ0KICAgICAgICBmb3IgaSwgc3ViaiBpbiBlbnVtZXJhdGUoc3VianMpOg0KICAgICAgICAgICAgcHJvZ3Jlc3NfYmFyLnVwZGF0ZSgxKQ0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBzZWxmLmRhdGEuZ2V0KHN1YmopLmdldCgncmFkaW9taWNzX2ZlYXR1cmVzX29mX3dob2xlX2hhYml0YXRfbWFwJykNCiAgICAgICAgICAgICAgICBmZWF0dXJlc19kZiA9IHBkLkRhdGFGcmFtZS5mcm9tX2RpY3QoZmVhdHVyZXMsIG9yaWVudD0naW5kZXgnKS5UDQogICAgICAgICAgICAgICAgZmVhdHVyZXNfZGYgPSBmZWF0dXJlc19kZi5sb2NbOiwgfmZlYXR1cmVzX2RmLmNvbHVtbnMuc3RyLmNvbnRhaW5zKCdkaWFnbm9zdGljJyldDQogICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX3dob2xlX2hhYml0YXQuYXBwZW5kKGZlYXR1cmVzX2RmKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBwcm9jZXNzaW5nIHdob2xlIGhhYml0YXQgcmFkaW9taWNzIGZlYXR1cmVzIGZvciBzdWJqZWN0IHtzdWJqfToge3N0cihlKX0iKQ0KICAgICAgICAgICAgICAgICMgQ3JlYXRlIGFuIGVtcHR5IERhdGFGcmFtZSB3aXRoIGNvbHVtbnMgbWF0Y2hpbmcgb3RoZXIgc3ViamVjdHMNCiAgICAgICAgICAgICAgICBpZiBsZW4ocmFkaW9taWNzX29mX3dob2xlX2hhYml0YXQpID4gMDoNCiAgICAgICAgICAgICAgICAgICAgZW1wdHlfZGYgPSBGZWF0dXJlVXRpbHMuY3JlYXRlX2VtcHR5X2RhdGFmcmFtZV9saWtlKA0KICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX3dob2xlX2hhYml0YXRbMF0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9WzBdDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX3dob2xlX2hhYml0YXQuYXBwZW5kKGVtcHR5X2RmKQ0KICAgICAgICANCiAgICAgICAgaWYgbGVuKHJhZGlvbWljc19vZl93aG9sZV9oYWJpdGF0KSA+IDA6DQogICAgICAgICAgICByYWRpb21pY3Nfb2Zfd2hvbGVfaGFiaXRhdCA9IHBkLmNvbmNhdChyYWRpb21pY3Nfb2Zfd2hvbGVfaGFiaXRhdCkNCiAgICAgICAgICAgIHJhZGlvbWljc19vZl93aG9sZV9oYWJpdGF0LmluZGV4ID0gc3VianMNCg0KICAgICAgICAgICAgb3V0X2ZpbGUgPSBvcy5wYXRoLmpvaW4oc2VsZi5vdXRfZGlyLCAid2hvbGVfaGFiaXRhdF9yYWRpb21pY3MuY3N2IikNCiAgICAgICAgICAgIHJhZGlvbWljc19vZl93aG9sZV9oYWJpdGF0LnRvX2NzdihvdXRfZmlsZSwgaW5kZXg9VHJ1ZSkNCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIldob2xlIGhhYml0YXQgcmFkaW9taWNzIGZlYXR1cmVzIHNhdmVkIHRvIHtvdXRfZmlsZX0iKQ0KICAgICAgICAgICAgcmV0dXJuIHJhZGlvbWljc19vZl93aG9sZV9oYWJpdGF0DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKCJFcnJvciBwcm9jZXNzaW5nIHdob2xlIGhhYml0YXQgcmFkaW9taWNzIGZlYXR1cmVzLCBubyB2YWxpZCByZXN1bHRzIikNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgX2V4dHJhY3RfcmFkaW9taWNzX2ZlYXR1cmVzX2Zyb21fZWFjaF9oYWJpdGF0KHNlbGYsIG5faGFiaXRhdHM6IGludCk6DQogICAgICAgICIiIkV4dHJhY3QgcmFkaW9taWNzIGZlYXR1cmVzIGZyb20gZWFjaCBoYWJpdGF0IiIiDQogICAgICAgIGxvZ2dpbmcuaW5mbygiU3RhcnRpbmcgZXh0cmFjdGlvbiBvZiByYWRpb21pY3MgZmVhdHVyZXMgZnJvbSBlYWNoIGhhYml0YXQiKQ0KICAgICAgICBzdWJqcyA9IGxpc3Qoc2VsZi5kYXRhLmtleXMoKSkNCiAgICAgICAgcmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdCA9IHtpKzE6IFtdIGZvciBpIGluIHJhbmdlKG5faGFiaXRhdHMpfQ0KICAgICAgICBoYWJpdGF0X2NvdW50ID0gbnAuemVyb3MoKGxlbihzdWJqcyksIG5faGFiaXRhdHMpKQ0KICAgICAgICBoYWJpdGF0X2NvdW50ID0gcGQuRGF0YUZyYW1lKGhhYml0YXRfY291bnQsIGluZGV4PXN1YmpzLCBjb2x1bW5zPVtucC5hcmFuZ2UoMSwgbl9oYWJpdGF0cysxKV0pDQoNCiAgICAgICAgdG90YWwgPSBsZW4ocmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdCkNCiAgICAgICAgDQogICAgICAgIHByb2dyZXNzX2JhciA9IEN1c3RvbVRxZG0odG90YWw9dG90YWwsIGRlc2M9IlByb2Nlc3NpbmcgSGFiaXRhdHMiKQ0KICAgICAgICBmb3IgaGFiaXRhdF9pZCBpbiByYWRpb21pY3Nfb2ZfZWFjaF9oYWJpdGF0LmtleXMoKToNCiAgICAgICAgICAgIHByb2dyZXNzX2Jhci51cGRhdGUoMSkNCg0KICAgICAgICAgICAgZm9yIGksIHN1YmogaW4gZW51bWVyYXRlKHN1YmpzKToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPT0gMDogDQogICAgICAgICAgICAgICAgICAgICAgICBpbWdzID0gbGlzdChzZWxmLmRhdGEuZ2V0KHN1YmopLmdldCgncmFkaW9taWNzX2ZlYXR1cmVzX2Zyb21fZWFjaF9oYWJpdGF0Jykua2V5cygpKQ0KICAgICAgICAgICAgICAgICAgICByYWRpb21pY3Nfb2ZfaGFiaXRhdCA9IFtdIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaWltZywgaW1nIGluIGVudW1lcmF0ZShpbWdzKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYWJpdGF0X2lkID09IDEpICYgKGlpbWcgPT0gMCk6IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IGxpc3Qoc2VsZi5kYXRhLmdldChzdWJqKS5nZXQoJ3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdCcpLmdldChpbWcpLmtleXMoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYWJpdGF0X2NvdW50LmxvY1tzdWJqLCBjb2xdID0gMQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlID0gc2VsZi5kYXRhLmdldChzdWJqKS5nZXQoJ3JhZGlvbWljc19mZWF0dXJlc19mcm9tX2VhY2hfaGFiaXRhdCcpLmdldChpbWcpLmdldChoYWJpdGF0X2lkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmVhdHVyZSBpcyBub3QgTm9uZTogDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGYgPSBwZC5EYXRhRnJhbWUuZnJvbV9kaWN0KGZlYXR1cmUsIG9yaWVudD0naW5kZXgnKS5UDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX2hhYml0YXQuYXBwZW5kKGRmKSAgDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHJhZGlvbWljc19vZl9oYWJpdGF0KSA+IDA6ICAgDQogICAgICAgICAgICAgICAgICAgICAgICByYWRpb21pY3Nfb2ZfaGFiaXRhdCA9IHBkLmNvbmNhdChyYWRpb21pY3Nfb2ZfaGFiaXRhdCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvbWljc19vZl9oYWJpdGF0LmluZGV4ID0gaW1ncw0KICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX2hhYml0YXQgPSByYWRpb21pY3Nfb2ZfaGFiaXRhdC5sb2NbOiwgfnJhZGlvbWljc19vZl9oYWJpdGF0LmNvbHVtbnMuc3RyLmNvbnRhaW5zKCdkaWFnbm9zdGljJyldDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdfY29sdW1ucyA9IFtmIntjb2x9X29mX3tpZHh9IiBmb3IgaWR4IGluIHJhZGlvbWljc19vZl9oYWJpdGF0LmluZGV4IGZvciBjb2wgaW4gcmFkaW9taWNzX29mX2hhYml0YXQuY29sdW1uc10NCiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvbWljc19vZl9oYWJpdGF0ID0gcGQuRGF0YUZyYW1lKFtyYWRpb21pY3Nfb2ZfaGFiaXRhdC52YWx1ZXMuZmxhdHRlbigpXSwgY29sdW1ucz1uZXdfY29sdW1ucywgaW5kZXg9W3N1YmpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdFtoYWJpdGF0X2lkXS5hcHBlbmQocmFkaW9taWNzX29mX2hhYml0YXQpDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyByYWRpb21pY3MgZmVhdHVyZXMgZm9yIHN1YmplY3Qge3N1Ymp9LCBoYWJpdGF0IHtoYWJpdGF0X2lkfToge3N0cihlKX0iKQ0KICAgICAgICAgICAgICAgICAgICAjIENyZWF0ZSBhbiBlbXB0eSBEYXRhRnJhbWUgaWYgdGhlcmUgYXJlIHN1Y2Nlc3NmdWwgc3ViamVjdHMNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHJhZGlvbWljc19vZl9lYWNoX2hhYml0YXRbaGFiaXRhdF9pZF0pID4gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0X2RmID0gcmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdFtoYWJpdGF0X2lkXVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW1wdHlfZGYgPSBGZWF0dXJlVXRpbHMuY3JlYXRlX2VtcHR5X2RhdGFmcmFtZV9saWtlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0X2RmLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4PVtzdWJqXQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdFtoYWJpdGF0X2lkXS5hcHBlbmQoZW1wdHlfZGYpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGxlbihyYWRpb21pY3Nfb2ZfZWFjaF9oYWJpdGF0W2hhYml0YXRfaWRdKSA+IDA6DQogICAgICAgICAgICAgICAgcmFkaW9taWNzX29mX2VhY2hfaGFiaXRhdFtoYWJpdGF0X2lkXSA9IHBkLmNvbmNhdChyYWRpb21pY3Nfb2ZfZWFjaF9oYWJpdGF0W2hhYml0YXRfaWRdKQ0KICAgICAgICAgICAgICAgIG91dF9maWxlID0gb3MucGF0aC5qb2luKHNlbGYub3V0X2RpciwgZiJoYWJpdGF0X3toYWJpdGF0X2lkfV9yYWRpb21pY3MuY3N2IikNCiAgICAgICAgICAgICAgICByYWRpb21pY3Nfb2ZfZWFjaF9oYWJpdGF0W2hhYml0YXRfaWRdLnRvX2NzdihvdXRfZmlsZSwgaW5kZXg9VHJ1ZSkNCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJSYWRpb21pY3MgZmVhdHVyZXMgZm9yIGhhYml0YXQge2hhYml0YXRfaWR9IHNhdmVkIHRvIHtvdXRfZmlsZX0iKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiTm8gdmFsaWQgcmFkaW9taWNzIGZlYXR1cmVzIGRhdGEgZm9yIGhhYml0YXQge2hhYml0YXRfaWR9IikNCiAgICAgICAgDQogICAgICAgIGhhYml0YXRfY291bnQuY29sdW1ucyA9IFtmImhhc19oYWJpdGF0X3tpfSIgZm9yIGkgaW4gcmFuZ2UoMSwgbl9oYWJpdGF0cysxKV0NCiAgICAgICAgaGFiaXRhdF9jb3VudC50b19jc3Yob3MucGF0aC5qb2luKHNlbGYub3V0X2RpciwgImhhYml0YXRfY291bnQuY3N2IiksIGluZGV4PVRydWUpDQogICAgICAgIGxvZ2dpbmcuaW5mbygiSGFiaXRhdCBjb3VudCBpbmZvcm1hdGlvbiBzYXZlZCIpDQogICAgICAgIHJldHVybiByYWRpb21pY3Nfb2ZfZWFjaF9oYWJpdGF0DQoNCiAgICBkZWYgX2V4dHJhY3RfbXNpX2ZlYXR1cmVzKHNlbGYpOg0KICAgICAgICAiIiJFeHRyYWN0IE1TSSBmZWF0dXJlcyBhbmQgc2F2ZSBhcyBDU1YgZmlsZSIiIg0KICAgICAgICBsb2dnaW5nLmluZm8oIlN0YXJ0aW5nIGV4dHJhY3Rpb24gb2YgTVNJIGZlYXR1cmVzIikNCiAgICAgICAgc3VianMgPSBsaXN0KHNlbGYuZGF0YS5rZXlzKCkpDQogICAgICAgIG1zaV9mZWF0dXJlc19saXN0ID0gW10NCiAgICAgICAgdG90YWwgPSBsZW4oc3VianMpDQogICAgICAgIA0KICAgICAgICBwcm9ncmVzc19iYXIgPSBDdXN0b21UcWRtKHRvdGFsPXRvdGFsLCBkZXNjPSJQcm9jZXNzaW5nIE1TSSBGZWF0dXJlcyIpDQogICAgICAgIGZvciBpLCBzdWJqIGluIGVudW1lcmF0ZShzdWJqcyk6DQogICAgICAgICAgICBwcm9ncmVzc19iYXIudXBkYXRlKDEpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiAnbXNpX2ZlYXR1cmVzJyBpbiBzZWxmLmRhdGEuZ2V0KHN1YmopOg0KICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IHNlbGYuZGF0YS5nZXQoc3ViaikuZ2V0KCdtc2lfZmVhdHVyZXMnKQ0KICAgICAgICAgICAgICAgICAgICBpZiAnZXJyb3InIG5vdCBpbiBmZWF0dXJlczoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzX2RmID0gcGQuRGF0YUZyYW1lLmZyb21fZGljdChmZWF0dXJlcywgb3JpZW50PSdpbmRleCcpLlQNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzX2RmLmluZGV4ID0gW3N1YmpdDQogICAgICAgICAgICAgICAgICAgICAgICBtc2lfZmVhdHVyZXNfbGlzdC5hcHBlbmQoZmVhdHVyZXNfZGYpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgZXh0cmFjdGluZyBNU0kgZmVhdHVyZXMgZm9yIHN1YmplY3Qge3N1Ymp9OiB7ZmVhdHVyZXNbJ2Vycm9yJ119IikNCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ3JlYXRlIGVtcHR5IERhdGFGcmFtZSBpZiB0aGVyZSBhcmUgc3VjY2Vzc2Z1bCBzdWJqZWN0cw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKG1zaV9mZWF0dXJlc19saXN0KSA+IDA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1wdHlfZGYgPSBGZWF0dXJlVXRpbHMuY3JlYXRlX2VtcHR5X2RhdGFmcmFtZV9saWtlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lfZmVhdHVyZXNfbGlzdFswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9W3N1YmpdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zaV9mZWF0dXJlc19saXN0LmFwcGVuZChlbXB0eV9kZikNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiTm8gTVNJIGZlYXR1cmVzIGRhdGEgZm9yIHN1YmplY3Qge3N1Ymp9IikNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgcHJvY2Vzc2luZyBNU0kgZmVhdHVyZXMgZm9yIHN1YmplY3Qge3N1Ymp9OiB7c3RyKGUpfSIpDQogICAgICAgICAgICAgICAgIyBDcmVhdGUgZW1wdHkgRGF0YUZyYW1lIGlmIHRoZXJlIGFyZSBzdWNjZXNzZnVsIHN1YmplY3RzDQogICAgICAgICAgICAgICAgaWYgbGVuKG1zaV9mZWF0dXJlc19saXN0KSA+IDA6DQogICAgICAgICAgICAgICAgICAgIGVtcHR5X2RmID0gRmVhdHVyZVV0aWxzLmNyZWF0ZV9lbXB0eV9kYXRhZnJhbWVfbGlrZSgNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zaV9mZWF0dXJlc19saXN0WzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9W3N1YmpdDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgbXNpX2ZlYXR1cmVzX2xpc3QuYXBwZW5kKGVtcHR5X2RmKQ0KICAgICAgICANCiAgICAgICAgaWYgbGVuKG1zaV9mZWF0dXJlc19saXN0KSA+IDA6DQogICAgICAgICAgICBtc2lfZmVhdHVyZXNfZGYgPSBwZC5jb25jYXQobXNpX2ZlYXR1cmVzX2xpc3QpDQogICAgICAgICAgICBvdXRfZmlsZSA9IG9zLnBhdGguam9pbihzZWxmLm91dF9kaXIsICJtc2lfZmVhdHVyZXMuY3N2IikNCiAgICAgICAgICAgIG1zaV9mZWF0dXJlc19kZi50b19jc3Yob3V0X2ZpbGUsIGluZGV4PVRydWUpDQogICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJNU0kgZmVhdHVyZXMgc2F2ZWQgdG8ge291dF9maWxlfSIpDQogICAgICAgICAgICByZXR1cm4gbXNpX2ZlYXR1cmVzX2RmDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKCJObyB2YWxpZCBNU0kgZmVhdHVyZXMgZGF0YSIpDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIF9leHRyYWN0X2l0aF9mZWF0dXJlcyhzZWxmKToNCiAgICAgICAgIiIiRXh0cmFjdCBJVEggZmVhdHVyZXMgYW5kIHNhdmUgYXMgQ1NWIGZpbGUiIiINCiAgICAgICAgbG9nZ2luZy5pbmZvKCJTdGFydGluZyBleHRyYWN0aW9uIG9mIElUSCBmZWF0dXJlcyIpDQogICAgICAgIHN1YmpzID0gbGlzdChzZWxmLmRhdGEua2V5cygpKQ0KICAgICAgICBpdGhfZmVhdHVyZXNfbGlzdCA9IHt9DQogICAgICAgIHRvdGFsID0gbGVuKHN1YmpzKQ0KICAgICAgICANCiAgICAgICAgcHJvZ3Jlc3NfYmFyID0gQ3VzdG9tVHFkbSh0b3RhbD10b3RhbCwgZGVzYz0iUHJvY2Vzc2luZyBJVEggRmVhdHVyZXMiKQ0KICAgICAgICBmb3IgaSwgc3ViaiBpbiBlbnVtZXJhdGUoc3VianMpOg0KICAgICAgICAgICAgcHJvZ3Jlc3NfYmFyLnVwZGF0ZSgxKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgJ2l0aF9mZWF0dXJlcycgaW4gc2VsZi5kYXRhLmdldChzdWJqKToNCiAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGFsbCBpbWFnZXMNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBzZWxmLmRhdGEuZ2V0KHN1YmopLmdldCgnaXRoX2ZlYXR1cmVzJykNCiAgICAgICAgICAgICAgICAgICAgaXRoX2ZlYXR1cmVzX2xpc3Rbc3Vial0gPSB2YWx1ZQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBwcm9jZXNzaW5nIElUSCBmZWF0dXJlcyBmb3Igc3ViamVjdCB7c3Vian06IHtzdHIoZSl9IikNCiAgICAgICAgDQogICAgICAgIGlmIGxlbihpdGhfZmVhdHVyZXNfbGlzdCkgPiAwOg0KICAgICAgICAgICAgaXRoX2ZlYXR1cmVzX2RmID0gcGQuRGF0YUZyYW1lLmZyb21fZGljdChpdGhfZmVhdHVyZXNfbGlzdCwgb3JpZW50PSdpbmRleCcpDQogICAgICAgICAgICBvdXRfZmlsZSA9IG9zLnBhdGguam9pbihzZWxmLm91dF9kaXIsICJpdGhfc2NvcmVzLmNzdiIpDQogICAgICAgICAgICBpdGhfZmVhdHVyZXNfZGYudG9fY3N2KG91dF9maWxlKQ0KICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiSVRIIGZlYXR1cmVzIHNhdmVkIHRvIHtvdXRfZmlsZX0iKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBpdGhfZmVhdHVyZXNfZGYNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoIk5vIHZhbGlkIElUSCBmZWF0dXJlcyBkYXRhIikNCiAgICAgICAgICAgIHJldHVybiBOb25lDQo=').decode())
