# Habitat Analysis Configuration - One-Step Mode Example
# One-step模式：每个样本独立确定最优聚类数

# Basic paths
data_dir: /path/to/your/data
out_dir: /path/to/output

# General settings
processes: 4
random_state: 42
plot_curves: true  # Enable all visualizations

# Feature Construction Configuration
FeatureConstruction:
  # Voxel-level feature extraction
  voxel_level:
    # Define processing steps for each image
    steps:
      - method: raw_feature  # Extract raw intensity values
        image: T1
        params: {}
      
      - method: raw_feature
        image: T2
        params: {}
    
    # Cross-image feature extraction method
    method: concat_image  # Concatenate features from all images
    params: {}

# Habitat Segmentation Configuration
HabitatsSegmention:
  # Clustering strategy: 'one_step' or 'two_step'
  clustering_strategy: one_step
  
  # Supervoxel clustering configuration
  supervoxel:
    algorithm: kmeans  # Clustering algorithm: kmeans, gmm, hierarchical, etc.
    # Note: n_clusters is not used in one_step mode, as it's determined automatically
  
  # One-step mode specific settings
  one_step_settings:
    # Option 1: Use fixed cluster number (skip optimal search, similar to two_step mode)
    fixed_n_clusters: null  # If specified, use this fixed number for all samples, skip optimization
                            # Set to null for automatic cluster number selection
    
    # Option 2: Automatically find optimal clusters for each sample (default when fixed_n_clusters is null)
    min_clusters: 2           # Minimum number of clusters to test
    max_clusters: 10          # Maximum number of clusters to test
    selection_method: silhouette  # Method to determine optimal clusters
                                 # Options: silhouette, davies_bouldin, calinski_harabasz, inertia
    plot_validation_curves: true  # Whether to plot validation curves for each sample
  
  # Habitat configuration (not used in one_step mode, but kept for compatibility)
  habitat:
    mode: training  # Mode: 'training' or 'testing'

  # Optional connected-component cleanup for final one-step habitat maps
  postprocess_habitat:
    enabled: false
    min_component_size: 30
    connectivity: 1          # 1=6-neighbor, 2=18-neighbor, 3=26-neighbor
    reassign_method: neighbor_vote
    max_iterations: 3

