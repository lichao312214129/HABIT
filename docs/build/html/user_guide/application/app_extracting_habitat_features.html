

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habitat Feature Extraction Module User Guide &mdash; HABIT 1.0.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=2d33a3a8"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../../_static/translations.js?v=beaddf03"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HABIT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HABIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Habitat Feature Extraction Module User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user_guide/application/app_extracting_habitat_features.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="habitat-feature-extraction-module-user-guide">
<h1>Habitat Feature Extraction Module User Guide<a class="headerlink" href="#habitat-feature-extraction-module-user-guide" title="此标题的永久链接"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="此标题的永久链接"></a></h2>
<p>The Habitat Feature Extraction module extracts features from segmented habitat maps. This module supports the extraction of various feature types from medical images, including traditional radiomics features, non-radiomics features, whole habitat features, individual habitat features, multiregional spatial interaction (MSI) features, and the Intratumoral Heterogeneity Index (IHI index).</p>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="此标题的永久链接"></a></h2>
<section id="using-cli-recommended">
<h3>Using CLI (Recommended)<a class="headerlink" href="#using-cli-recommended" title="此标题的永久链接"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use default configuration</span>
habit<span class="w"> </span>extract-features

<span class="c1"># Use specified configuration file</span>
habit<span class="w"> </span>extract-features<span class="w"> </span>--config<span class="w"> </span>config/config_extract_features.yaml

<span class="c1"># Short form</span>
habit<span class="w"> </span>extract-features<span class="w"> </span>-c<span class="w"> </span>config/config_extract_features.yaml
</pre></div>
</div>
</section>
<section id="using-traditional-scripts-legacy-compatible">
<h3>Using Traditional Scripts (Legacy Compatible)<a class="headerlink" href="#using-traditional-scripts-legacy-compatible" title="此标题的永久链接"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>scripts/app_extracting_habitat_features.py<span class="w"> </span>--config<span class="w"> </span>&lt;config_file_path&gt;
</pre></div>
</div>
</section>
</section>
<section id="configuration-file">
<h2>Configuration File<a class="headerlink" href="#configuration-file" title="此标题的永久链接"></a></h2>
<p>Configuration File Links:</p>
<ul class="simple">
<li><p><a class="reference external" href="../config/config_extract_features.yaml">Current Configuration</a> - Concise configuration for actual use</p></li>
<li><p><a class="reference external" href="../config_templates/config_extract_features_annotated.yaml">Annotated Template</a> - Complete English comments and instructions</p></li>
</ul>
</section>
<section id="configuration-file-format">
<h2>Configuration File Format<a class="headerlink" href="#configuration-file-format" title="此标题的永久链接"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">app_extracting_habitat_features.py</span></code> uses a YAML configuration file with the following main sections:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Feature extraction settings</span>
<span class="nt">params_file_of_non_habitat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path_to_radiomics_params_for_original_image&gt;</span>
<span class="nt">params_file_of_habitat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path_to_radiomics_params_for_habitat_map&gt;</span>
<span class="nt">raw_img_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path_to_original_image_directory&gt;</span>
<span class="nt">habitats_map_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path_to_habitat_map_directory&gt;</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;path_to_output_directory&gt;</span>

<span class="c1"># Feature types and processing settings</span>
<span class="nt">feature_types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">&lt;list_of_feature_types&gt;</span><span class="p p-Indicator">]</span>
<span class="nt">n_habitats</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;number_of_habitats, auto-detects_if_null&gt;</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;operation_mode&gt;</span>

<span class="c1"># Program settings</span>
<span class="nt">n_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;number_of_parallel_processes&gt;</span>
<span class="nt">habitat_pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;habitat_file_matching_pattern&gt;</span>
<span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true_or_false_for_debug_mode&gt;</span>
</pre></div>
</div>
</section>
<section id="supported-feature-types">
<h2>Supported Feature Types<a class="headerlink" href="#supported-feature-types" title="此标题的永久链接"></a></h2>
<section id="traditional">
<h3>1. traditional<a class="headerlink" href="#traditional" title="此标题的永久链接"></a></h3>
<p>Traditional radiomics features extracted from the original image, calculated based on the entire tumor region.</p>
<p>Includes the following main feature classes:</p>
<ul class="simple">
<li><p>First Order Statistics</p></li>
<li><p>Shape Features</p></li>
<li><p>Gray Level Co-occurrence Matrix (GLCM)</p></li>
<li><p>Gray Level Run Length Matrix (GLRLM)</p></li>
<li><p>Gray Level Size Zone Matrix (GLSZM)</p></li>
<li><p>Gray Level Dependence Matrix (GLDM)</p></li>
<li><p>Neighboring Gray Tone Difference Matrix (NGTDM)</p></li>
</ul>
</section>
<section id="non-radiomics">
<h3>2. non_radiomics<a class="headerlink" href="#non-radiomics" title="此标题的永久链接"></a></h3>
<p>Non-radiomics features (basic statistics) extracted from the habitat segmentation map, including:</p>
<ul class="simple">
<li><p>Number of habitats (num_habitats)</p></li>
<li><p>Volume ratio of each habitat (label_X.volume_ratio)</p></li>
<li><p>Number of connected regions for each habitat (label_X.num_regions)</p></li>
</ul>
</section>
<section id="whole-habitat">
<h3>3. whole_habitat<a class="headerlink" href="#whole-habitat" title="此标题的永久链接"></a></h3>
<p>Radiomics features extracted from the entire habitat segmentation map, treating the habitat image as a whole. The feature classes are the same as traditional radiomics but are calculated on the habitat map instead of the original image.</p>
</section>
<section id="each-habitat">
<h3>4. each_habitat<a class="headerlink" href="#each-habitat" title="此标题的永久链接"></a></h3>
<p>Radiomics features extracted from each habitat individually. Each habitat will have a complete set of radiomics features, named in the format “label_X_feature_name”.</p>
</section>
<section id="msi-multiregional-spatial-interaction">
<h3>5. msi (Multiregional Spatial Interaction)<a class="headerlink" href="#msi-multiregional-spatial-interaction" title="此标题的永久链接"></a></h3>
<p>Features that describe the spatial relationships between different habitats, including:</p>
<ul class="simple">
<li><p>Number of boundaries between habitats (firstorder_i_and_j)</p></li>
<li><p>Number of adjacency relationships within a habitat (firstorder_i_and_i)</p></li>
<li><p>Normalized spatial interaction features</p></li>
<li><p>Texture features of the MSI matrix (contrast, homogeneity, correlation, energy, etc.)</p></li>
</ul>
</section>
<section id="ith-score-intratumoral-heterogeneity-index">
<h3>6. ith_score (Intratumoral Heterogeneity Index)<a class="headerlink" href="#ith-score-intratumoral-heterogeneity-index" title="此标题的永久链接"></a></h3>
<p>Calculates the Intratumoral Heterogeneity (ITH) Score, ranging from 0 to 1. A higher value indicates greater intratumoral heterogeneity.</p>
</section>
</section>
<section id="execution-flow">
<h2>Execution Flow<a class="headerlink" href="#execution-flow" title="此标题的永久链接"></a></h2>
<ol class="arabic simple">
<li><p>Parse command-line arguments or load the configuration file.</p></li>
<li><p>Validate the configuration parameters.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">HabitatMapAnalyzer</span></code> instance.</p></li>
<li><p>Execute feature extraction based on the specified mode and feature types:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">mode</span></code> is ‘extract’ or ‘both’, extract features from images.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">mode</span></code> is ‘parse’ or ‘both’, parse features and generate summaries.</p></li>
</ul>
</li>
<li><p>Save the extracted features to the output directory.</p></li>
</ol>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="此标题的永久链接"></a></h2>
<p>After execution, the script will generate the following in the specified output directory:</p>
<ol class="arabic simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">features_{timestamp}/</span></code> directory containing:</p>
<ul class="simple">
<li><p>CSV files and tables for different feature types.</p></li>
<li><p>Extracted feature data and statistics.</p></li>
<li><p>If ‘parse’ is included in the <code class="docutils literal notranslate"><span class="pre">mode</span></code>, a feature summary and analysis report will be generated.</p></li>
</ul>
</li>
</ol>
</section>
<section id="detailed-feature-output-description">
<h2>Detailed Feature Output Description<a class="headerlink" href="#detailed-feature-output-description" title="此标题的永久链接"></a></h2>
<p>Below are the features included in the output CSV files for each type:</p>
<section id="traditional-radiomics-features-traditional">
<h3>Traditional Radiomics Features (traditional)<a class="headerlink" href="#traditional-radiomics-features-traditional" title="此标题的永久链接"></a></h3>
<p>(Standard PyRadiomics output)</p>
</section>
<section id="non-radiomics-features-non-radiomics">
<h3>Non-Radiomics Features (non_radiomics)<a class="headerlink" href="#non-radiomics-features-non-radiomics" title="此标题的永久链接"></a></h3>
<ul class="simple">
<li><p><strong>num_habitats</strong>: The total number of habitats.</p></li>
<li><p><strong>label_X.num_regions</strong>: The number of connected regions for the habitat with label X.</p></li>
<li><p><strong>label_X.volume_ratio</strong>: The proportion of the total habitat volume occupied by the habitat with label X.</p></li>
</ul>
</section>
<section id="whole-habitat-features-whole-habitat">
<h3>Whole Habitat Features (whole_habitat)<a class="headerlink" href="#whole-habitat-features-whole-habitat" title="此标题的永久链接"></a></h3>
<p>Radiomics features extracted from the entire habitat segmentation map. The feature classes are the same as traditional radiomics but are based on the habitat image.</p>
</section>
<section id="individual-habitat-features-each-habitat">
<h3>Individual Habitat Features (each_habitat)<a class="headerlink" href="#individual-habitat-features-each-habitat" title="此标题的永久链接"></a></h3>
<p>Radiomics features extracted separately for each habitat region. Each habitat will have a full set of radiomics features, named in the format “label_X_feature_name”.</p>
</section>
<section id="multiregional-spatial-interaction-msi-features">
<h3>Multiregional Spatial Interaction (MSI) Features<a class="headerlink" href="#multiregional-spatial-interaction-msi-features" title="此标题的永久链接"></a></h3>
<ul class="simple">
<li><p><strong>firstorder_i_and_j</strong>: The number of boundaries between habitat <code class="docutils literal notranslate"><span class="pre">i</span></code> and habitat <code class="docutils literal notranslate"><span class="pre">j</span></code>, indicating the strength of their spatial relationship.</p></li>
<li><p><strong>firstorder_i_and_i</strong>: The number of internal adjacency relationships within habitat <code class="docutils literal notranslate"><span class="pre">i</span></code>, indicating its internal connectivity.</p></li>
<li><p><strong>firstorder_normalized_i_and_j</strong>: The normalized spatial relationship between habitat <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></li>
<li><p><strong>firstorder_normalized_i_and_i</strong>: The normalized internal connectivity of habitat <code class="docutils literal notranslate"><span class="pre">i</span></code>, indicating its spatial coherence. A higher value suggests the habitat is more spatially contiguous.</p></li>
<li><p><strong>contrast</strong>: The contrast of the MSI matrix, representing the degree of difference between different habitats.</p></li>
<li><p><strong>homogeneity</strong>: The homogeneity of the MSI matrix, representing the uniformity of the spatial distribution of habitats.</p></li>
<li><p><strong>correlation</strong>: The correlation of the MSI matrix, representing the degree of correlation in the spatial distribution of habitats.</p></li>
<li><p><strong>energy</strong>: The energy of the MSI matrix, representing the regularity and simplicity of the spatial distribution of habitats.</p></li>
</ul>
</section>
<section id="intratumoral-heterogeneity-ith-index-feature">
<h3>Intratumoral Heterogeneity (ITH) Index Feature<a class="headerlink" href="#intratumoral-heterogeneity-ith-index-feature" title="此标题的永久链接"></a></h3>
<ul class="simple">
<li><p><strong>ith_score</strong>: A score from 0 to 1, where a higher value indicates greater intratumoral heterogeneity.</p></li>
</ul>
</section>
</section>
<section id="complete-configuration-example">
<h2>Complete Configuration Example<a class="headerlink" href="#complete-configuration-example" title="此标题的永久链接"></a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Feature extraction settings</span>
<span class="nt">params_file_of_non_habitat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/parameter.yaml</span>
<span class="nt">params_file_of_habitat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/parameter_habitat.yaml</span>
<span class="nt">raw_img_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/processed_images</span>
<span class="nt">habitats_map_folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/habitats_output</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/features_output</span>

<span class="c1"># Feature types and processing settings</span>
<span class="nt">feature_types</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traditional</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">non_radiomics</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">whole_habitat</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">each_habitat</span>
<span class="nt">n_habitats</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">both</span>

<span class="c1"># Program settings</span>
<span class="nt">n_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">habitat_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*_habitats.nrrd&#39;</span>
<span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</section>
<section id="feature-extraction-workflow">
<h2>Feature Extraction Workflow<a class="headerlink" href="#feature-extraction-workflow" title="此标题的永久链接"></a></h2>
<ol class="arabic simple">
<li><p><strong>Image Preparation</strong>:</p>
<ul class="simple">
<li><p>Read original medical images and habitat segmentation maps.</p></li>
<li><p>Perform necessary preprocessing and normalization.</p></li>
</ul>
</li>
<li><p><strong>Feature Calculation</strong>:</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">traditional</span></code> features: Use PyRadiomics to extract radiomics features from the original image.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">non_radiomics</span></code> features: Calculate statistical properties of the habitat segmentation map.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">whole_habitat</span></code> features: Use the entire habitat map as input for feature extraction.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">each_habitat</span></code> features: Extract features for each habitat individually.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">msi</span></code> features: Extract features at multiple spatial scales.</p></li>
</ul>
</li>
<li><p><strong>Feature Integration</strong>:</p>
<ul class="simple">
<li><p>Combine all extracted features.</p></li>
<li><p>Create a feature matrix and labels.</p></li>
</ul>
</li>
<li><p><strong>Feature Analysis</strong> (if <code class="docutils literal notranslate"><span class="pre">mode</span></code> includes ‘parse’):</p>
<ul class="simple">
<li><p>Calculate feature statistics.</p></li>
<li><p>Generate feature summaries.</p></li>
<li><p>Visualize important features.</p></li>
</ul>
</li>
</ol>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="此标题的永久链接"></a></h2>
<ol class="arabic simple">
<li><p>Ensure the directory structure for original images and habitat maps is correct, and that habitat map filenames match the original images.</p></li>
<li><p>The PyRadiomics parameter file should be configured appropriately for your image characteristics.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, HABIT Team。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>