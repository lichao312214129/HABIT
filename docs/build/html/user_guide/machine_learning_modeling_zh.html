

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>机器学习建模 &mdash; HABIT 1.0.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=2d33a3a8"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="HABIT 包的设计哲学和理念" href="../design_philosophy_zh.html" />
    <link rel="prev" title="生境特征提取" href="habitat_feature_extraction_zh.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HABIT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">开始使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index_zh.html">快速开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_structure_zh.html">数据结构说明</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index_zh.html">用户指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="roi_preparation_zh.html">ROI 文件准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_preprocessing_zh.html">图像预处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="habitat_segmentation_zh.html">生境分割</a></li>
<li class="toctree-l2"><a class="reference internal" href="habitat_feature_extraction_zh.html">生境特征提取</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">机器学习建模</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cli">CLI 使用方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-api">Python API 使用方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yaml">YAML 配置详解</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">特征选择方法详解</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">模型类型详解</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline">Pipeline 机制</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">实际示例</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">输出结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">常见问题</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">下一步</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_zh.html#id2">工作流程概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_zh.html#id3">自定义扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_zh.html#id4">配置文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_zh.html#id5">数据结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_zh.html#id6">下一步</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roi_preparation_zh.html">ROI 文件准备</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_preprocessing_zh.html">图像预处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="habitat_segmentation_zh.html">生境分割</a></li>
<li class="toctree-l1"><a class="reference internal" href="habitat_feature_extraction_zh.html">生境特征提取</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">机器学习建模</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cli">CLI 使用方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-api">Python API 使用方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#yaml">YAML 配置详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">特征选择方法详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">模型类型详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline">Pipeline 机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">实际示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">输出结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">常见问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">下一步</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">设计哲学</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design_philosophy_zh.html">HABIT 包的设计哲学和理念</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">自定义扩展</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../customization/index_zh.html">自定义扩展指南</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">配置参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration_zh.html">配置参考</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">命令行工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli_zh.html">CLI 参考文档</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API 参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API 文档</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HABIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index_zh.html">用户指南</a></li>
      <li class="breadcrumb-item active">机器学习建模</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/machine_learning_modeling_zh.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>机器学习建模<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<p>本节介绍如何使用 HABIT 进行机器学习建模，包括特征选择、模型训练和模型评估。</p>
<section id="id2">
<h2>概述<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>机器学习建模是生境分析的最终步骤，使用提取的生境特征进行预测模型训练和评估。</p>
<p>HABIT 提供了完整的机器学习工作流程：</p>
<ul class="simple">
<li><p><strong>特征选择</strong>: 选择最相关的特征</p></li>
<li><p><strong>模型训练</strong>: 训练各种机器学习模型</p></li>
<li><p><strong>模型评估</strong>: 评估模型性能</p></li>
<li><p><strong>模型保存</strong>: 保存训练好的模型</p></li>
<li><p><strong>模型预测</strong>: 使用训练好的模型进行预测</p></li>
</ul>
<p><strong>支持的模型类型：</strong></p>
<ul class="simple">
<li><p><strong>传统机器学习模型</strong>: 逻辑回归、随机森林、SVM、KNN 等</p></li>
<li><p><strong>集成学习模型</strong>: XGBoost、LightGBM、AutoGluon 等</p></li>
<li><p><strong>深度学习模型</strong>: 神经网络（可选）</p></li>
</ul>
<p><strong>Pipeline 机制：</strong></p>
<p>HABIT 使用 scikit-learn 的 Pipeline 机制，确保特征选择、模型训练等步骤在交叉验证中正确应用，避免数据泄露。</p>
</section>
<section id="cli">
<h2>CLI 使用方法<a class="headerlink" href="#cli" title="此标题的永久链接"></a></h2>
<p><strong>基本语法：</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>habit<span class="w"> </span>model<span class="w"> </span>--config<span class="w"> </span>&lt;config_file&gt;<span class="w"> </span><span class="o">[</span>--mode<span class="w"> </span>&lt;mode&gt;<span class="o">]</span>
</pre></div>
</div>
<p><strong>参数说明：</strong></p>
<ul class="simple">
<li><p><cite>–config</cite>, <cite>-c</cite>: 配置文件路径（必需）</p></li>
<li><p><cite>–mode</cite>, <cite>-m</cite>: 运行模式（train 或 predict），覆盖配置文件中的设置</p></li>
</ul>
<p><strong>使用示例：</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 训练模式</span>
habit<span class="w"> </span>model<span class="w"> </span>--config<span class="w"> </span>./demo_data/config_machine_learning.yaml<span class="w"> </span>--mode<span class="w"> </span>train

<span class="c1"># 预测模式</span>
habit<span class="w"> </span>model<span class="w"> </span>--config<span class="w"> </span>./demo_data/config_machine_learning.yaml<span class="w"> </span>--mode<span class="w"> </span>predict
</pre></div>
</div>
<p><strong>输出：</strong></p>
<p>训练好的模型和评估结果将保存在配置文件中指定的输出目录。</p>
</section>
<section id="python-api">
<h2>Python API 使用方法<a class="headerlink" href="#python-api" title="此标题的永久链接"></a></h2>
<p><strong>基本用法：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">habit.core.machine_learning</span> <span class="kn">import</span> <span class="n">MachineLearningWorkflow</span>
<span class="kn">from</span> <span class="nn">habit.core.machine_learning.config_schemas</span> <span class="kn">import</span> <span class="n">MLConfig</span>

<span class="c1"># 加载配置</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">MLConfig</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;./config_machine_learning.yaml&#39;</span><span class="p">)</span>

<span class="c1"># 创建机器学习工作流</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">MachineLearningWorkflow</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># 运行工作流</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run_pipeline</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>详细示例：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">habit.core.machine_learning</span> <span class="kn">import</span> <span class="n">MachineLearningWorkflow</span>
<span class="kn">from</span> <span class="nn">habit.core.machine_learning.config_schemas</span> <span class="kn">import</span> <span class="n">MLConfig</span>
<span class="kn">from</span> <span class="nn">habit.utils.log_utils</span> <span class="kn">import</span> <span class="n">setup_logger</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># 设置日志</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./results/ml&#39;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;machine_learning&#39;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;machine_learning.log&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
<span class="p">)</span>

<span class="c1"># 加载配置</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">MLConfig</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;./config_machine_learning.yaml&#39;</span><span class="p">)</span>

<span class="c1"># 创建机器学习工作流</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">MachineLearningWorkflow</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

<span class="c1"># 运行工作流</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;开始训练模式&quot;</span><span class="p">)</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run_pipeline</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;模型训练完成！&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="yaml">
<h2>YAML 配置详解<a class="headerlink" href="#yaml" title="此标题的永久链接"></a></h2>
<p><strong>配置文件结构：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 运行模式和 Pipeline 设置（首先检查这些！）</span>
<span class="nt">run_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span><span class="w">  </span><span class="c1"># train（如果要训练新模型，设置为 train）或 predict（如果要使用预训练模型，设置为 predict）</span>
<span class="nt">pipeline_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/model_pipeline.pkl</span><span class="w">  </span><span class="c1"># predict 模式的 Pipeline 路径（predict 模式必需）</span>

<span class="c1"># 数据路径</span>
<span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./files_ml.yaml</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/train</span>

<span class="c1"># 特征选择设置</span>
<span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># 是否启用特征选择</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">variance</span><span class="w">  </span><span class="c1"># 特征选择方法：variance、correlation、anova、chi2、lasso、rfecv</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># variance 方法参数</span>
<span class="w">    </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="w">    </span><span class="c1"># correlation 方法参数</span>
<span class="w">    </span><span class="nt">threshold_correlation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.95</span>

<span class="w">    </span><span class="c1"># anova 方法参数</span>
<span class="w">    </span><span class="nt">k_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="w">    </span><span class="c1"># chi2 方法参数</span>
<span class="w">    </span><span class="nt">k_features_chi2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="w">    </span><span class="c1"># lasso 方法参数</span>
<span class="w">    </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="w">    </span><span class="c1"># rfecv 方法参数</span>
<span class="w">    </span><span class="nt">estimator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span>
<span class="w">    </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">scoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>

<span class="c1"># 模型训练设置</span>
<span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># 是否启用模型训练</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span><span class="w">  </span><span class="c1"># 模型类型：LogisticRegression、RandomForest、XGBoost、SVM、KNN、AutoGluon</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># RandomForest 参数</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">min_samples_split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">min_samples_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="w">    </span><span class="c1"># LogisticRegression 参数</span>
<span class="w">    </span><span class="nt">C</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">penalty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2</span>
<span class="w">    </span><span class="nt">solver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lbfgs</span>
<span class="w">    </span><span class="nt">max_iter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="w">    </span><span class="c1"># XGBoost 参数</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">    </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="w">    </span><span class="c1"># SVM 参数</span>
<span class="w">    </span><span class="nt">C</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">kernel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbf</span>
<span class="w">    </span><span class="nt">gamma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="w">    </span><span class="c1"># KNN 参数</span>
<span class="w">    </span><span class="nt">n_neighbors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">weights</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uniform</span>
<span class="w">    </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>

<span class="w">    </span><span class="c1"># AutoGluon 参数</span>
<span class="w">    </span><span class="nt">time_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>
<span class="w">    </span><span class="nt">presets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">best_quality</span>

<span class="c1"># 模型评估设置</span>
<span class="nt">ModelEvaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># 是否启用模型评估</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">precision</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recall</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">roc_auc</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">confusion_matrix</span>
<span class="w">  </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">  </span><span class="c1"># 交叉验证折数</span>
<span class="w">  </span><span class="nt">test_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">  </span><span class="c1"># 测试集比例</span>
<span class="w">  </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="c1"># 模型保存设置</span>
<span class="nt">ModelSaving</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># 是否启用模型保存</span>
<span class="w">  </span><span class="nt">save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/model_pipeline.pkl</span><span class="w">  </span><span class="c1"># 模型保存路径</span>
<span class="w">  </span><span class="nt">save_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkl</span><span class="w">  </span><span class="c1"># 保存格式：pkl、joblib</span>

<span class="c1"># 通用设置</span>
<span class="nt">processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">  </span><span class="c1"># 并行进程数</span>
<span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span><span class="w">  </span><span class="c1"># 可重复性的随机种子</span>
<span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># 启用详细日志的调试模式</span>
</pre></div>
</div>
<p><strong>字段说明：</strong></p>
<p><strong>run_mode</strong>: 运行模式</p>
<ul class="simple">
<li><p><cite>train</cite>: 训练新模型</p></li>
<li><p><cite>predict</cite>: 使用预训练模型进行预测</p></li>
</ul>
<p><strong>pipeline_path</strong>: Pipeline 文件路径</p>
<ul class="simple">
<li><p>predict 模式必需</p></li>
<li><p>指定训练好的 Pipeline 文件路径</p></li>
</ul>
<p><strong>data_dir</strong>: 数据目录路径</p>
<ul class="simple">
<li><p>可以是文件夹或 YAML 配置文件</p></li>
<li><p>参考 <a class="reference internal" href="../data_structure_zh.html"><span class="doc">数据结构说明</span></a> 了解数据结构</p></li>
</ul>
<p><strong>out_dir</strong>: 输出目录路径</p>
<ul class="simple">
<li><p>模型、评估结果和预测结果将保存在此目录</p></li>
</ul>
<p><strong>FeatureSelection</strong>: 特征选择设置</p>
<ul class="simple">
<li><p><cite>enabled</cite>: 是否启用特征选择</p></li>
<li><p><cite>method</cite>: 特征选择方法</p></li>
<li><p><cite>params</cite>: 特征选择方法的参数</p></li>
</ul>
<p><strong>ModelTraining</strong>: 模型训练设置</p>
<ul class="simple">
<li><p><cite>enabled</cite>: 是否启用模型训练</p></li>
<li><p><cite>model_type</cite>: 模型类型</p></li>
<li><p><cite>params</cite>: 模型参数</p></li>
</ul>
<p><strong>ModelEvaluation</strong>: 模型评估设置</p>
<ul class="simple">
<li><p><cite>enabled</cite>: 是否启用模型评估</p></li>
<li><p><cite>metrics</cite>: 评估指标列表</p></li>
<li><p><cite>cv</cite>: 交叉验证折数</p></li>
<li><p><cite>test_size</cite>: 测试集比例</p></li>
</ul>
<p><strong>ModelSaving</strong>: 模型保存设置</p>
<ul class="simple">
<li><p><cite>enabled</cite>: 是否启用模型保存</p></li>
<li><p><cite>save_path</cite>: 模型保存路径</p></li>
<li><p><cite>save_format</cite>: 保存格式</p></li>
</ul>
</section>
<section id="id3">
<h2>特征选择方法详解<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h2>
<p><strong>Variance (variance)</strong></p>
<p>基于方差的特征选择，移除方差低于阈值的特征。</p>
<p><strong>适用场景：</strong>
- 移除低方差特征
- 减少特征数量</p>
<p><strong>参数说明：</strong>
- <cite>threshold</cite>: 方差阈值，低于此阈值的特征将被移除</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">variance</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
</pre></div>
</div>
<p><strong>Correlation (correlation)</strong></p>
<p>基于相关性的特征选择，移除高度相关的特征。</p>
<p><strong>适用场景：</strong>
- 移除冗余特征
- 减少特征数量</p>
<p><strong>参数说明：</strong>
- <cite>threshold_correlation</cite>: 相关性阈值，高于此阈值的特征对中一个将被移除</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">correlation</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">threshold_correlation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.95</span>
</pre></div>
</div>
<p><strong>ANOVA (anova)</strong></p>
<p>基于 ANOVA F 值的特征选择，选择与目标变量最相关的特征。</p>
<p><strong>适用场景：</strong>
- 分类任务
- 选择与目标变量最相关的特征</p>
<p><strong>参数说明：</strong>
- <cite>k_features</cite>: 要选择的特征数量</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anova</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">k_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
<p><strong>Chi2 (chi2)</strong></p>
<p>基于卡方检验的特征选择，选择与目标变量最相关的特征。</p>
<p><strong>适用场景：</strong>
- 分类任务
- 非负特征</p>
<p><strong>参数说明：</strong>
- <cite>k_features_chi2</cite>: 要选择的特征数量</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chi2</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">k_features_chi2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
<p><strong>LASSO (lasso)</strong></p>
<p>基于 LASSO 回归的特征选择，使用 L1 正则化进行特征选择。</p>
<p><strong>适用场景：</strong>
- 线性模型
- 自动特征选择</p>
<p><strong>参数说明：</strong>
- <cite>alpha</cite>: L1 正则化强度</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lasso</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
</pre></div>
</div>
<p><strong>RFECV (rfecv)</strong></p>
<p>递归特征消除与交叉验证，通过递归地移除特征并评估模型性能来选择最佳特征子集。</p>
<p><strong>适用场景：</strong>
- 需要精确的特征选择
- 计算资源充足</p>
<p><strong>参数说明：</strong>
- <cite>estimator</cite>: 估计器类型
- <cite>cv</cite>: 交叉验证折数
- <cite>scoring</cite>: 评分指标</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rfecv</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">estimator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span>
<span class="w">    </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">scoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>模型类型详解<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h2>
<p><strong>LogisticRegression</strong></p>
<p>逻辑回归，适用于二分类和多分类任务。</p>
<p><strong>适用场景：</strong>
- 二分类任务
- 需要概率输出
- 解释性要求高</p>
<p><strong>优点：</strong>
- 简单快速
- 可解释性强
- 提供概率输出</p>
<p><strong>缺点：</strong>
- 假设线性关系
- 对异常值敏感</p>
<p><strong>参数说明：</strong>
- <cite>C</cite>: 正则化强度的倒数
- <cite>penalty</cite>: 正则化类型（l1、l2、elasticnet）
- <cite>solver</cite>: 优化算法
- <cite>max_iter</cite>: 最大迭代次数</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LogisticRegression</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">C</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">penalty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2</span>
<span class="w">    </span><span class="nt">solver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lbfgs</span>
<span class="w">    </span><span class="nt">max_iter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>RandomForest</strong></p>
<p>随机森林，适用于分类和回归任务。</p>
<p><strong>适用场景：</strong>
- 分类和回归任务
- 高维数据
- 非线性关系</p>
<p><strong>优点：</strong>
- 性能强大
- 不易过拟合
- 提供特征重要性</p>
<p><strong>缺点：</strong>
- 计算复杂度高
- 内存消耗大</p>
<p><strong>参数说明：</strong>
- <cite>n_estimators</cite>: 树的数量
- <cite>max_depth</cite>: 树的最大深度
- <cite>min_samples_split</cite>: 分裂节点所需的最小样本数
- <cite>min_samples_leaf</cite>: 叶节点所需的最小样本数</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">min_samples_split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">min_samples_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>XGBoost</strong></p>
<p>梯度提升决策树，适用于分类和回归任务。</p>
<p><strong>适用场景：</strong>
- 分类和回归任务
- 大规模数据
- 高性能要求</p>
<p><strong>优点：</strong>
- 性能强大
- 计算效率高
- 支持并行计算</p>
<p><strong>缺点：</strong>
- 参数较多
- 需要调优</p>
<p><strong>参数说明：</strong>
- <cite>n_estimators</cite>: 树的数量
- <cite>max_depth</cite>: 树的最大深度
- <cite>learning_rate</cite>: 学习率</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">XGBoost</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">    </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>SVM</strong></p>
<p>支持向量机，适用于分类和回归任务。</p>
<p><strong>适用场景：</strong>
- 二分类任务
- 高维数据
- 小样本数据</p>
<p><strong>优点：</strong>
- 理论基础扎实
- 泛化能力强
- 适合高维数据</p>
<p><strong>缺点：</strong>
- 对大规模数据效率低
- 对参数敏感</p>
<p><strong>参数说明：</strong>
- <cite>C</cite>: 正则化参数
- <cite>kernel</cite>: 核函数类型（linear、poly、rbf、sigmoid）
- <cite>gamma</cite>: 核函数系数</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVM</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">C</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">kernel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbf</span>
<span class="w">    </span><span class="nt">gamma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>KNN</strong></p>
<p>K 近邻，适用于分类和回归任务。</p>
<p><strong>适用场景：</strong>
- 分类和回归任务
- 简单快速
- 非线性关系</p>
<p><strong>优点：</strong>
- 简单易用
- 无训练过程
- 适合非线性关系</p>
<p><strong>缺点：</strong>
- 预测速度慢
- 对异常值敏感
- 需要存储所有训练数据</p>
<p><strong>参数说明：</strong>
- <cite>n_neighbors</cite>: 近邻数量
- <cite>weights</cite>: 权重计算方式（uniform、distance）
- <cite>algorithm</cite>: 算法类型（auto、ball_tree、kd_tree、brute）</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KNN</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">n_neighbors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">weights</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uniform</span>
<span class="w">    </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</pre></div>
</div>
<p><strong>AutoGluon</strong></p>
<p>AutoML 框架，自动选择和优化模型。</p>
<p><strong>适用场景：</strong>
- 快速原型
- 不需要调参
- 多模型比较</p>
<p><strong>优点：</strong>
- 自动化程度高
- 性能优秀
- 易于使用</p>
<p><strong>缺点：</strong>
- 计算资源消耗大
- 黑盒模型</p>
<p><strong>参数说明：</strong>
- <cite>time_limit</cite>: 训练时间限制（秒）
- <cite>presets</cite>: 预设模式（best_quality、high_quality、good_quality、medium_quality）</p>
<p><strong>配置示例：</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AutoGluon</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">time_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>
<span class="w">    </span><span class="nt">presets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">best_quality</span>
</pre></div>
</div>
</section>
<section id="pipeline">
<h2>Pipeline 机制<a class="headerlink" href="#pipeline" title="此标题的永久链接"></a></h2>
<p>HABIT 使用 scikit-learn 的 Pipeline 机制，这是避免数据泄露的关键设计。</p>
<p><strong>什么是数据泄露？</strong></p>
<p>数据泄露是指在模型训练过程中，测试集的信息意外地泄露到训练集中，导致模型性能被高估。</p>
<p><strong>Pipeline 如何避免数据泄露？</strong></p>
<ol class="arabic simple">
<li><p><strong>特征选择</strong>: 在交叉验证的每个 fold 内进行特征选择</p></li>
<li><p><strong>模型训练</strong>: 在交叉验证的每个 fold 内进行模型训练</p></li>
<li><p><strong>严格分离</strong>: 训练集和测试集完全分离，避免测试集信息泄露</p></li>
</ol>
<p><strong>机器学习中的 Pipeline:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">habit.core.machine_learning</span> <span class="kn">import</span> <span class="n">ModelFactory</span>

<span class="c1"># 创建 Pipeline，包含特征选择和模型训练</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;feature_selection&#39;</span><span class="p">,</span> <span class="n">feature_selector</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="s1">&#39;RandomForest&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># 训练阶段</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># 测试阶段：使用训练好的 Pipeline 进行预测</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>关键要点：</strong></p>
<ul class="simple">
<li><p>特征选择和模型训练必须在同一个 Pipeline 中</p></li>
<li><p>不要在整个数据集上进行特征选择</p></li>
<li><p>使用交叉验证时，每个 fold 的训练和预测必须严格分离</p></li>
</ul>
</section>
<section id="id5">
<h2>实际示例<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h2>
<p><strong>示例 1: 基本机器学习工作流</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">run_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./files_ml.yaml</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/train</span>

<span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">variance</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="nt">ModelEvaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">precision</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recall</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f1</span>
<span class="w">  </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">test_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">  </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="nt">ModelSaving</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/model_pipeline.pkl</span>
<span class="w">  </span><span class="nt">save_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkl</span>

<span class="nt">processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>示例 2: 完整机器学习工作流</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">run_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span>
<span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./files_ml.yaml</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/train</span>

<span class="nt">FeatureSelection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rfecv</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">estimator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RandomForest</span>
<span class="w">    </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">scoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>

<span class="nt">ModelTraining</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">XGBoost</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">    </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="nt">ModelEvaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accuracy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">precision</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">recall</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">f1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">roc_auc</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">confusion_matrix</span>
<span class="w">  </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">test_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">  </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>

<span class="nt">ModelSaving</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/model_pipeline.pkl</span>
<span class="w">  </span><span class="nt">save_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkl</span>

<span class="nt">processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p><strong>示例 3: 预测模式</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">run_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">predict</span>
<span class="nt">pipeline_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/train/model_pipeline.pkl</span>
<span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./files_ml.yaml</span>
<span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./results/ml/predict</span>

<span class="nt">processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>输出结构<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h2>
<p>机器学习的输出结构：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>results/ml/
├── train/                    # 训练模式输出
│   ├── model_pipeline.pkl    # 训练好的 Pipeline
│   ├── model/                # 模型文件
│   │   └── ...
│   ├── evaluation/           # 评估结果
│   │   ├── metrics.csv
│   │   ├── confusion_matrix.png
│   │   ├── roc_curve.png
│   │   └── ...
│   ├── feature_importance/   # 特征重要性
│   │   └── ...
│   ├── predictions/          # 预测结果
│   │   └── ...
│   └── machine_learning.log  # 日志文件
└── predict/                  # 预测模式输出
    ├── predictions/
    │   └── predictions.csv
    └── machine_learning.log
</pre></div>
</div>
</section>
<section id="id7">
<h2>常见问题<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h2>
<p><strong>Q1: 如何选择特征选择方法？</strong></p>
<p>A: 根据您的数据特点选择：
- <strong>快速原型</strong>: 使用 variance 或 correlation
- <strong>分类任务</strong>: 使用 anova 或 chi2
- <strong>线性模型</strong>: 使用 lasso
- <strong>精确选择</strong>: 使用 rfecv</p>
<p><strong>Q2: 如何选择模型类型？</strong></p>
<p>A: 根据您的任务和数据特点选择：
- <strong>二分类</strong>: LogisticRegression、SVM
- <strong>高维数据</strong>: RandomForest、XGBoost
- <strong>快速原型</strong>: KNN
- <strong>自动调优</strong>: AutoGluon</p>
<p><strong>Q3: 如何避免数据泄露？</strong></p>
<p>A: 遵循以下原则：
1. 特征选择和模型训练必须在同一个 Pipeline 中
2. 不要在整个数据集上进行特征选择
3. 使用交叉验证时，每个 fold 的训练和预测必须严格分离</p>
<p><strong>Q4: 模型训练失败怎么办？</strong></p>
<p>A: 检查以下几点：
1. 配置文件是否正确
2. 数据路径是否正确
3. 特征文件是否存在
4. 标签文件是否存在
5. 查看日志文件了解详细错误信息</p>
<p><strong>Q5: 如何提高模型性能？</strong></p>
<p>A: 可以尝试以下方法：
1. 尝试不同的特征选择方法
2. 尝试不同的模型类型
3. 调整模型参数
4. 增加训练数据
5. 特征工程</p>
</section>
<section id="id8">
<h2>下一步<a class="headerlink" href="#id8" title="此标题的永久链接"></a></h2>
<p>机器学习建模完成后，您可以：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../customization/index_zh.html"><span class="doc">自定义扩展指南</span></a>: 了解如何自定义模型和特征选择器</p></li>
<li><p><a class="reference internal" href="../configuration_zh.html"><span class="doc">配置参考</span></a>: 了解配置文件的详细说明</p></li>
<li><p><a class="reference internal" href="../design_philosophy_zh.html"><span class="doc">HABIT 包的设计哲学和理念</span></a>: 了解 HABIT 的设计哲学</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="habitat_feature_extraction_zh.html" class="btn btn-neutral float-left" title="生境特征提取" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../design_philosophy_zh.html" class="btn btn-neutral float-right" title="HABIT 包的设计哲学和理念" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, HABIT Team。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>