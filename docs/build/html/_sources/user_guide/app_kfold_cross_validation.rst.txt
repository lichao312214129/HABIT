K-Foldäº¤å‰éªŒè¯ä½¿ç”¨æŒ‡å—
======================

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨HABITè½¯ä»¶åŒ…ä¸­çš„K-Foldäº¤å‰éªŒè¯åŠŸèƒ½è¿›è¡Œæ¨¡å‹è¯„ä¼°å’Œè®­ç»ƒã€‚

æ¦‚è¿°
----

K-Foldäº¤å‰éªŒè¯æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡å‹è¯„ä¼°æ–¹æ³•ï¼Œå®ƒå°†æ•°æ®é›†åˆ†æˆKä¸ªå­é›†ï¼ˆfoldï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­K-1ä¸ªå­é›†è¿›è¡Œè®­ç»ƒï¼Œå‰©ä½™1ä¸ªå­é›†è¿›è¡ŒéªŒè¯ï¼Œè¿™æ ·é‡å¤Kæ¬¡ï¼Œæ¯ä¸ªå­é›†éƒ½ä¼šè¢«ç”¨ä½œéªŒè¯é›†ä¸€æ¬¡ã€‚

ğŸš€ å¿«é€Ÿå¼€å§‹
-----------

ä½¿ç”¨CLIï¼ˆæ¨èï¼‰âœ¨
~~~~~~~~~~~~~~~~~

.. code:: bash

   # ä½¿ç”¨é»˜è®¤é…ç½®
   habit kfold

   # ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶
   habit kfold --config config/config_machine_learning_kfold.yaml

   # ç®€å†™å½¢å¼
   habit kfold -c config/config_machine_learning_kfold.yaml

ä½¿ç”¨ä¼ ç»Ÿè„šæœ¬ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
~~~~~~~~~~~~~~~~~~~~~~~~

.. code:: bash

   python scripts/app_kfold_cv.py --config config/config_machine_learning_kfold.yaml

K-Foldäº¤å‰éªŒè¯çš„ä¼˜åŠ¿
~~~~~~~~~~~~~~~~~~~~

1. **æ›´å¯é çš„æ€§èƒ½è¯„ä¼°**:
   ç›¸æ¯”å•æ¬¡è®­ç»ƒ-æµ‹è¯•åˆ’åˆ†ï¼ŒK-Foldäº¤å‰éªŒè¯èƒ½æä¾›æ›´ç¨³å®šå’Œå¯é çš„æ€§èƒ½ä¼°è®¡
2. **å……åˆ†åˆ©ç”¨æ•°æ®**: æ¯ä¸ªæ ·æœ¬éƒ½ä¼šè¢«ç”¨äºè®­ç»ƒå’ŒéªŒè¯ï¼Œç‰¹åˆ«é€‚åˆå°æ ·æœ¬æ•°æ®é›†
3. **å‡å°‘å¶ç„¶æ€§**: é€šè¿‡å¤šæ¬¡éªŒè¯å‡å°‘å•æ¬¡åˆ’åˆ†çš„å¶ç„¶æ€§å½±å“
4. **è¯„ä¼°æ¨¡å‹ç¨³å®šæ€§**: å¯ä»¥é€šè¿‡æ ‡å‡†å·®è¯„ä¼°æ¨¡å‹åœ¨ä¸åŒæ•°æ®å­é›†ä¸Šçš„ç¨³å®šæ€§

ä¸æ ‡å‡†å»ºæ¨¡æµç¨‹çš„åŒºåˆ«
~~~~~~~~~~~~~~~~~~~~

======== ========================= ====================================
ç‰¹æ€§     æ ‡å‡†å»ºæ¨¡æµç¨‹              K-Foldäº¤å‰éªŒè¯
======== ========================= ====================================
æ•°æ®åˆ’åˆ† ä¸€æ¬¡åˆ’åˆ†ï¼ˆè®­ç»ƒé›†+æµ‹è¯•é›†ï¼‰ Kæ¬¡åˆ’åˆ†
è®­ç»ƒæ¬¡æ•° æ¯ä¸ªæ¨¡å‹è®­ç»ƒ1æ¬¡           æ¯ä¸ªæ¨¡å‹è®­ç»ƒKæ¬¡
è¯„ä¼°æŒ‡æ ‡ å•ä¸ªæµ‹è¯•é›†ç»“æœ            Kä¸ªéªŒè¯é›†ç»“æœçš„å¹³å‡å€¼Â±æ ‡å‡†å·®
ç‰¹å¾é€‰æ‹© åœ¨æ•´ä¸ªè®­ç»ƒé›†ä¸Šè¿›è¡Œ        åœ¨æ¯ä¸ªfoldå†…ç‹¬ç«‹è¿›è¡Œï¼ˆé¿å…æ•°æ®æ³„éœ²ï¼‰
é€‚ç”¨åœºæ™¯ æ•°æ®é‡å¤§ã€éœ€è¦å¿«é€ŸåŸå‹    æ•°æ®é‡å°ã€éœ€è¦å¯é è¯„ä¼°
è®¡ç®—æ—¶é—´ å¿«                        æ…¢ï¼ˆKå€ï¼‰
======== ========================= ====================================

ğŸ“‹ é…ç½®æ–‡ä»¶
-----------

**ğŸ“– é…ç½®æ–‡ä»¶é“¾æ¥**\ ï¼š - ğŸ“„
`å½“å‰é…ç½®æ–‡ä»¶ <../config/config_machine_learning_kfold.yaml>`__ -
å®é™…ä½¿ç”¨çš„ç²¾ç®€é…ç½® - ğŸ“–
`è¯¦ç»†æ³¨é‡Šæ¨¡æ¿ <../config_templates/config_machine_learning_kfold_annotated.yaml>`__
- å®Œæ•´è‹±æ–‡æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜

K-Foldäº¤å‰éªŒè¯ä½¿ç”¨ä¸“é—¨çš„é…ç½®æ–‡ä»¶
``config_machine_learning_kfold.yaml``\ ã€‚

é…ç½®æ–‡ä»¶ç¤ºä¾‹
~~~~~~~~~~~~

.. code:: yaml

   # Data Input Configuration
   input:
     - path: ./ml_data/breast_cancer_dataset.csv
       name: clinical_
       subject_id_col: subjID
       label_col: label
       features:

   # Output Directory Configuration
   output: ./ml_data/kfold_results

   # K-Fold Cross-Validation Configuration
   n_splits: 5          # Number of folds (commonly 5 or 10)
   stratified: true     # Whether to use stratified k-fold (recommended for imbalanced data)
   random_state: 42     # Random seed for reproducibility

   # Normalization Configuration
   normalization:
     method: z_score    # Normalization method

   # Feature Selection Configuration
   # Note: Feature selection is performed within each fold to avoid data leakage
   feature_selection_methods:
     - method: correlation
       params:
         threshold: 0.80
         method: spearman
         visualize: false
         before_z_score: false

   # Model Configuration
   models:
     LogisticRegression:
       params:
         random_state: 42
         max_iter: 1000
         C: 1.0
     
     RandomForest:
       params:
         random_state: 42
         n_estimators: 100
     
     XGBoost:
       params:
         random_state: 42
         n_estimators: 100
         max_depth: 3

   # Visualization and Saving Configuration
   is_visualize: false
   is_save_model: false

é‡è¦å‚æ•°è¯´æ˜
~~~~~~~~~~~~

n_splits
^^^^^^^^

-  **æè¿°**: K-Foldä¸­çš„foldæ•°é‡
-  **å¸¸ç”¨å€¼**: 5æˆ–10
-  **é€‰æ‹©å»ºè®®**:

   -  æ•°æ®é‡å°ï¼ˆ<100æ ·æœ¬ï¼‰: ä½¿ç”¨10-foldæˆ–æ›´å¤š
   -  æ•°æ®é‡ä¸­ç­‰ï¼ˆ100-1000æ ·æœ¬ï¼‰: ä½¿ç”¨5-foldæˆ–10-fold
   -  æ•°æ®é‡å¤§ï¼ˆ>1000æ ·æœ¬ï¼‰: ä½¿ç”¨5-fold
   -  æå°æ ·æœ¬: è€ƒè™‘Leave-One-Out CVï¼ˆn_splits = æ ·æœ¬æ•°ï¼‰

stratified
^^^^^^^^^^

-  **æè¿°**: æ˜¯å¦ä½¿ç”¨åˆ†å±‚K-Fold
-  **é»˜è®¤å€¼**: true
-  **å»ºè®®**:

   -  ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼šå¿…é¡»ä½¿ç”¨true
   -  ç±»åˆ«å¹³è¡¡é—®é¢˜ï¼šå»ºè®®ä½¿ç”¨true
   -  å›å½’é—®é¢˜ï¼šè®¾ä¸ºfalse

ä½¿ç”¨æ–¹æ³•
--------

1. å‘½ä»¤è¡Œä½¿ç”¨
~~~~~~~~~~~~~

åˆ›å»ºä¸€ä¸ªPythonè„šæœ¬ï¼ˆä¾‹å¦‚ ``run_kfold_cv.py``\ ï¼‰:

.. code:: python

   from habit.core.machine_learning.machine_learning_kfold import run_kfold_modeling
   import yaml

   # Load configuration
   with open('config/config_machine_learning_kfold.yaml', 'r') as f:
       config = yaml.safe_load(f)

   # Run k-fold cross-validation
   modeling = run_kfold_modeling(config)

   print("K-Fold cross-validation completed!")

ç„¶åè¿è¡Œï¼š

.. code:: bash

   python run_kfold_cv.py

2. äº¤äº’å¼ä½¿ç”¨
~~~~~~~~~~~~~

.. code:: python

   from habit.core.machine_learning.machine_learning_kfold import ModelingKFold
   import yaml

   # Load configuration
   with open('config/config_machine_learning_kfold.yaml', 'r') as f:
       config = yaml.safe_load(f)

   # Create modeling instance
   modeling = ModelingKFold(config)

   # Run pipeline step by step
   modeling.read_data()
   modeling.preprocess_data()
   modeling._create_kfold_splits()
   modeling.run_kfold_cv()

   # Access results
   print("Aggregated results:", modeling.cv_results['aggregated'])

è¾“å‡ºç»“æœ
--------

1. æ§åˆ¶å°è¾“å‡º
~~~~~~~~~~~~~

è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºï¼š - æ¯ä¸ªfoldçš„å¤„ç†è¿›åº¦ - æ¯ä¸ªfoldä¸­æ¯ä¸ªæ¨¡å‹çš„æ€§èƒ½æŒ‡æ ‡ -
æ‰€æœ‰foldçš„èšåˆç»“æœ

ç¤ºä¾‹è¾“å‡ºï¼š

::

   ================================================================================
   Processing Fold 1/5
   ================================================================================
   Selected 25 features for fold 1

   Training LogisticRegression on fold 1...
   LogisticRegression - Val AUC: 0.8523, Acc: 0.7800

   Training RandomForest on fold 1...
   RandomForest - Val AUC: 0.8912, Acc: 0.8200

   ...

   LogisticRegression - Overall AUC: 0.8456 Â± 0.0234
   RandomForest - Overall AUC: 0.8834 Â± 0.0189

2. ç»“æœæ–‡ä»¶
~~~~~~~~~~~

kfold_cv_results.json
^^^^^^^^^^^^^^^^^^^^^

åŒ…å«å®Œæ•´çš„äº¤å‰éªŒè¯ç»“æœï¼š

.. code:: json

   {
     "n_splits": 5,
     "stratified": true,
     "aggregated": {
       "LogisticRegression": {
         "fold_metrics": {
           "auc_mean": 0.8456,
           "auc_std": 0.0234,
           "accuracy_mean": 0.7820,
           "accuracy_std": 0.0156
         },
         "overall_metrics": {
           "auc": 0.8467,
           "accuracy": 0.7830,
           "sensitivity": 0.8100,
           "specificity": 0.7560
         }
       }
     }
   }

kfold_performance_summary.csv
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

æ€§èƒ½æ±‡æ€»è¡¨æ ¼ï¼š

+----+-------+------+---------+-----------+----------+--------------+
| M  | AUC   | AUC  | AUC_    | Accu      | Accu     | Accu         |
| od | _mean | _std | overall | racy_mean | racy_std | racy_overall |
| el |       |      |         |           |          |              |
+====+=======+======+=========+===========+==========+==============+
| Lo | 0     | 0.   | 0.8467  | 0.7820    | 0.0156   | 0.7830       |
| gi | .8456 | 0234 |         |           |          |              |
| st |       |      |         |           |          |              |
| ic |       |      |         |           |          |              |
| Re |       |      |         |           |          |              |
| gr |       |      |         |           |          |              |
| es |       |      |         |           |          |              |
| si |       |      |         |           |          |              |
| on |       |      |         |           |          |              |
+----+-------+------+---------+-----------+----------+--------------+
| Ra | 0     | 0.   | 0.8845  | 0.8230    | 0.0123   | 0.8240       |
| nd | .8834 | 0189 |         |           |          |              |
| om |       |      |         |           |          |              |
| Fo |       |      |         |           |          |              |
| re |       |      |         |           |          |              |
| st |       |      |         |           |          |              |
+----+-------+------+---------+-----------+----------+--------------+

3. Foldçº§åˆ«è¾“å‡º
~~~~~~~~~~~~~~~

æ¯ä¸ªfoldä¼šåœ¨è¾“å‡ºç›®å½•ä¸‹åˆ›å»ºå­ç›®å½•ï¼š

::

   kfold_results/
   â”œâ”€â”€ fold_1/
   â”‚   â””â”€â”€ feature_selection/
   â”‚       â””â”€â”€ correlation_heatmap.pdf
   â”œâ”€â”€ fold_2/
   â”‚   â””â”€â”€ feature_selection/
   â”œâ”€â”€ ...
   â”œâ”€â”€ kfold_cv_results.json
   â””â”€â”€ kfold_performance_summary.csv

ç»“æœè§£è¯»
--------

æ€§èƒ½æŒ‡æ ‡è§£é‡Š
~~~~~~~~~~~~

1. **xxx_mean**: å„foldä¸Šçš„å¹³å‡å€¼

   -  è¡¨ç¤ºæ¨¡å‹åœ¨ä¸åŒæ•°æ®å­é›†ä¸Šçš„å¹³å‡æ€§èƒ½

2. **xxx_std**: å„foldä¸Šçš„æ ‡å‡†å·®

   -  è¡¨ç¤ºæ¨¡å‹æ€§èƒ½çš„ç¨³å®šæ€§
   -  æ ‡å‡†å·®è¶Šå°ï¼Œæ¨¡å‹è¶Šç¨³å®š

3. **xxx_overall**: æ‰€æœ‰foldé¢„æµ‹çš„æ•´ä½“æŒ‡æ ‡

   -  å°†æ‰€æœ‰foldçš„é¢„æµ‹ç»“æœåˆå¹¶åè®¡ç®—
   -  é€šå¸¸æ¯”å¹³å‡å€¼æ›´å‡†ç¡®

å¦‚ä½•é€‰æ‹©æ¨¡å‹
~~~~~~~~~~~~

1. **ä¼˜å…ˆè€ƒè™‘overallæŒ‡æ ‡**:

   -  Overall AUCæœ€é«˜çš„æ¨¡å‹é€šå¸¸æ˜¯æœ€ä½³é€‰æ‹©

2. **è€ƒè™‘ç¨³å®šæ€§**:

   -  æ ‡å‡†å·®è¾ƒå°çš„æ¨¡å‹æ›´å¯é 
   -  ä¾‹å¦‚: æ¨¡å‹A (AUC=0.85Â±0.02) ä¼˜äº æ¨¡å‹B (AUC=0.86Â±0.08)

3. **æƒè¡¡æ€§èƒ½å’Œå¤æ‚åº¦**:

   -  å¦‚æœä¸¤ä¸ªæ¨¡å‹æ€§èƒ½æ¥è¿‘ï¼Œé€‰æ‹©æ›´ç®€å•çš„æ¨¡å‹
   -  ç®€å•æ¨¡å‹æ›´å®¹æ˜“è§£é‡Šå’Œéƒ¨ç½²

é¿å…æ•°æ®æ³„éœ²
------------

K-Foldäº¤å‰éªŒè¯ä¸­çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯\ **æ•°æ®æ³„éœ²**\ ã€‚æœ¬å®ç°é€šè¿‡ä»¥ä¸‹æ–¹å¼é¿å…æ•°æ®æ³„éœ²ï¼š

1. Foldå†…ç‰¹å¾é€‰æ‹©
~~~~~~~~~~~~~~~~~

**é”™è¯¯åšæ³•**\ ï¼ˆä¼šå¯¼è‡´æ•°æ®æ³„éœ²ï¼‰ï¼š

.. code:: python

   # åœ¨æ‰€æœ‰æ•°æ®ä¸Šè¿›è¡Œç‰¹å¾é€‰æ‹©
   selected_features = feature_selection(X, y)

   # ç„¶åè¿›è¡Œk-foldäº¤å‰éªŒè¯
   for train_idx, val_idx in kfold.split(X):
       X_train = X[train_idx][selected_features]
       X_val = X[val_idx][selected_features]
       # è®­ç»ƒå’Œè¯„ä¼°...

**æ­£ç¡®åšæ³•**\ ï¼ˆæœ¬å®ç°é‡‡ç”¨çš„æ–¹æ³•ï¼‰ï¼š

.. code:: python

   # åœ¨æ¯ä¸ªfoldå†…ç‹¬ç«‹è¿›è¡Œç‰¹å¾é€‰æ‹©
   for train_idx, val_idx in kfold.split(X):
       X_train = X[train_idx]
       X_val = X[val_idx]
       
       # åªåœ¨è®­ç»ƒé›†ä¸Šé€‰æ‹©ç‰¹å¾
       selected_features = feature_selection(X_train, y_train)
       
       # åº”ç”¨åˆ°è®­ç»ƒé›†å’ŒéªŒè¯é›†
       X_train_selected = X_train[selected_features]
       X_val_selected = X_val[selected_features]
       # è®­ç»ƒå’Œè¯„ä¼°...

2. Foldå†…æ•°æ®æ ‡å‡†åŒ–
~~~~~~~~~~~~~~~~~~~

æ ‡å‡†åŒ–ä¹Ÿå¿…é¡»åœ¨æ¯ä¸ªfoldå†…ç‹¬ç«‹è¿›è¡Œï¼š

.. code:: python

   for train_idx, val_idx in kfold.split(X):
       # åœ¨è®­ç»ƒé›†ä¸Šæ‹Ÿåˆscaler
       scaler = StandardScaler()
       X_train_scaled = scaler.fit_transform(X_train)
       
       # ç”¨è®­ç»ƒé›†çš„scalerè½¬æ¢éªŒè¯é›†
       X_val_scaled = scaler.transform(X_val)

æœ€ä½³å®è·µ
--------

1. é€‰æ‹©åˆé€‚çš„Kå€¼
~~~~~~~~~~~~~~~~

.. code:: python

   # å°æ•°æ®é›†ï¼ˆ< 100æ ·æœ¬ï¼‰
   config['n_splits'] = 10  # æˆ–æ›´å¤š

   # ä¸­ç­‰æ•°æ®é›†ï¼ˆ100-1000æ ·æœ¬ï¼‰
   config['n_splits'] = 5   # æˆ–10

   # å¤§æ•°æ®é›†ï¼ˆ> 1000æ ·æœ¬ï¼‰
   config['n_splits'] = 5

2. ä½¿ç”¨åˆ†å±‚K-Fold
~~~~~~~~~~~~~~~~~

å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç±»åˆ«ä¸å¹³è¡¡çš„æƒ…å†µï¼š

.. code:: yaml

   stratified: true  # ä¿æŒæ¯ä¸ªfoldä¸­çš„ç±»åˆ«æ¯”ä¾‹

3. å›ºå®šéšæœºç§å­
~~~~~~~~~~~~~~~

ç¡®ä¿ç»“æœå¯é‡å¤ï¼š

.. code:: yaml

   random_state: 42  # å›ºå®šéšæœºç§å­

4. åˆç†é€‰æ‹©æ¨¡å‹æ•°é‡
~~~~~~~~~~~~~~~~~~~

-  ä¸è¦åŒæ—¶è®­ç»ƒå¤ªå¤šæ¨¡å‹ï¼ˆä¼šå¾ˆæ…¢ï¼‰
-  å»ºè®®æ¯æ¬¡è®­ç»ƒ3-5ä¸ªæ¨¡å‹è¿›è¡Œæ¯”è¾ƒ

5. ç‰¹å¾é€‰æ‹©ç­–ç•¥
~~~~~~~~~~~~~~~

.. code:: yaml

   feature_selection_methods:
     # å…ˆå»é™¤é«˜åº¦ç›¸å…³çš„ç‰¹å¾
     - method: correlation
       params:
         threshold: 0.90
         
     # å†è¿›è¡Œé‡è¦æ€§ç­›é€‰
     - method: anova
       params:
         n_features_to_select: 20

ä¸æ ‡å‡†æµç¨‹çš„é€‰æ‹©
----------------

ä½•æ—¶ä½¿ç”¨K-Foldäº¤å‰éªŒè¯
~~~~~~~~~~~~~~~~~~~~~~

1. **å°æ ·æœ¬æ•°æ®é›†**\ ï¼ˆ< 500æ ·æœ¬ï¼‰
2. **éœ€è¦å¯é çš„æ€§èƒ½è¯„ä¼°**
3. **æ¨¡å‹é€‰æ‹©å’Œè¶…å‚æ•°è°ƒä¼˜**
4. **å‘è¡¨è®ºæ–‡éœ€è¦ä¸¥è°¨è¯„ä¼°**
5. **æ•°æ®æ”¶é›†æˆæœ¬é«˜**

ä½•æ—¶ä½¿ç”¨æ ‡å‡†æµç¨‹
~~~~~~~~~~~~~~~~

1. **å¤§æ•°æ®é›†**\ ï¼ˆ> 10000æ ·æœ¬ï¼‰
2. **å¿«é€ŸåŸå‹å¼€å‘**
3. **è®¡ç®—èµ„æºæœ‰é™**
4. **å·²ç»ç¡®å®šæ¨¡å‹å’Œå‚æ•°**
5. **å®æ—¶é¢„æµ‹ç³»ç»Ÿ**

å¸¸è§é—®é¢˜
--------

Q: K-Foldäº¤å‰éªŒè¯çš„è®¡ç®—æ—¶é—´æ˜¯å¤šå°‘ï¼Ÿ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A: çº¦ä¸ºæ ‡å‡†æµç¨‹çš„Kå€ï¼ˆä¾‹å¦‚5-foldéœ€è¦5å€æ—¶é—´ï¼‰ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åŠ é€Ÿï¼š -
å‡å°‘æ¨¡å‹æ•°é‡ - å‡å°‘ç‰¹å¾é€‰æ‹©æ–¹æ³• - ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å‹ - å‡å°‘Kå€¼

Q: æ¯ä¸ªfoldé€‰å‡ºçš„ç‰¹å¾ä¼šä¸åŒå—ï¼Ÿ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A:
æ˜¯çš„ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚æ¯ä¸ªfoldçš„è®­ç»ƒé›†ç•¥æœ‰ä¸åŒï¼Œå› æ­¤ç‰¹å¾é€‰æ‹©ç»“æœä¹Ÿä¼šæœ‰å·®å¼‚ã€‚æœ€ç»ˆç‰¹å¾é‡è¦æ€§åº”è¯¥ç»¼åˆæ‰€æœ‰foldçš„ç»“æœã€‚

Q: å¦‚ä½•ä¿å­˜K-Foldäº¤å‰éªŒè¯çš„æ¨¡å‹ï¼Ÿ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A: K-Foldä¸»è¦ç”¨äºè¯„ä¼°ï¼Œé€šå¸¸ä¸ä¿å­˜æ¨¡å‹ã€‚å¦‚æœéœ€è¦æœ€ç»ˆæ¨¡å‹ï¼Œå»ºè®®ï¼š 1.
ä½¿ç”¨K-Foldè¯„ä¼°é€‰å‡ºæœ€ä½³æ¨¡å‹å’Œå‚æ•° 2. åœ¨å…¨éƒ¨æ•°æ®ä¸Šé‡æ–°è®­ç»ƒè¯¥æ¨¡å‹ 3.
ä¿å­˜é‡æ–°è®­ç»ƒçš„æ¨¡å‹

Q: æ ‡å‡†å·®å¾ˆå¤§è¯´æ˜ä»€ä¹ˆï¼Ÿ
~~~~~~~~~~~~~~~~~~~~~~~

A: æ ‡å‡†å·®å¤§è¡¨ç¤ºï¼š - æ¨¡å‹åœ¨ä¸åŒæ•°æ®å­é›†ä¸Šæ€§èƒ½ä¸ç¨³å®š - å¯èƒ½å¯¹æ•°æ®åˆ†å¸ƒæ•æ„Ÿ
- éœ€è¦è€ƒè™‘ï¼š - å¢åŠ æ ·æœ¬é‡ - ä½¿ç”¨æ›´ç¨³å®šçš„æ¨¡å‹ - æ”¹è¿›ç‰¹å¾å·¥ç¨‹ - è°ƒæ•´è¶…å‚æ•°

Q: K-Foldä¸ç•™ä¸€æ³•(Leave-One-Out)çš„åŒºåˆ«ï¼Ÿ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A: - Leave-One-Outæ˜¯K-Foldçš„ç‰¹ä¾‹ï¼ˆK=æ ·æœ¬æ•°ï¼‰ - ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨æ•°æ® -
ç¼ºç‚¹ï¼šè®¡ç®—é‡æå¤§ - å»ºè®®ï¼šä»…åœ¨æå°æ ·æœ¬ï¼ˆ<30ï¼‰æ—¶ä½¿ç”¨

ä¸æ¨¡å‹æ¯”è¾ƒå·¥å…·çš„å…¼å®¹æ€§
----------------------

K-Foldäº¤å‰éªŒè¯çš„ç»“æœå¯ä»¥ç›´æ¥ç”¨äºæ¨¡å‹æ¯”è¾ƒåˆ†æï¼Œæ— éœ€é¢å¤–çš„æ ¼å¼è½¬æ¢ã€‚

è¾“å‡ºæ–‡ä»¶
~~~~~~~~

è¿è¡ŒK-Foldäº¤å‰éªŒè¯åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

å¿…éœ€è¾“å‡º
^^^^^^^^

1. **kfold_cv_results.json** - è¯¦ç»†çš„äº¤å‰éªŒè¯ç»“æœ
2. **kfold_performance_summary.csv** - æ€§èƒ½æ‘˜è¦è¡¨
3. **all_prediction_results.csv** - å…¼å®¹æ ¼å¼çš„é¢„æµ‹ç»“æœï¼ˆå¯ç”¨äºæ¨¡å‹æ¯”è¾ƒï¼‰

å¯è§†åŒ–è¾“å‡ºï¼ˆå½“ ``is_visualize: true`` æ—¶ï¼‰
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

4. **kfold_roc_curves.pdf** - ROCæ›²çº¿å¯¹æ¯”å›¾
5. **kfold_calibration_curves.pdf** - æ ¡å‡†æ›²çº¿
6. **kfold_dca_curves.pdf** - å†³ç­–æ›²çº¿åˆ†æï¼ˆDCAï¼‰
7. **kfold_confusion_matrix\_{æ¨¡å‹å}.pdf** - å„æ¨¡å‹çš„æ··æ·†çŸ©é˜µ

**é…ç½®å¯è§†åŒ–**\ ï¼š

.. code:: yaml

   # åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
   is_visualize: true  # å¯ç”¨å¯è§†åŒ–ï¼ˆé»˜è®¤ä¸º falseï¼‰
   is_save_model: false  # æ˜¯å¦ä¿å­˜æ¯ä¸ªfoldçš„æ¨¡å‹

é¢„æµ‹ç»“æœæ ¼å¼
~~~~~~~~~~~~

``all_prediction_results.csv`` æ–‡ä»¶æ ¼å¼ä¸æ ‡å‡†æœºå™¨å­¦ä¹ æµç¨‹å®Œå…¨å…¼å®¹ï¼š

.. code:: csv

   subject_id,true_label,split,RandomForest_pred,RandomForest_prob,XGBoost_pred,XGBoost_prob
   patient_001,1,Test set,1,0.85,1,0.88
   patient_002,0,Test set,0,0.23,0,0.19
   ...

**æ³¨æ„**: - ``split`` åˆ—æ ‡è®°ä¸º â€œTest setâ€ï¼Œè¡¨ç¤ºè¿™äº›æ˜¯éªŒè¯é›†çš„é¢„æµ‹ç»“æœ -
åœ¨K-Foldä¸­ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½ä¼šåœ¨æŸä¸ªfoldä¸­ä½œä¸ºéªŒè¯é›†è¢«é¢„æµ‹ä¸€æ¬¡ -
å› æ­¤æ‰€æœ‰æ ·æœ¬çš„ ``split`` éƒ½æ˜¯ â€œTest setâ€ - å¦‚æœå¯ç”¨äº†
``is_visualize: true``\ ï¼Œè¿˜ä¼šè‡ªåŠ¨ç”Ÿæˆ
ROCã€DCAã€æ ¡å‡†æ›²çº¿å’Œæ··æ·†çŸ©é˜µç­‰å¯è§†åŒ–å›¾è¡¨ - å¯è§†åŒ–å›¾è¡¨åŸºäºæ‰€æœ‰ fold
çš„èšåˆé¢„æµ‹ç»“æœç”Ÿæˆï¼Œèƒ½å¤Ÿå…¨é¢åæ˜ æ¨¡å‹åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šçš„è¡¨ç°

ä½¿ç”¨æ¨¡å‹æ¯”è¾ƒå·¥å…·
~~~~~~~~~~~~~~~~

è¿è¡Œå®ŒK-Foldäº¤å‰éªŒè¯åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å‹æ¯”è¾ƒå·¥å…·ï¼š

.. code:: bash

   # 1. è¿è¡ŒK-Foldäº¤å‰éªŒè¯
   python -m habit kfold -c config/config_machine_learning_kfold.yaml

   # 2. ä½¿ç”¨æ¯”è¾ƒå·¥å…·åˆ†æç»“æœ
   python -m habit compare -c config/config_model_comparison.yaml

åœ¨ ``config_model_comparison.yaml`` ä¸­é…ç½®ï¼š

.. code:: yaml

   output_dir: ./results/model_comparison

   files_config:
     - path: ./ml_data/kfold_results/all_prediction_results.csv
       model_names:
         - RandomForest
         - LogisticRegression
         - XGBoost
       prob_suffix: "_prob"
       pred_suffix: "_pred"
       label_col: "true_label"
       split_col: "split"

   split:
     enabled: false  # K-Foldç»“æœé€šå¸¸ä¸éœ€è¦å†åˆ†ç»„

   statistical_tests:
     enabled: true
     methods:
       - delong
       - mcnemar

   visualization:
     enabled: true
     plot_types:
       - roc
       - calibration
       - confusion
       - dca

å¯¹æ¯”ä¸åŒè®­ç»ƒæ–¹å¼
~~~~~~~~~~~~~~~~

æ‚¨è¿˜å¯ä»¥å¯¹æ¯”K-Foldäº¤å‰éªŒè¯å’Œæ ‡å‡†è®­ç»ƒ/æµ‹è¯•é›†åˆ’åˆ†çš„ç»“æœï¼š

.. code:: yaml

   files_config:
     # æ ‡å‡†è®­ç»ƒç»“æœ
     - path: ./results/standard_ml/all_prediction_results.csv
       model_names: [RandomForest, XGBoost]
       # ...
     
     # K-FoldéªŒè¯ç»“æœ
     - path: ./results/kfold/all_prediction_results.csv
       model_names: [RandomForest, XGBoost]
       # ...

è¿™æ ·å¯ä»¥è¯„ä¼°ï¼š - ä¸åŒè®­ç»ƒç­–ç•¥å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ -
æ¨¡å‹åœ¨ä¸åŒè¯„ä¼°æ–¹æ³•ä¸‹çš„ç¨³å®šæ€§ - é€‰æ‹©æœ€é€‚åˆæ‚¨æ•°æ®çš„è®­ç»ƒæ–¹æ³•

ç›¸å…³æ–‡æ¡£
--------

-  `æœºå™¨å­¦ä¹ é…ç½®æ–‡ä»¶è¯´æ˜ <app_of_machine_learning>`__
-  `æœºå™¨å­¦ä¹ æ¨¡å‹æŒ‡å— <machine_learning_modeling_zh>`__
-  `æ¨¡å‹æ¯”è¾ƒå·¥å…·ä½¿ç”¨ <app_model_comparison_plots>`__
-  `ç‰¹å¾é€‰æ‹©æ–¹æ³• <../habit/core/machine_learning/feature_selectors/README.md>`__
-  `CLIä½¿ç”¨æŒ‡å— <cli_reference>`__
