# HABIT 测试覆盖清单

本文档追踪各模块的测试覆盖情况。

## 测试状态图例

- ✅ 已完成并通过
- 🚧 正在进行
- ⏸️ 已实现但需更新
- ❌ 尚未实现
- ⚠️ 部分完成
- 🔄 需要重构

---

## 1. 预处理模块 (Preprocessing)

### 1.1 图像加载
- ❌ 测试 NIfTI 格式加载
- ❌ 测试 DICOM 格式加载
- ❌ 测试多序列图像加载
- ❌ 测试掩码加载

### 1.2 N4 偏置场校正
- ❌ 基础 N4 校正测试
- ❌ 多序列 N4 校正测试
- ❌ N4 参数影响测试

### 1.3 图像重采样
- ❌ 基础重采样测试
- ❌ 目标间距设置测试
- ❌ 不同插值方法测试
- ❌ 掩码同步重采样测试

### 1.4 图像配准
- ❌ 刚性配准测试
- ❌ 仿射配准测试
- ❌ 非刚性配准测试
- ❌ 带掩码配准测试
- ❌ 多序列配准测试

### 1.5 强度标准化
- ❌ Z-score 标准化测试
- ❌ 掩码内标准化测试
- ❌ 直方图标准化测试

### 1.6 DICOM转换
- ❌ dcm2niix 转换测试
- ❌ 批量转换测试

---

## 2. 栖息地分析模块 (Habitat Analysis)

### 2.1 聚类算法
- ❌ K-means 聚类测试
- ❌ GMM 聚类测试
- ❌ 层次聚类测试
- ❌ DBSCAN 聚类测试
- ❌ 谱聚类测试
- ❌ 亲和传播聚类测试
- ❌ Mean Shift 聚类测试

### 2.2 聚类验证
- ❌ 轮廓系数测试
- ❌ Davies-Bouldin 指数测试
- ❌ Calinski-Harabasz 指数测试
- ❌ 最优聚类数确定测试

### 2.3 特征提取
- ❌ 基础栖息地特征测试
- ❌ 栖息地影像组学特征测试
- ❌ ITH 特征测试
- ❌ MSI 特征测试
- ❌ 体素级特征测试
- ❌ 超体素级特征测试
- ❌ 局部熵特征测试

### 2.4 特征解析器
- ❌ 特征表达式解析测试
- ❌ 自定义特征提取测试
- ❌ 特征组合测试

---

## 3. 机器学习模块 (Machine Learning)

### 3.1 特征选择
- ❌ LASSO 选择器测试
- ❌ mRMR 选择器测试
- ❌ RFECV 选择器测试
- ❌ 单变量选择器测试
- ❌ ICC 选择器测试
- ❌ 方差选择器测试
- ❌ VIF 选择器测试
- ❌ 相关性选择器测试
- ❌ 逐步回归选择器测试

### 3.2 机器学习模型
- ❌ 逻辑回归测试
- ❌ 随机森林测试
- ❌ SVM 测试
- ❌ XGBoost 测试
- ❌ LightGBM 测试
- ❌ 决策树测试
- ❌ 朴素贝叶斯测试
- ❌ KNN 测试

### 3.3 模型评估
- ❌ AUC 计算测试
- ❌ 混淆矩阵测试
- ❌ 敏感性/特异性测试
- ❌ ROC 曲线绘制测试
- ❌ 校准曲线测试
- ❌ 决策曲线分析测试

### 3.4 交叉验证
- ❌ K-fold CV 测试
- ❌ Stratified K-fold CV 测试
- ❌ 留一法 CV 测试

### 3.5 统计检验
- ❌ DeLong 检验测试
- ❌ Hosmer-Lemeshow 检验测试
- ❌ Spiegelhalter Z 检验测试

### 3.6 模型比较
- ❌ 多模型性能比较测试
- ❌ 统计显著性检验测试

### 3.7 ICC 分析
- ❌ ICC 计算测试
- ❌ 测试-重测分析测试
- ❌ 栖息地映射测试

---

## 4. 工具模块 (Utils)

### 4.1 配置管理
- ❌ YAML 配置加载测试
- ❌ 配置验证测试
- ❌ 默认配置测试

### 4.2 文件系统
- ❌ 目录创建测试
- ❌ 文件列表测试
- ❌ 自动选择首个文件测试
- ❌ 路径处理测试

### 4.3 输入输出
- ❌ 图像加载测试
- ❌ 图像保存测试
- ❌ CSV 读写测试
- ❌ Excel 读写测试
- ❌ JSON 读写测试

### 4.4 进度条
- ❌ 进度条创建测试
- ❌ 进度条更新测试
- ❌ 多进程进度条测试

### 4.5 日志系统
- ❌ 日志器创建测试
- ❌ 日志消息测试
- ❌ 日志文件生成测试
- ❌ 日志级别测试

### 4.6 可视化
- ❌ ROC 曲线绘制测试
- ❌ 混淆矩阵可视化测试
- ❌ 特征重要性图测试
- ❌ 校准曲线图测试
- ❌ DCA 曲线图测试
- ❌ 生存曲线图测试

### 4.7 图像转换
- ❌ 格式转换测试
- ❌ 批量转换测试

---

## 5. CLI 模块 (Command Line Interface)

### 5.1 命令测试
- ❌ preprocess 命令测试
- ❌ habitat 命令测试
- ❌ extract-features 命令测试
- ❌ radiomics 命令测试
- ❌ ml 命令测试
- ❌ kfold 命令测试
- ❌ icc 命令测试
- ❌ test-retest 命令测试
- ❌ compare 命令测试

### 5.2 参数验证
- ❌ 必需参数测试
- ❌ 可选参数测试
- ❌ 参数类型验证测试
- ❌ 参数组合验证测试

### 5.3 错误处理
- ❌ 配置文件缺失测试
- ❌ 数据文件缺失测试
- ❌ 参数错误测试
- ❌ 异常处理测试

---

## 6. 集成测试 (Integration Tests)

### 6.1 完整流程测试
- ❌ 预处理 → 栖息地分析完整流程
- ❌ 栖息地分析 → 特征提取 → 机器学习完整流程
- ❌ 端到端测试（从原始数据到最终模型）

### 6.2 多进程测试
- ❌ 并行处理测试
- ❌ 进程池测试

### 6.3 大数据测试
- ❌ 大规模图像处理测试
- ❌ 高维特征处理测试

---

## 7. 性能测试 (Performance Tests)

- ❌ 预处理性能基准测试
- ❌ 聚类算法性能测试
- ❌ 特征提取性能测试
- ❌ 模型训练性能测试

---

## 8. 兼容性测试 (Compatibility Tests)

- ❌ Python 3.8 兼容性
- ❌ Python 3.9 兼容性
- ❌ Python 3.10+ 兼容性
- ❌ Windows 兼容性
- ❌ Linux 兼容性
- ❌ macOS 兼容性

---

## 测试覆盖率目标

| 模块 | 目标覆盖率 | 当前覆盖率 | 状态 |
|------|-----------|-----------|------|
| Preprocessing | 80% | 0% | ❌ |
| Habitat Analysis | 80% | 0% | ❌ |
| Machine Learning | 80% | 0% | ❌ |
| Utils | 90% | 0% | ❌ |
| CLI | 70% | 0% | ❌ |
| **Overall** | **80%** | **0%** | ❌ |

---

## 优先级

### P0 (最高优先级 - 核心功能)
1. CLI 基础命令测试
2. 配置文件加载测试
3. 图像加载测试
4. 基础预处理测试（重采样、配准）
5. K-means 聚类测试
6. 基础特征提取测试

### P1 (高优先级 - 常用功能)
1. 所有聚类算法测试
2. 特征选择器测试
3. 常用 ML 模型测试
4. 模型评估测试
5. K-fold CV 测试

### P2 (中优先级 - 扩展功能)
1. 高级特征提取测试
2. ICC 分析测试
3. 统计检验测试
4. 可视化测试

### P3 (低优先级 - 优化和边界情况)
1. 性能测试
2. 边界条件测试
3. 异常处理测试

---

## 更新日志

| 日期 | 更新内容 | 更新人 |
|------|---------|-------|
| 2025-11-10 | 创建测试清单 | - |

---

## 注意事项

1. 每完成一个测试项，更新状态图例
2. 定期更新测试覆盖率
3. 优先完成 P0 级别的测试
4. 每个模块至少要有基础的smoke test
5. 所有 critical path 必须有测试覆盖

